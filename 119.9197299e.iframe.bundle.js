/*! For license information please see 119.9197299e.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkentertainer_redesign=self.webpackChunkentertainer_redesign||[]).push([[119],{"./node_modules/@babel/runtime/helpers/esm/objectSpread2.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function toPropertyKey(t){var i=function toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}function _defineProperty(e,r,t){return(r=toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}__webpack_require__.d(__webpack_exports__,{A:()=>_objectSpread2})},"./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==e.indexOf(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],-1===t.indexOf(o)&&{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}__webpack_require__.d(__webpack_exports__,{A:()=>_objectWithoutProperties})},"./node_modules/@firebase/app/dist/esm/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{MF:()=>SDK_VERSION,j6:()=>_getProvider,xZ:()=>_isFirebaseServerApp,om:()=>_registerComponent,Sx:()=>getApp,Wp:()=>initializeApp,KO:()=>registerVersion});var index_esm=__webpack_require__("./node_modules/@firebase/component/dist/esm/index.esm.js"),esm_index_esm=__webpack_require__("./node_modules/@firebase/logger/dist/esm/index.esm.js"),dist_index_esm=__webpack_require__("./node_modules/@firebase/util/dist/index.esm.js");let idbProxyableTypes,cursorAdvanceMethods;const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;let idbProxyTraps={get(target,prop,receiver){if(target instanceof IDBTransaction){if("done"===prop)return transactionDoneMap.get(target);if("objectStoreNames"===prop)return target.objectStoreNames||transactionStoreNamesMap.get(target);if("store"===prop)return receiver.objectStoreNames[1]?void 0:receiver.objectStore(receiver.objectStoreNames[0])}return wrap_idb_value_wrap(target[prop])},set:(target,prop,value)=>(target[prop]=value,!0),has:(target,prop)=>target instanceof IDBTransaction&&("done"===prop||"store"===prop)||prop in target};function wrapFunction(func){return func!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(func)?function(...args){return func.apply(unwrap(this),args),wrap_idb_value_wrap(cursorRequestMap.get(this))}:function(...args){return wrap_idb_value_wrap(func.apply(unwrap(this),args))}:function(storeNames,...args){const tx=func.call(unwrap(this),storeNames,...args);return transactionStoreNamesMap.set(tx,storeNames.sort?storeNames.sort():[storeNames]),wrap_idb_value_wrap(tx)}}function transformCachableValue(value){return"function"==typeof value?wrapFunction(value):(value instanceof IDBTransaction&&function cacheDonePromiseForTransaction(tx){if(transactionDoneMap.has(tx))return;const done=new Promise(((resolve,reject)=>{const unlisten=()=>{tx.removeEventListener("complete",complete),tx.removeEventListener("error",error),tx.removeEventListener("abort",error)},complete=()=>{resolve(),unlisten()},error=()=>{reject(tx.error||new DOMException("AbortError","AbortError")),unlisten()};tx.addEventListener("complete",complete),tx.addEventListener("error",error),tx.addEventListener("abort",error)}));transactionDoneMap.set(tx,done)}(value),object=value,function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}().some((c=>object instanceof c))?new Proxy(value,idbProxyTraps):value);var object}function wrap_idb_value_wrap(value){if(value instanceof IDBRequest)return function promisifyRequest(request){const promise=new Promise(((resolve,reject)=>{const unlisten=()=>{request.removeEventListener("success",success),request.removeEventListener("error",error)},success=()=>{resolve(wrap_idb_value_wrap(request.result)),unlisten()},error=()=>{reject(request.error),unlisten()};request.addEventListener("success",success),request.addEventListener("error",error)}));return promise.then((value=>{value instanceof IDBCursor&&cursorRequestMap.set(value,request)})).catch((()=>{})),reverseTransformCache.set(promise,request),promise}(value);if(transformCache.has(value))return transformCache.get(value);const newValue=transformCachableValue(value);return newValue!==value&&(transformCache.set(value,newValue),reverseTransformCache.set(newValue,value)),newValue}const unwrap=value=>reverseTransformCache.get(value);const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(target,prop){if(!(target instanceof IDBDatabase)||prop in target||"string"!=typeof prop)return;if(cachedMethods.get(prop))return cachedMethods.get(prop);const targetFuncName=prop.replace(/FromIndex$/,""),useIndex=prop!==targetFuncName,isWrite=writeMethods.includes(targetFuncName);if(!(targetFuncName in(useIndex?IDBIndex:IDBObjectStore).prototype)||!isWrite&&!readMethods.includes(targetFuncName))return;const method=async function(storeName,...args){const tx=this.transaction(storeName,isWrite?"readwrite":"readonly");let target=tx.store;return useIndex&&(target=target.index(args.shift())),(await Promise.all([target[targetFuncName](...args),isWrite&&tx.done]))[0]};return cachedMethods.set(prop,method),method}!function replaceTraps(callback){idbProxyTraps=callback(idbProxyTraps)}((oldTraps=>({...oldTraps,get:(target,prop,receiver)=>getMethod(target,prop)||oldTraps.get(target,prop,receiver),has:(target,prop)=>!!getMethod(target,prop)||oldTraps.has(target,prop)})));class PlatformLoggerServiceImpl{constructor(container){this.container=container}getPlatformInfoString(){return this.container.getProviders().map((provider=>{if(function isVersionServiceProvider(provider){const component=provider.getComponent();return"VERSION"===component?.type}(provider)){const service=provider.getImmediate();return`${service.library}/${service.version}`}return null})).filter((logString=>logString)).join(" ")}}const name$q="@firebase/app",logger=new esm_index_esm.Vy("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2="@firebase/ai",name$1="@firebase/firestore-compat",index_esm_name="firebase",DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1]:"fire-fst-compat",[name$2]:"fire-vertex","fire-js":"fire-js",[index_esm_name]:"fire-js-all"},_apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(app,component){try{app.container.addComponent(component)}catch(e){logger.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`,e)}}function _registerComponent(component){const componentName=component.name;if(_components.has(componentName))return logger.debug(`There were multiple attempts to register component ${componentName}.`),!1;_components.set(componentName,component);for(const app of _apps.values())_addComponent(app,component);for(const serverApp of _serverApps.values())_addComponent(serverApp,component);return!0}function _getProvider(app,name){const heartbeatController=app.container.getProvider("heartbeat").getImmediate({optional:!0});return heartbeatController&&heartbeatController.triggerHeartbeat(),app.container.getProvider(name)}function _isFirebaseServerApp(obj){return null!=obj&&void 0!==obj.settings}const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new dist_index_esm.FA("app","Firebase",ERRORS);class FirebaseAppImpl{constructor(options,config,container){this._isDeleted=!1,this._options={...options},this._config={...config},this._name=config.name,this._automaticDataCollectionEnabled=config.automaticDataCollectionEnabled,this._container=container,this.container.addComponent(new index_esm.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(val){this.checkDestroyed(),this._automaticDataCollectionEnabled=val}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(val){this._isDeleted=val}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}const SDK_VERSION="12.5.0";function initializeApp(_options,rawConfig={}){let options=_options;if("object"!=typeof rawConfig){rawConfig={name:rawConfig}}const config={name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0,...rawConfig},name=config.name;if("string"!=typeof name||!name)throw ERROR_FACTORY.create("bad-app-name",{appName:String(name)});if(options||(options=(0,dist_index_esm.T9)()),!options)throw ERROR_FACTORY.create("no-options");const existingApp=_apps.get(name);if(existingApp){if((0,dist_index_esm.bD)(options,existingApp.options)&&(0,dist_index_esm.bD)(config,existingApp.config))return existingApp;throw ERROR_FACTORY.create("duplicate-app",{appName:name})}const container=new index_esm.h1(name);for(const component of _components.values())container.addComponent(component);const newApp=new FirebaseAppImpl(options,config,container);return _apps.set(name,newApp),newApp}function getApp(name=DEFAULT_ENTRY_NAME){const app=_apps.get(name);if(!app&&name===DEFAULT_ENTRY_NAME&&(0,dist_index_esm.T9)())return initializeApp();if(!app)throw ERROR_FACTORY.create("no-app",{appName:name});return app}function registerVersion(libraryKeyOrName,version,variant){let library=PLATFORM_LOG_STRING[libraryKeyOrName]??libraryKeyOrName;variant&&(library+=`-${variant}`);const libraryMismatch=library.match(/\s|\//),versionMismatch=version.match(/\s|\//);if(libraryMismatch||versionMismatch){const warning=[`Unable to register library "${library}" with version "${version}":`];return libraryMismatch&&warning.push(`library name "${library}" contains illegal characters (whitespace or "/")`),libraryMismatch&&versionMismatch&&warning.push("and"),versionMismatch&&warning.push(`version name "${version}" contains illegal characters (whitespace or "/")`),void logger.warn(warning.join(" "))}_registerComponent(new index_esm.uA(`${library}-version`,(()=>({library,version})),"VERSION"))}const STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=function openDB(name,version,{blocked,upgrade,blocking,terminated}={}){const request=indexedDB.open(name,version),openPromise=wrap_idb_value_wrap(request);return upgrade&&request.addEventListener("upgradeneeded",(event=>{upgrade(wrap_idb_value_wrap(request.result),event.oldVersion,event.newVersion,wrap_idb_value_wrap(request.transaction),event)})),blocked&&request.addEventListener("blocked",(event=>blocked(event.oldVersion,event.newVersion,event))),openPromise.then((db=>{terminated&&db.addEventListener("close",(()=>terminated())),blocking&&db.addEventListener("versionchange",(event=>blocking(event.oldVersion,event.newVersion,event)))})).catch((()=>{})),openPromise}("firebase-heartbeat-database",1,{upgrade:(db,oldVersion)=>{if(0===oldVersion)try{db.createObjectStore(STORE_NAME)}catch(e){console.warn(e)}}}).catch((e=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:e.message})}))),dbPromise}async function writeHeartbeatsToIndexedDB(app,heartbeatObject){try{const tx=(await getDbPromise()).transaction(STORE_NAME,"readwrite"),objectStore=tx.objectStore(STORE_NAME);await objectStore.put(heartbeatObject,computeKey(app)),await tx.done}catch(e){if(e instanceof dist_index_esm.g)logger.warn(e.message);else{const idbGetError=ERROR_FACTORY.create("idb-set",{originalErrorMessage:e?.message});logger.warn(idbGetError.message)}}}function computeKey(app){return`${app.name}!${app.options.appId}`}class HeartbeatServiceImpl{constructor(container){this.container=container,this._heartbeatsCache=null;const app=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(app),this._heartbeatsCachePromise=this._storage.read().then((result=>(this._heartbeatsCache=result,result)))}async triggerHeartbeat(){try{const agent=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),date=getUTCDateString();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===date||this._heartbeatsCache.heartbeats.some((singleDateHeartbeat=>singleDateHeartbeat.date===date)))return;if(this._heartbeatsCache.heartbeats.push({date,agent}),this._heartbeatsCache.heartbeats.length>30){const earliestHeartbeatIdx=function getEarliestHeartbeatIdx(heartbeats){if(0===heartbeats.length)return-1;let earliestHeartbeatIdx=0,earliestHeartbeatDate=heartbeats[0].date;for(let i=1;i<heartbeats.length;i++)heartbeats[i].date<earliestHeartbeatDate&&(earliestHeartbeatDate=heartbeats[i].date,earliestHeartbeatIdx=i);return earliestHeartbeatIdx}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(earliestHeartbeatIdx,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){logger.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const date=getUTCDateString(),{heartbeatsToSend,unsentEntries}=function extractHeartbeatsForHeader(heartbeatsCache,maxSize=1024){const heartbeatsToSend=[];let unsentEntries=heartbeatsCache.slice();for(const singleDateHeartbeat of heartbeatsCache){const heartbeatEntry=heartbeatsToSend.find((hb=>hb.agent===singleDateHeartbeat.agent));if(heartbeatEntry){if(heartbeatEntry.dates.push(singleDateHeartbeat.date),countBytes(heartbeatsToSend)>maxSize){heartbeatEntry.dates.pop();break}}else if(heartbeatsToSend.push({agent:singleDateHeartbeat.agent,dates:[singleDateHeartbeat.date]}),countBytes(heartbeatsToSend)>maxSize){heartbeatsToSend.pop();break}unsentEntries=unsentEntries.slice(1)}return{heartbeatsToSend,unsentEntries}}(this._heartbeatsCache.heartbeats),headerString=(0,dist_index_esm.Uj)(JSON.stringify({version:2,heartbeats:heartbeatsToSend}));return this._heartbeatsCache.lastSentHeartbeatDate=date,unsentEntries.length>0?(this._heartbeatsCache.heartbeats=unsentEntries,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),headerString}catch(e){return logger.warn(e),""}}}function getUTCDateString(){return(new Date).toISOString().substring(0,10)}class HeartbeatStorageImpl{constructor(app){this.app=app,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,dist_index_esm.zW)()&&(0,dist_index_esm.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const idbHeartbeatObject=await async function readHeartbeatsFromIndexedDB(app){try{const tx=(await getDbPromise()).transaction(STORE_NAME),result=await tx.objectStore(STORE_NAME).get(computeKey(app));return await tx.done,result}catch(e){if(e instanceof dist_index_esm.g)logger.warn(e.message);else{const idbGetError=ERROR_FACTORY.create("idb-get",{originalErrorMessage:e?.message});logger.warn(idbGetError.message)}}}(this.app);return idbHeartbeatObject?.heartbeats?idbHeartbeatObject:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(heartbeatsObject){if(await this._canUseIndexedDBPromise){const existingHeartbeatsObject=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:heartbeatsObject.lastSentHeartbeatDate??existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:heartbeatsObject.heartbeats})}}async add(heartbeatsObject){if(await this._canUseIndexedDBPromise){const existingHeartbeatsObject=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:heartbeatsObject.lastSentHeartbeatDate??existingHeartbeatsObject.lastSentHeartbeatDate,heartbeats:[...existingHeartbeatsObject.heartbeats,...heartbeatsObject.heartbeats]})}}}function countBytes(heartbeatsCache){return(0,dist_index_esm.Uj)(JSON.stringify({version:2,heartbeats:heartbeatsCache})).length}!function registerCoreComponents(variant){_registerComponent(new index_esm.uA("platform-logger",(container=>new PlatformLoggerServiceImpl(container)),"PRIVATE")),_registerComponent(new index_esm.uA("heartbeat",(container=>new HeartbeatServiceImpl(container)),"PRIVATE")),registerVersion(name$q,"0.14.5",variant),registerVersion(name$q,"0.14.5","esm2020"),registerVersion("fire-js","")}("")},"./node_modules/@firebase/component/dist/esm/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{h1:()=>ComponentContainer,uA:()=>Component});var _firebase_util__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@firebase/util/dist/index.esm.js");class Component{constructor(name,instanceFactory,type){this.name=name,this.instanceFactory=instanceFactory,this.type=type,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(mode){return this.instantiationMode=mode,this}setMultipleInstances(multipleInstances){return this.multipleInstances=multipleInstances,this}setServiceProps(props){return this.serviceProps=props,this}setInstanceCreatedCallback(callback){return this.onInstanceCreated=callback,this}}class Provider{constructor(name,container){this.name=name,this.container=container,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(identifier){const normalizedIdentifier=this.normalizeInstanceIdentifier(identifier);if(!this.instancesDeferred.has(normalizedIdentifier)){const deferred=new _firebase_util__WEBPACK_IMPORTED_MODULE_0__.cY;if(this.instancesDeferred.set(normalizedIdentifier,deferred),this.isInitialized(normalizedIdentifier)||this.shouldAutoInitialize())try{const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instance&&deferred.resolve(instance)}catch(e){}}return this.instancesDeferred.get(normalizedIdentifier).promise}getImmediate(options){const normalizedIdentifier=this.normalizeInstanceIdentifier(options?.identifier),optional=options?.optional??!1;if(!this.isInitialized(normalizedIdentifier)&&!this.shouldAutoInitialize()){if(optional)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:normalizedIdentifier})}catch(e){if(optional)return null;throw e}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function isComponentEager(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}for(const[instanceIdentifier,instanceDeferred]of this.instancesDeferred.entries()){const normalizedIdentifier=this.normalizeInstanceIdentifier(instanceIdentifier);try{const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier});instanceDeferred.resolve(instance)}catch(e){}}}}clearInstance(identifier="[DEFAULT]"){this.instancesDeferred.delete(identifier),this.instancesOptions.delete(identifier),this.instances.delete(identifier)}async delete(){const services=Array.from(this.instances.values());await Promise.all([...services.filter((service=>"INTERNAL"in service)).map((service=>service.INTERNAL.delete())),...services.filter((service=>"_delete"in service)).map((service=>service._delete()))])}isComponentSet(){return null!=this.component}isInitialized(identifier="[DEFAULT]"){return this.instances.has(identifier)}getOptions(identifier="[DEFAULT]"){return this.instancesOptions.get(identifier)||{}}initialize(opts={}){const{options={}}=opts,normalizedIdentifier=this.normalizeInstanceIdentifier(opts.instanceIdentifier);if(this.isInitialized(normalizedIdentifier))throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const instance=this.getOrInitializeService({instanceIdentifier:normalizedIdentifier,options});for(const[instanceIdentifier,instanceDeferred]of this.instancesDeferred.entries()){normalizedIdentifier===this.normalizeInstanceIdentifier(instanceIdentifier)&&instanceDeferred.resolve(instance)}return instance}onInit(callback,identifier){const normalizedIdentifier=this.normalizeInstanceIdentifier(identifier),existingCallbacks=this.onInitCallbacks.get(normalizedIdentifier)??new Set;existingCallbacks.add(callback),this.onInitCallbacks.set(normalizedIdentifier,existingCallbacks);const existingInstance=this.instances.get(normalizedIdentifier);return existingInstance&&callback(existingInstance,normalizedIdentifier),()=>{existingCallbacks.delete(callback)}}invokeOnInitCallbacks(instance,identifier){const callbacks=this.onInitCallbacks.get(identifier);if(callbacks)for(const callback of callbacks)try{callback(instance,identifier)}catch{}}getOrInitializeService({instanceIdentifier,options={}}){let instance=this.instances.get(instanceIdentifier);if(!instance&&this.component&&(instance=this.component.instanceFactory(this.container,{instanceIdentifier:(identifier=instanceIdentifier,"[DEFAULT]"===identifier?void 0:identifier),options}),this.instances.set(instanceIdentifier,instance),this.instancesOptions.set(instanceIdentifier,options),this.invokeOnInitCallbacks(instance,instanceIdentifier),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,instanceIdentifier,instance)}catch{}var identifier;return instance||null}normalizeInstanceIdentifier(identifier="[DEFAULT]"){return this.component?this.component.multipleInstances?identifier:"[DEFAULT]":identifier}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ComponentContainer{constructor(name){this.name=name,this.providers=new Map}addComponent(component){const provider=this.getProvider(component.name);if(provider.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);provider.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)}getProvider(name){if(this.providers.has(name))return this.providers.get(name);const provider=new Provider(name,this);return this.providers.set(name,provider),provider}getProviders(){return Array.from(this.providers.values())}}},"./node_modules/@firebase/logger/dist/esm/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$b:()=>LogLevel,Vy:()=>Logger});const instances=[];var LogLevel;!function(LogLevel){LogLevel[LogLevel.DEBUG=0]="DEBUG",LogLevel[LogLevel.VERBOSE=1]="VERBOSE",LogLevel[LogLevel.INFO=2]="INFO",LogLevel[LogLevel.WARN=3]="WARN",LogLevel[LogLevel.ERROR=4]="ERROR",LogLevel[LogLevel.SILENT=5]="SILENT"}(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(instance,logType,...args)=>{if(logType<instance.logLevel)return;const now=(new Date).toISOString(),method=ConsoleMethod[logType];if(!method)throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);console[method](`[${now}]  ${instance.name}:`,...args)};class Logger{constructor(name){this.name=name,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null,instances.push(this)}get logLevel(){return this._logLevel}set logLevel(val){if(!(val in LogLevel))throw new TypeError(`Invalid value "${val}" assigned to \`logLevel\``);this._logLevel=val}setLogLevel(val){this._logLevel="string"==typeof val?levelStringToEnum[val]:val}get logHandler(){return this._logHandler}set logHandler(val){if("function"!=typeof val)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=val}get userLogHandler(){return this._userLogHandler}set userLogHandler(val){this._userLogHandler=val}debug(...args){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...args),this._logHandler(this,LogLevel.DEBUG,...args)}log(...args){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...args),this._logHandler(this,LogLevel.VERBOSE,...args)}info(...args){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...args),this._logHandler(this,LogLevel.INFO,...args)}warn(...args){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...args),this._logHandler(this,LogLevel.WARN,...args)}error(...args){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...args),this._logHandler(this,LogLevel.ERROR,...args)}}},"./node_modules/@firebase/util/dist/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{cY:()=>Deferred,FA:()=>ErrorFactory,g:()=>FirebaseError,u:()=>base64Decode,Uj:()=>base64urlEncodeWithoutPadding,Fy:()=>createMockUserToken,bD:()=>deepEqual,T9:()=>getDefaultAppConfig,yU:()=>getDefaultEmulatorHostnameAndPort,mS:()=>getGlobal,Ku:()=>getModularInstance,ZQ:()=>getUA,zJ:()=>isCloudWorkstation,zW:()=>isIndexedDBAvailable,nr:()=>isSafari,Ov:()=>isSafariOrWebkit,gE:()=>pingServer,P1:()=>updateEmulatorBanner,eX:()=>validateIndexedDBOpenable});const stringToByteArray$1=function(str){const out=[];let p=0;for(let i=0;i<str.length;i++){let c=str.charCodeAt(i);c<128?out[p++]=c:c<2048?(out[p++]=c>>6|192,out[p++]=63&c|128):55296==(64512&c)&&i+1<str.length&&56320==(64512&str.charCodeAt(i+1))?(c=65536+((1023&c)<<10)+(1023&str.charCodeAt(++i)),out[p++]=c>>18|240,out[p++]=c>>12&63|128,out[p++]=c>>6&63|128,out[p++]=63&c|128):(out[p++]=c>>12|224,out[p++]=c>>6&63|128,out[p++]=63&c|128)}return out},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,webSafe){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const byteToCharMap=webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i<input.length;i+=3){const byte1=input[i],haveByte2=i+1<input.length,byte2=haveByte2?input[i+1]:0,haveByte3=i+2<input.length,byte3=haveByte3?input[i+2]:0,outByte1=byte1>>2,outByte2=(3&byte1)<<4|byte2>>4;let outByte3=(15&byte2)<<2|byte3>>6,outByte4=63&byte3;haveByte3||(outByte4=64,haveByte2||(outByte3=64)),output.push(byteToCharMap[outByte1],byteToCharMap[outByte2],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join("")},encodeString(input,webSafe){return this.HAS_NATIVE_SUPPORT&&!webSafe?btoa(input):this.encodeByteArray(stringToByteArray$1(input),webSafe)},decodeString(input,webSafe){return this.HAS_NATIVE_SUPPORT&&!webSafe?atob(input):function(bytes){const out=[];let pos=0,c=0;for(;pos<bytes.length;){const c1=bytes[pos++];if(c1<128)out[c++]=String.fromCharCode(c1);else if(c1>191&&c1<224){const c2=bytes[pos++];out[c++]=String.fromCharCode((31&c1)<<6|63&c2)}else if(c1>239&&c1<365){const u=((7&c1)<<18|(63&bytes[pos++])<<12|(63&bytes[pos++])<<6|63&bytes[pos++])-65536;out[c++]=String.fromCharCode(55296+(u>>10)),out[c++]=String.fromCharCode(56320+(1023&u))}else{const c2=bytes[pos++],c3=bytes[pos++];out[c++]=String.fromCharCode((15&c1)<<12|(63&c2)<<6|63&c3)}}return out.join("")}(this.decodeStringToByteArray(input,webSafe))},decodeStringToByteArray(input,webSafe){this.init_();const charToByteMap=webSafe?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i<input.length;){const byte1=charToByteMap[input.charAt(i++)],byte2=i<input.length?charToByteMap[input.charAt(i)]:0;++i;const byte3=i<input.length?charToByteMap[input.charAt(i)]:64;++i;const byte4=i<input.length?charToByteMap[input.charAt(i)]:64;if(++i,null==byte1||null==byte2||null==byte3||null==byte4)throw new DecodeBase64StringError;const outByte1=byte1<<2|byte2>>4;if(output.push(outByte1),64!==byte3){const outByte2=byte2<<4&240|byte3>>2;if(output.push(outByte2),64!==byte4){const outByte3=byte3<<6&192|byte4;output.push(outByte3)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64urlEncodeWithoutPadding=function(str){return function(str){const utf8Bytes=stringToByteArray$1(str);return base64.encodeByteArray(utf8Bytes,!0)}(str).replace(/\./g,"")},base64Decode=function(str){try{return base64.decodeString(str,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function getGlobal(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==__webpack_require__.g)return __webpack_require__.g;throw new Error("Unable to locate global object.")}const getDefaults=()=>{try{return getGlobal().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const defaultsJsonString=process.env.__FIREBASE_DEFAULTS__;return defaultsJsonString?JSON.parse(defaultsJsonString):void 0})()||(()=>{if("undefined"==typeof document)return;let match;try{match=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const decoded=match&&base64Decode(match[1]);return decoded&&JSON.parse(decoded)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},getDefaultEmulatorHostnameAndPort=productName=>{const host=(productName=>getDefaults()?.emulatorHosts?.[productName])(productName);if(!host)return;const separatorIndex=host.lastIndexOf(":");if(separatorIndex<=0||separatorIndex+1===host.length)throw new Error(`Invalid host ${host} with no separate hostname and port!`);const port=parseInt(host.substring(separatorIndex+1),10);return"["===host[0]?[host.substring(1,separatorIndex-1),port]:[host.substring(0,separatorIndex),port]},getDefaultAppConfig=()=>getDefaults()?.config;class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((resolve,reject)=>{this.resolve=resolve,this.reject=reject}))}wrapCallback(callback){return(error,value)=>{error?this.reject(error):this.resolve(value),"function"==typeof callback&&(this.promise.catch((()=>{})),1===callback.length?callback(error):callback(error,value))}}}function isCloudWorkstation(url){try{return(url.startsWith("http://")||url.startsWith("https://")?new URL(url).hostname:url).endsWith(".cloudworkstations.dev")}catch{return!1}}async function pingServer(endpoint){return(await fetch(endpoint,{credentials:"include"})).ok}function createMockUserToken(token,projectId){if(token.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const project=projectId||"demo-project",iat=token.iat||0,sub=token.sub||token.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const payload={iss:`https://securetoken.google.com/${project}`,aud:project,iat,exp:iat+3600,auth_time:iat,sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}},...token};return[base64urlEncodeWithoutPadding(JSON.stringify({alg:"none",type:"JWT"})),base64urlEncodeWithoutPadding(JSON.stringify(payload)),""].join(".")}const emulatorStatus={};let previouslyDismissed=!1;function updateEmulatorBanner(name,isRunningEmulator){if("undefined"==typeof window||"undefined"==typeof document||!isCloudWorkstation(window.location.host)||emulatorStatus[name]===isRunningEmulator||emulatorStatus[name]||previouslyDismissed)return;function prefixedId(id){return`__firebase__banner__${id}`}emulatorStatus[name]=isRunningEmulator;const showError=function getEmulatorSummary(){const summary={prod:[],emulator:[]};for(const key of Object.keys(emulatorStatus))emulatorStatus[key]?summary.emulator.push(key):summary.prod.push(key);return summary}().prod.length>0;function setupCloseBtn(){const closeBtn=document.createElement("span");return closeBtn.style.cursor="pointer",closeBtn.style.marginLeft="16px",closeBtn.style.fontSize="24px",closeBtn.innerHTML=" &times;",closeBtn.onclick=()=>{previouslyDismissed=!0,function tearDown(){const element=document.getElementById("__firebase__banner");element&&element.remove()}()},closeBtn}function setupDom(){const banner=function getOrCreateEl(id){let parentDiv=document.getElementById(id),created=!1;return parentDiv||(parentDiv=document.createElement("div"),parentDiv.setAttribute("id",id),created=!0),{created,element:parentDiv}}("__firebase__banner"),firebaseTextId=prefixedId("text"),firebaseText=document.getElementById(firebaseTextId)||document.createElement("span"),learnMoreId=prefixedId("learnmore"),learnMoreLink=document.getElementById(learnMoreId)||document.createElement("a"),prependIconId=prefixedId("preprendIcon"),prependIcon=document.getElementById(prependIconId)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(banner.created){const bannerEl=banner.element;!function setupBannerStyles(bannerEl){bannerEl.style.display="flex",bannerEl.style.background="#7faaf0",bannerEl.style.position="fixed",bannerEl.style.bottom="5px",bannerEl.style.left="5px",bannerEl.style.padding=".5em",bannerEl.style.borderRadius="5px",bannerEl.style.alignItems="center"}(bannerEl),function setupLinkStyles(learnMoreLink,learnMoreId){learnMoreLink.setAttribute("id",learnMoreId),learnMoreLink.innerText="Learn more",learnMoreLink.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",learnMoreLink.setAttribute("target","__blank"),learnMoreLink.style.paddingLeft="5px",learnMoreLink.style.textDecoration="underline"}(learnMoreLink,learnMoreId);const closeBtn=setupCloseBtn();!function setupIconStyles(prependIcon,iconId){prependIcon.setAttribute("width","24"),prependIcon.setAttribute("id",iconId),prependIcon.setAttribute("height","24"),prependIcon.setAttribute("viewBox","0 0 24 24"),prependIcon.setAttribute("fill","none"),prependIcon.style.marginLeft="-6px"}(prependIcon,prependIconId),bannerEl.append(prependIcon,firebaseText,learnMoreLink,closeBtn),document.body.appendChild(bannerEl)}showError?(firebaseText.innerText="Preview backend disconnected.",prependIcon.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(prependIcon.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',firebaseText.innerText="Preview backend running in this workspace."),firebaseText.setAttribute("id",firebaseTextId)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",setupDom):setupDom()}function getUA(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function isNode(){const forceEnvironment=getDefaults()?.forceEnvironment;if("node"===forceEnvironment)return!0;if("browser"===forceEnvironment)return!1;try{return"[object process]"===Object.prototype.toString.call(__webpack_require__.g.process)}catch(e){return!1}}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isSafariOrWebkit(){return!isNode()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return"object"==typeof indexedDB}catch(e){return!1}}function validateIndexedDBOpenable(){return new Promise(((resolve,reject)=>{try{let preExist=!0;const DB_CHECK_NAME="validate-browser-context-for-indexeddb-analytics-module",request=self.indexedDB.open(DB_CHECK_NAME);request.onsuccess=()=>{request.result.close(),preExist||self.indexedDB.deleteDatabase(DB_CHECK_NAME),resolve(!0)},request.onupgradeneeded=()=>{preExist=!1},request.onerror=()=>{reject(request.error?.message||"")}}catch(error){reject(error)}}))}class FirebaseError extends Error{constructor(code,message,customData){super(message),this.code=code,this.customData=customData,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(service,serviceName,errors){this.service=service,this.serviceName=serviceName,this.errors=errors}create(code,...data){const customData=data[0]||{},fullCode=`${this.service}/${code}`,template=this.errors[code],message=template?function replaceTemplate(template,data){return template.replace(PATTERN,((_,key)=>{const value=data[key];return null!=value?String(value):`<${key}?>`}))}(template,customData):"Error",fullMessage=`${this.serviceName}: ${message} (${fullCode}).`;return new FirebaseError(fullCode,fullMessage,customData)}}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(a,b){if(a===b)return!0;const aKeys=Object.keys(a),bKeys=Object.keys(b);for(const k of aKeys){if(!bKeys.includes(k))return!1;const aProp=a[k],bProp=b[k];if(isObject(aProp)&&isObject(bProp)){if(!deepEqual(aProp,bProp))return!1}else if(aProp!==bProp)return!1}for(const k of bKeys)if(!aKeys.includes(k))return!1;return!0}function isObject(thing){return null!==thing&&"object"==typeof thing}function getModularInstance(service){return service&&service._delegate?service._delegate:service}},"./node_modules/firebase/app/dist/esm/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Wp:()=>_firebase_app__WEBPACK_IMPORTED_MODULE_0__.Wp});var _firebase_app__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@firebase/app/dist/esm/index.esm.js");(0,_firebase_app__WEBPACK_IMPORTED_MODULE_0__.KO)("firebase","12.5.0","app")},"./node_modules/firebase/firestore/dist/esm/index.esm.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H9:()=>doc,x7:()=>getDoc,aU:()=>getFirestore,mZ:()=>updateDoc});var Integer,Md5,index_esm=__webpack_require__("./node_modules/@firebase/app/dist/esm/index.esm.js"),esm_index_esm=__webpack_require__("./node_modules/@firebase/component/dist/esm/index.esm.js"),dist_esm_index_esm=__webpack_require__("./node_modules/@firebase/logger/dist/esm/index.esm.js"),dist_index_esm=__webpack_require__("./node_modules/@firebase/util/dist/index.esm.js"),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},bloom_blob_es2018={};(function(){var h;function m(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(d,a,c){c||(c=0);const f=Array(16);if("string"==typeof a)for(var e=0;e<16;++e)f[e]=a.charCodeAt(c++)|a.charCodeAt(c++)<<8|a.charCodeAt(c++)<<16|a.charCodeAt(c++)<<24;else for(e=0;e<16;++e)f[e]=a[c++]|a[c++]<<8|a[c++]<<16|a[c++]<<24;a=d.g[0],c=d.g[1],e=d.g[2];let b,g=d.g[3];b=a+(g^c&(e^g))+f[0]+3614090360&4294967295,b=g+(e^(a=c+(b<<7&4294967295|b>>>25))&(c^e))+f[1]+3905402710&4294967295,g=a+(b<<12&4294967295|b>>>20),b=e+(c^g&(a^c))+f[2]+606105819&4294967295,b=c+(a^(e=g+(b<<17&4294967295|b>>>15))&(g^a))+f[3]+3250441966&4294967295,b=a+(g^(c=e+(b<<22&4294967295|b>>>10))&(e^g))+f[4]+4118548399&4294967295,b=g+(e^(a=c+(b<<7&4294967295|b>>>25))&(c^e))+f[5]+1200080426&4294967295,g=a+(b<<12&4294967295|b>>>20),b=e+(c^g&(a^c))+f[6]+2821735955&4294967295,b=c+(a^(e=g+(b<<17&4294967295|b>>>15))&(g^a))+f[7]+4249261313&4294967295,b=a+(g^(c=e+(b<<22&4294967295|b>>>10))&(e^g))+f[8]+1770035416&4294967295,b=g+(e^(a=c+(b<<7&4294967295|b>>>25))&(c^e))+f[9]+2336552879&4294967295,g=a+(b<<12&4294967295|b>>>20),b=e+(c^g&(a^c))+f[10]+4294925233&4294967295,b=c+(a^(e=g+(b<<17&4294967295|b>>>15))&(g^a))+f[11]+2304563134&4294967295,b=a+(g^(c=e+(b<<22&4294967295|b>>>10))&(e^g))+f[12]+1804603682&4294967295,b=g+(e^(a=c+(b<<7&4294967295|b>>>25))&(c^e))+f[13]+4254626195&4294967295,g=a+(b<<12&4294967295|b>>>20),b=e+(c^g&(a^c))+f[14]+2792965006&4294967295,b=c+(a^(e=g+(b<<17&4294967295|b>>>15))&(g^a))+f[15]+1236535329&4294967295,b=a+(e^g&((c=e+(b<<22&4294967295|b>>>10))^e))+f[1]+4129170786&4294967295,b=g+(c^e&((a=c+(b<<5&4294967295|b>>>27))^c))+f[6]+3225465664&4294967295,g=a+(b<<9&4294967295|b>>>23),b=e+(a^c&(g^a))+f[11]+643717713&4294967295,b=c+(g^a&((e=g+(b<<14&4294967295|b>>>18))^g))+f[0]+3921069994&4294967295,b=a+(e^g&((c=e+(b<<20&4294967295|b>>>12))^e))+f[5]+3593408605&4294967295,b=g+(c^e&((a=c+(b<<5&4294967295|b>>>27))^c))+f[10]+38016083&4294967295,g=a+(b<<9&4294967295|b>>>23),b=e+(a^c&(g^a))+f[15]+3634488961&4294967295,b=c+(g^a&((e=g+(b<<14&4294967295|b>>>18))^g))+f[4]+3889429448&4294967295,b=a+(e^g&((c=e+(b<<20&4294967295|b>>>12))^e))+f[9]+568446438&4294967295,b=g+(c^e&((a=c+(b<<5&4294967295|b>>>27))^c))+f[14]+3275163606&4294967295,g=a+(b<<9&4294967295|b>>>23),b=e+(a^c&(g^a))+f[3]+4107603335&4294967295,b=c+(g^a&((e=g+(b<<14&4294967295|b>>>18))^g))+f[8]+1163531501&4294967295,b=a+(e^g&((c=e+(b<<20&4294967295|b>>>12))^e))+f[13]+2850285829&4294967295,b=g+(c^e&((a=c+(b<<5&4294967295|b>>>27))^c))+f[2]+4243563512&4294967295,g=a+(b<<9&4294967295|b>>>23),b=e+(a^c&(g^a))+f[7]+1735328473&4294967295,b=c+(g^a&((e=g+(b<<14&4294967295|b>>>18))^g))+f[12]+2368359562&4294967295,b=a+((c=e+(b<<20&4294967295|b>>>12))^e^g)+f[5]+4294588738&4294967295,b=g+((a=c+(b<<4&4294967295|b>>>28))^c^e)+f[8]+2272392833&4294967295,g=a+(b<<11&4294967295|b>>>21),b=e+(g^a^c)+f[11]+1839030562&4294967295,b=c+((e=g+(b<<16&4294967295|b>>>16))^g^a)+f[14]+4259657740&4294967295,b=a+((c=e+(b<<23&4294967295|b>>>9))^e^g)+f[1]+2763975236&4294967295,b=g+((a=c+(b<<4&4294967295|b>>>28))^c^e)+f[4]+1272893353&4294967295,g=a+(b<<11&4294967295|b>>>21),b=e+(g^a^c)+f[7]+4139469664&4294967295,b=c+((e=g+(b<<16&4294967295|b>>>16))^g^a)+f[10]+3200236656&4294967295,b=a+((c=e+(b<<23&4294967295|b>>>9))^e^g)+f[13]+681279174&4294967295,b=g+((a=c+(b<<4&4294967295|b>>>28))^c^e)+f[0]+3936430074&4294967295,g=a+(b<<11&4294967295|b>>>21),b=e+(g^a^c)+f[3]+3572445317&4294967295,b=c+((e=g+(b<<16&4294967295|b>>>16))^g^a)+f[6]+76029189&4294967295,b=a+((c=e+(b<<23&4294967295|b>>>9))^e^g)+f[9]+3654602809&4294967295,b=g+((a=c+(b<<4&4294967295|b>>>28))^c^e)+f[12]+3873151461&4294967295,g=a+(b<<11&4294967295|b>>>21),b=e+(g^a^c)+f[15]+530742520&4294967295,b=c+((e=g+(b<<16&4294967295|b>>>16))^g^a)+f[2]+3299628645&4294967295,b=a+(e^((c=e+(b<<23&4294967295|b>>>9))|~g))+f[0]+4096336452&4294967295,b=g+(c^((a=c+(b<<6&4294967295|b>>>26))|~e))+f[7]+1126891415&4294967295,g=a+(b<<10&4294967295|b>>>22),b=e+(a^(g|~c))+f[14]+2878612391&4294967295,b=c+(g^((e=g+(b<<15&4294967295|b>>>17))|~a))+f[5]+4237533241&4294967295,b=a+(e^((c=e+(b<<21&4294967295|b>>>11))|~g))+f[12]+1700485571&4294967295,b=g+(c^((a=c+(b<<6&4294967295|b>>>26))|~e))+f[3]+2399980690&4294967295,g=a+(b<<10&4294967295|b>>>22),b=e+(a^(g|~c))+f[10]+4293915773&4294967295,b=c+(g^((e=g+(b<<15&4294967295|b>>>17))|~a))+f[1]+2240044497&4294967295,b=a+(e^((c=e+(b<<21&4294967295|b>>>11))|~g))+f[8]+1873313359&4294967295,b=g+(c^((a=c+(b<<6&4294967295|b>>>26))|~e))+f[15]+4264355552&4294967295,g=a+(b<<10&4294967295|b>>>22),b=e+(a^(g|~c))+f[6]+2734768916&4294967295,b=c+(g^((e=g+(b<<15&4294967295|b>>>17))|~a))+f[13]+1309151649&4294967295,b=a+(e^((c=e+(b<<21&4294967295|b>>>11))|~g))+f[4]+4149444226&4294967295,b=g+(c^((a=c+(b<<6&4294967295|b>>>26))|~e))+f[11]+3174756917&4294967295,g=a+(b<<10&4294967295|b>>>22),b=e+(a^(g|~c))+f[2]+718787259&4294967295,b=c+(g^((e=g+(b<<15&4294967295|b>>>17))|~a))+f[9]+3951481745&4294967295,d.g[0]=d.g[0]+a&4294967295,d.g[1]=d.g[1]+(e+(b<<21&4294967295|b>>>11))&4294967295,d.g[2]=d.g[2]+e&4294967295,d.g[3]=d.g[3]+g&4294967295}function t(d,a){this.h=a;const c=[];let f=!0;for(let e=d.length-1;e>=0;e--){const g=0|d[e];f&&g==a||(c[e]=g,f=!1)}this.g=c}!function k(d,a){function c(){}c.prototype=a.prototype,d.F=a.prototype,d.prototype=new c,d.prototype.constructor=d,d.D=function(f,e,g){for(var b=Array(arguments.length-2),r=2;r<arguments.length;r++)b[r-2]=arguments[r];return a.prototype[e].apply(f,b)}}(m,(function l(){this.blockSize=-1})),m.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},m.prototype.v=function(d,a){void 0===a&&(a=d.length);const c=a-this.blockSize,f=this.C;let e=this.h,g=0;for(;g<a;){if(0==e)for(;g<=c;)n(this,d,g),g+=this.blockSize;if("string"==typeof d){for(;g<a;)if(f[e++]=d.charCodeAt(g++),e==this.blockSize){n(this,f),e=0;break}}else for(;g<a;)if(f[e++]=d[g++],e==this.blockSize){n(this,f),e=0;break}}this.h=e,this.o+=a},m.prototype.A=function(){var d=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);d[0]=128;for(var a=1;a<d.length-8;++a)d[a]=0;a=8*this.o;for(var c=d.length-8;c<d.length;++c)d[c]=255&a,a/=256;for(this.v(d),d=Array(16),a=0,c=0;c<4;++c)for(let f=0;f<32;f+=8)d[a++]=this.g[c]>>>f&255;return d};var q={};function u(d){return-128<=d&&d<128?function p(d,a){var c=q;return Object.prototype.hasOwnProperty.call(c,d)?c[d]:c[d]=a(d)}(d,(function(a){return new t([0|a],a<0?-1:0)})):new t([0|d],d<0?-1:0)}function v(d){if(isNaN(d)||!isFinite(d))return w;if(d<0)return x(v(-d));const a=[];let c=1;for(let f=0;d>=c;f++)a[f]=d/c|0,c*=4294967296;return new t(a,0)}var w=u(0),z=u(1),A=u(16777216);function C(d){if(0!=d.h)return!1;for(let a=0;a<d.g.length;a++)if(0!=d.g[a])return!1;return!0}function B(d){return-1==d.h}function x(d){const a=d.g.length,c=[];for(let f=0;f<a;f++)c[f]=~d.g[f];return new t(c,~d.h).add(z)}function F(d,a){return d.add(x(a))}function G(d,a){for(;(65535&d[a])!=d[a];)d[a+1]+=d[a]>>>16,d[a]&=65535,a++}function H(d,a){this.g=d,this.h=a}function D(d,a){if(C(a))throw Error("division by zero");if(C(d))return new H(w,w);if(B(d))return a=D(x(d),a),new H(x(a.g),x(a.h));if(B(a))return a=D(d,x(a)),new H(x(a.g),a.h);if(d.g.length>30){if(B(d)||B(a))throw Error("slowDivide_ only works with positive integers.");for(var c=z,f=a;f.l(d)<=0;)c=I(c),f=I(f);var e=J(c,1),g=J(f,1);for(f=J(f,2),c=J(c,2);!C(f);){var b=g.add(f);b.l(d)<=0&&(e=e.add(c),g=b),f=J(f,1),c=J(c,1)}return a=F(d,e.j(a)),new H(e,a)}for(e=w;d.l(a)>=0;){for(c=Math.max(1,Math.floor(d.m()/a.m())),f=(f=Math.ceil(Math.log(c)/Math.LN2))<=48?1:Math.pow(2,f-48),b=(g=v(c)).j(a);B(b)||b.l(d)>0;)b=(g=v(c-=f)).j(a);C(g)&&(g=z),e=e.add(g),d=F(d,b)}return new H(e,d)}function I(d){const a=d.g.length+1,c=[];for(let f=0;f<a;f++)c[f]=d.i(f)<<1|d.i(f-1)>>>31;return new t(c,d.h)}function J(d,a){const c=a>>5;a%=32;const f=d.g.length-c,e=[];for(let g=0;g<f;g++)e[g]=a>0?d.i(g+c)>>>a|d.i(g+c+1)<<32-a:d.i(g+c);return new t(e,d.h)}(h=t.prototype).m=function(){if(B(this))return-x(this).m();let d=0,a=1;for(let c=0;c<this.g.length;c++){const f=this.i(c);d+=(f>=0?f:4294967296+f)*a,a*=4294967296}return d},h.toString=function(d){if((d=d||10)<2||36<d)throw Error("radix out of range: "+d);if(C(this))return"0";if(B(this))return"-"+x(this).toString(d);const a=v(Math.pow(d,6));var c=this;let f="";for(;;){const e=D(c,a).g;let g=(((c=F(c,e.j(a))).g.length>0?c.g[0]:c.h)>>>0).toString(d);if(C(c=e))return g+f;for(;g.length<6;)g="0"+g;f=g+f}},h.i=function(d){return d<0?0:d<this.g.length?this.g[d]:this.h},h.l=function(d){return B(d=F(this,d))?-1:C(d)?0:1},h.abs=function(){return B(this)?x(this):this},h.add=function(d){const a=Math.max(this.g.length,d.g.length),c=[];let f=0;for(let e=0;e<=a;e++){let g=f+(65535&this.i(e))+(65535&d.i(e)),b=(g>>>16)+(this.i(e)>>>16)+(d.i(e)>>>16);f=b>>>16,g&=65535,b&=65535,c[e]=b<<16|g}return new t(c,-2147483648&c[c.length-1]?-1:0)},h.j=function(d){if(C(this)||C(d))return w;if(B(this))return B(d)?x(this).j(x(d)):x(x(this).j(d));if(B(d))return x(this.j(x(d)));if(this.l(A)<0&&d.l(A)<0)return v(this.m()*d.m());const a=this.g.length+d.g.length,c=[];for(var f=0;f<2*a;f++)c[f]=0;for(f=0;f<this.g.length;f++)for(let e=0;e<d.g.length;e++){const g=this.i(f)>>>16,b=65535&this.i(f),r=d.i(e)>>>16,E=65535&d.i(e);c[2*f+2*e]+=b*E,G(c,2*f+2*e),c[2*f+2*e+1]+=g*E,G(c,2*f+2*e+1),c[2*f+2*e+1]+=b*r,G(c,2*f+2*e+1),c[2*f+2*e+2]+=g*r,G(c,2*f+2*e+2)}for(d=0;d<a;d++)c[d]=c[2*d+1]<<16|c[2*d];for(d=a;d<2*a;d++)c[d]=0;return new t(c,0)},h.B=function(d){return D(this,d).h},h.and=function(d){const a=Math.max(this.g.length,d.g.length),c=[];for(let f=0;f<a;f++)c[f]=this.i(f)&d.i(f);return new t(c,this.h&d.h)},h.or=function(d){const a=Math.max(this.g.length,d.g.length),c=[];for(let f=0;f<a;f++)c[f]=this.i(f)|d.i(f);return new t(c,this.h|d.h)},h.xor=function(d){const a=Math.max(this.g.length,d.g.length),c=[];for(let f=0;f<a;f++)c[f]=this.i(f)^d.i(f);return new t(c,this.h^d.h)},m.prototype.digest=m.prototype.A,m.prototype.reset=m.prototype.u,m.prototype.update=m.prototype.v,Md5=bloom_blob_es2018.Md5=m,t.prototype.add=t.prototype.add,t.prototype.multiply=t.prototype.j,t.prototype.modulo=t.prototype.B,t.prototype.compare=t.prototype.l,t.prototype.toNumber=t.prototype.m,t.prototype.toString=t.prototype.toString,t.prototype.getBits=t.prototype.i,t.fromNumber=v,t.fromString=function y(d,a){if(0==d.length)throw Error("number format error: empty string");if((a=a||10)<2||36<a)throw Error("radix out of range: "+a);if("-"==d.charAt(0))return x(y(d.substring(1),a));if(d.indexOf("-")>=0)throw Error('number format error: interior "-" character');const c=v(Math.pow(a,8));let f=w;for(let g=0;g<d.length;g+=8){var e=Math.min(8,d.length-g);const b=parseInt(d.substring(g,g+e),a);e<8?(e=v(Math.pow(a,e)),f=f.j(e).add(v(b))):(f=f.j(c),f=f.add(v(b)))}return f},Integer=bloom_blob_es2018.Integer=t}).apply(void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var XhrIo,WebChannel,EventType,ErrorCode,Stat,Event,getStatEventTarget,createWebChannelTransport,webchannel_blob_es2018_commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},webchannel_blob_es2018={};(function(){var h,aa=Object.defineProperty;var ca=function ba(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof webchannel_blob_es2018_commonjsGlobal&&webchannel_blob_es2018_commonjsGlobal];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object")}(this);function da(a,b){if(b)a:{var c=ca;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}(b=b(d=c[a=a[a.length-1]]))!=d&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}da("Symbol.dispose",(function(a){return a||Symbol("Symbol.dispose")})),da("Array.prototype.values",(function(a){return a||function(){return this[Symbol.iterator]()}})),da("Object.entries",(function(a){return a||function(b){var d,c=[];for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&c.push([d,b[d]]);return c}}));var ea=ea||{},l=this||self;function n(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}function fa(a,b,c){return a.call.apply(a.bind,arguments)}function p(a,b,c){return(p=fa).apply(null,arguments)}function ha(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();return d.push.apply(d,arguments),a.apply(this,d)}}function t(a,b){function c(){}c.prototype=b.prototype,a.Z=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.Ob=function(d,e,f){for(var g=Array(arguments.length-2),k=2;k<arguments.length;k++)g[k-2]=arguments[k];return b.prototype[e].apply(d,g)}}var ia="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?a=>a&&AsyncContext.Snapshot.wrap(a):a=>a;function ja(a){const b=a.length;if(b>0){const c=Array(b);for(let d=0;d<b;d++)c[d]=a[d];return c}return[]}function ka(a,b){for(let d=1;d<arguments.length;d++){const e=arguments[d];var c=typeof e;if("array"==(c="object"!=c?c:e?Array.isArray(e)?"array":c:"null")||"object"==c&&"number"==typeof e.length){c=a.length||0;const f=e.length||0;a.length=c+f;for(let g=0;g<f;g++)a[c+g]=e[g]}else a.push(e)}}function ma(a){l.setTimeout((()=>{throw a}),0)}function na(){var a=oa;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var qa=new class la{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return this.h>0?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new ra),(a=>a.reset()));class ra{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let u,v=!1,oa=new class pa{constructor(){this.h=this.g=null}add(a,b){const c=qa.get();c.set(a,b),this.h?this.h.next=c:this.g=c,this.h=c}},ta=()=>{const a=Promise.resolve(void 0);u=()=>{a.then(sa)}};function sa(){for(var a;a=na();){try{a.h.call(a.g)}catch(c){ma(c)}var b=qa;b.j(a),b.h<100&&(b.h++,a.next=b.g,b.g=a)}v=!1}function w(){this.u=this.u,this.C=this.C}function x(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}w.prototype.u=!1,w.prototype.dispose=function(){this.u||(this.u=!0,this.N())},w.prototype[Symbol.dispose]=function(){this.dispose()},w.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},x.prototype.h=function(){this.defaultPrevented=!0};var ua=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{const c=()=>{};l.addEventListener("test",c,b),l.removeEventListener("test",c,b)}catch(c){}return a}();function y(a){return/^[\s\xa0]*$/.test(a)}function z(a,b){x.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a&&this.init(a,b)}t(z,x),z.prototype.init=function(a,b){const c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement,this.g=b,(b=a.relatedTarget)||("mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement)),this.relatedTarget=b,d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=a.pointerType,this.state=a.state,this.i=a,a.defaultPrevented&&z.Z.h.call(this)},z.prototype.h=function(){z.Z.h.call(this);const a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var B="closure_listenable_"+(1e6*Math.random()|0),va=0;function wa(a,b,c,d,e){this.listener=a,this.proxy=null,this.src=b,this.type=c,this.capture=!!d,this.ha=e,this.key=++va,this.da=this.fa=!1}function xa(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ya(a,b,c){for(const d in a)b.call(c,a[d],d,a)}function Ba(a){const b={};for(const c in a)b[c]=a[c];return b}const Ca="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Da(a,b){let c,d;for(let e=1;e<arguments.length;e++){for(c in d=arguments[e],d)a[c]=d[c];for(let f=0;f<Ca.length;f++)c=Ca[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Ea(a){this.src=a,this.g={},this.h=0}function Ga(a,b){const c=b.type;if(c in a.g){var f,d=a.g[c],e=Array.prototype.indexOf.call(d,b,void 0);(f=e>=0)&&Array.prototype.splice.call(d,e,1),f&&(xa(b),0==a.g[c].length&&(delete a.g[c],a.h--))}}function Fa(a,b,c,d){for(let e=0;e<a.length;++e){const f=a[e];if(!f.da&&f.listener==b&&f.capture==!!c&&f.ha==d)return e}return-1}Ea.prototype.add=function(a,b,c,d,e){const f=a.toString();(a=this.g[f])||(a=this.g[f]=[],this.h++);const g=Fa(a,b,d,e);return g>-1?(b=a[g],c||(b.fa=!1)):((b=new wa(b,this.src,f,!!d,e)).fa=c,a.push(b)),b};var Ha="closure_lm_"+(1e6*Math.random()|0),Ia={};function Ka(a,b,c,d,e){if(d&&d.once)return La(a,b,c,d,e);if(Array.isArray(b)){for(let f=0;f<b.length;f++)Ka(a,b[f],c,d,e);return null}return c=Ma(c),a&&a[B]?a.J(b,c,n(d)?!!d.capture:!!d,e):Na(a,b,c,!1,d,e)}function Na(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");const g=n(e)?!!e.capture:!!e;let k=Oa(a);if(k||(a[Ha]=k=new Ea(a)),(c=k.add(b,c,d,g,f)).proxy)return c;if(d=function Pa(){function a(c){return b.call(a.src,a.listener,c)}const b=Ra;return a}(),c.proxy=d,d.src=a,d.listener=c,a.addEventListener)ua||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(Qa(b.toString()),d);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(d)}return c}function La(a,b,c,d,e){if(Array.isArray(b)){for(let f=0;f<b.length;f++)La(a,b[f],c,d,e);return null}return c=Ma(c),a&&a[B]?a.K(b,c,n(d)?!!d.capture:!!d,e):Na(a,b,c,!0,d,e)}function Sa(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)Sa(a,b[f],c,d,e);else d=n(d)?!!d.capture:!!d,c=Ma(c),a&&a[B]?(a=a.i,(f=String(b).toString())in a.g&&((c=Fa(b=a.g[f],c,d,e))>-1&&(xa(b[c]),Array.prototype.splice.call(b,c,1),0==b.length&&(delete a.g[f],a.h--)))):a&&(a=Oa(a))&&(b=a.g[b.toString()],a=-1,b&&(a=Fa(b,c,d,e)),(c=a>-1?b[a]:null)&&Ta(c))}function Ta(a){if("number"!=typeof a&&a&&!a.da){var b=a.src;if(b&&b[B])Ga(b.i,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(Qa(c),d):b.addListener&&b.removeListener&&b.removeListener(d),(c=Oa(b))?(Ga(c,a),0==c.h&&(c.src=null,b[Ha]=null)):xa(a)}}}function Qa(a){return a in Ia?Ia[a]:Ia[a]="on"+a}function Ra(a,b){if(a.da)a=!0;else{b=new z(b,this);const c=a.listener,d=a.ha||a.src;a.fa&&Ta(a),a=c.call(d,b)}return a}function Oa(a){return(a=a[Ha])instanceof Ea?a:null}var Ua="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ma(a){return"function"==typeof a?a:(a[Ua]||(a[Ua]=function(b){return a.handleEvent(b)}),a[Ua])}function C(){w.call(this),this.i=new Ea(this),this.M=this,this.G=null}function D(a,b){var c,d=a.G;if(d)for(c=[];d;d=d.G)c.push(d);if(a=a.M,d=b.type||b,"string"==typeof b)b=new x(b,a);else if(b instanceof x)b.target=b.target||a;else{var e=b;Da(b=new x(d,a),e)}let f,g;if(e=!0,c)for(g=c.length-1;g>=0;g--)f=b.g=c[g],e=Va(f,d,!0,b)&&e;if(f=b.g=a,e=Va(f,d,!0,b)&&e,e=Va(f,d,!1,b)&&e,c)for(g=0;g<c.length;g++)f=b.g=c[g],e=Va(f,d,!1,b)&&e}function Va(a,b,c,d){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();let e=!0;for(let f=0;f<b.length;++f){const g=b[f];if(g&&!g.da&&g.capture==c){const k=g.listener,q=g.ha||g.src;g.fa&&Ga(a.i,g),e=!1!==k.call(q,d)&&e}}return e&&!d.defaultPrevented}function Xa(a){a.g=function Wa(a,b){if("function"!=typeof a){if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=p(a.handleEvent,a)}return Number(b)>2147483647?-1:l.setTimeout(a,b||0)}((()=>{a.g=null,a.i&&(a.i=!1,Xa(a))}),a.l);const b=a.h;a.h=null,a.m.apply(null,b)}t(C,w),C.prototype[B]=!0,C.prototype.removeEventListener=function(a,b,c,d){Sa(this,a,b,c,d)},C.prototype.N=function(){if(C.Z.N.call(this),this.i){var a=this.i;for(const c in a.g){const d=a.g[c];for(let e=0;e<d.length;e++)xa(d[e]);delete a.g[c],a.h--}}this.G=null},C.prototype.J=function(a,b,c,d){return this.i.add(String(a),b,!1,c,d)},C.prototype.K=function(a,b,c,d){return this.i.add(String(a),b,!0,c,d)};class Ya extends w{constructor(a,b){super(),this.m=a,this.l=b,this.h=null,this.i=!1,this.g=null}j(a){this.h=arguments,this.g?this.i=!0:Xa(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function E(a){w.call(this),this.h=a,this.g={}}t(E,w);var Za=[];function $a(a){ya(a.g,(function(b,c){this.g.hasOwnProperty(c)&&Ta(b)}),a),a.g={}}E.prototype.N=function(){E.Z.N.call(this),$a(this)},E.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ab=l.JSON.stringify,cb=l.JSON.parse,db=class{stringify(a){return l.JSON.stringify(a,void 0)}parse(a){return l.JSON.parse(a,void 0)}};function eb(){}function fb(){}var H={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function gb(){x.call(this,"d")}function hb(){x.call(this,"c")}t(gb,x),t(hb,x);var I={},ib=null;function jb(){return ib=ib||new C}function kb(a){x.call(this,I.Ia,a)}function lb(a){const b=jb();D(b,new kb(b))}function mb(a,b){x.call(this,I.STAT_EVENT,a),this.stat=b}function J(a){const b=jb();D(b,new mb(b,a))}function nb(a,b){x.call(this,I.Ja,a),this.size=b}function ob(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}function pb(){this.g=!0}function K(a,b,c,d){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function sb(a,b){if(!a.g)return b;if(!b)return null;try{const f=JSON.parse(b);if(f)for(a=0;a<f.length;a++)if(Array.isArray(f[a])){var c=f[a];if(!(c.length<2)){var d=c[1];if(Array.isArray(d)&&!(d.length<1)){var e=d[0];if("noop"!=e&&"stop"!=e&&"close"!=e)for(let g=1;g<d.length;g++)d[g]=""}}}return ab(f)}catch(f){return b}}(a,c)+(d?" "+d:"")}))}I.Ia="serverreachability",t(kb,x),I.STAT_EVENT="statevent",t(mb,x),I.Ja="timingevent",t(nb,x),pb.prototype.ua=function(){this.g=!1},pb.prototype.info=function(){};var wb,ub={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vb={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function xb(){}function L(a){return encodeURIComponent(String(a))}function yb(a){var b=1;a=a.split(":");const c=[];for(;b>0&&a.length;)c.push(a.shift()),b--;return a.length&&c.push(a.join(":")),c}function N(a,b,c,d){this.j=a,this.i=b,this.l=c,this.S=d||1,this.V=new E(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new zb}function zb(){this.i=null,this.g="",this.h=!1}t(xb,eb),xb.prototype.g=function(){return new XMLHttpRequest},wb=new xb;var Ab={},Bb={};function Cb(a,b,c){a.M=1,a.A=Db(O(b)),a.u=c,a.R=!0,Eb(a,null)}function Eb(a,b){a.F=Date.now(),Fb(a),a.B=O(a.A);var c=a.B,d=a.S;Array.isArray(d)||(d=[String(d)]),Gb(c.i,"t",d),a.C=0,c=a.j.L,a.h=new zb,a.g=Hb(a.j,c?b:null,!a.u),a.P>0&&(a.O=new Ya(p(a.Y,a,a.g),a.P)),b=a.V,c=a.g,d=a.ba;var e="readystatechange";Array.isArray(e)||(e&&(Za[0]=e.toString()),e=Za);for(let f=0;f<e.length;f++){const g=Ka(c,e[f],d||b.handleEvent,!1,b.h||b);if(!g)break;b.g[g.key]=g}b=a.J?Ba(a.J):{},a.u?(a.v||(a.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.B,a.v,a.u,b)):(a.v="GET",a.g.ea(a.B,a.v,null,b)),lb(),function qb(a,b,c,d,e,f){a.info((function(){if(a.g)if(f){var g="",k=f.split("&");for(let m=0;m<k.length;m++){var q=k[m].split("=");if(q.length>1){const r=q[0];q=q[1];const A=r.split("_");g=A.length>=2&&"type"==A[1]?g+(r+"=")+q+"&":g+(r+"=redacted&")}}}else g=null;else g=f;return"XMLHTTP REQ ("+d+") [attempt "+e+"]: "+b+"\n"+c+"\n"+g}))}(a.i,a.v,a.B,a.l,a.S,a.u)}function Ob(a){return!!a.g&&("GET"==a.v&&2!=a.M&&a.j.Aa)}function Nb(a,b){var c=a.C,d=b.indexOf("\n",c);return-1==d?Bb:(c=Number(b.substring(c,d)),isNaN(c)?Ab:(d+=1)+c>b.length?Bb:(b=b.slice(d,d+c),a.C=d+c,b))}function Fb(a){a.T=Date.now()+a.H,Sb(a,a.H)}function Sb(a,b){if(null!=a.D)throw Error("WatchDog timer not null");a.D=ob(p(a.aa,a),b)}function Jb(a){a.D&&(l.clearTimeout(a.D),a.D=null)}function Mb(a){0==a.j.I||a.K||Qb(a.j,a)}function Q(a){Jb(a);var b=a.O;b&&"function"==typeof b.dispose&&b.dispose(),a.O=null,$a(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.dispose())}function Lb(a,b){try{var c=a.j;if(0!=c.I&&(c.g==a||Tb(c.h,a)))if(!a.L&&Tb(c.h,a)&&3==c.I){try{var d=c.Ba.g.parse(b)}catch(m){d=null}if(Array.isArray(d)&&3==d.length){var e=d;if(0==e[0]){a:if(!c.v){if(c.g){if(!(c.g.F+3e3<a.F))break a;Ub(c),Vb(c)}Wb(c),J(18)}}else c.xa=e[1],0<c.xa-c.K&&e[2]<37500&&c.F&&0==c.A&&!c.C&&(c.C=ob(p(c.Va,c),6e3));Xb(c.h)<=1&&c.ta&&(c.ta=void 0)}else R(c,11)}else if((a.L||c.g==a)&&Ub(c),!y(b))for(e=c.Ba.g.parse(b),b=0;b<e.length;b++){let m=e[b];const r=m[0];if(!(r<=c.K))if(c.K=r,m=m[1],2==c.I)if("c"==m[0]){c.M=m[1],c.ba=m[2];const A=m[3];null!=A&&(c.ka=A,c.j.info("VER="+c.ka));const M=m[4];null!=M&&(c.za=M,c.j.info("SVER="+c.za));const F=m[5];null!=F&&"number"==typeof F&&F>0&&(d=1.5*F,c.O=d,c.j.info("backChannelRequestTimeoutMs_="+d)),d=c;const G=a.g;if(G){const za=G.g?G.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(za){var f=d.h;f.g||-1==za.indexOf("spdy")&&-1==za.indexOf("quic")&&-1==za.indexOf("h2")||(f.j=f.l,f.g=new Set,f.h&&(Yb(f,f.h),f.h=null))}if(d.G){const bb=G.g?G.g.getResponseHeader("X-HTTP-Session-Id"):null;bb&&(d.wa=bb,S(d.J,d.G,bb))}}c.I=3,c.l&&c.l.ra(),c.aa&&(c.T=Date.now()-a.F,c.j.info("Handshake RTT: "+c.T+"ms"));var g=a;if((d=c).na=Zb(d,d.L?d.ba:null,d.W),g.L){$b(d.h,g);var k=g,q=d.O;q&&(k.H=q),k.D&&(Jb(k),Fb(k)),d.g=g}else ac(d);c.i.length>0&&bc(c)}else"stop"!=m[0]&&"close"!=m[0]||R(c,7);else 3==c.I&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?R(c,7):cc(c):"noop"!=m[0]&&c.l&&c.l.qa(m),c.A=0)}lb()}catch(m){}}N.prototype.ba=function(a){a=a.target;const b=this.O;b&&3==P(a)?b.j():this.Y(a)},N.prototype.Y=function(a){try{if(a==this.g)a:{const k=P(this.g),q=this.g.ya();this.g.ca();if(!(k<3)&&(3!=k||this.g&&(this.h.h||this.g.la()||Ib(this.g)))){this.K||4!=k||7==q||lb(),Jb(this);var b=this.g.ca();this.X=b;var c=function Kb(a){if(!Ob(a))return a.g.la();const b=Ib(a.g);if(""===b)return"";let c="";const d=b.length,e=4==P(a.g);if(!a.h.i){if("undefined"==typeof TextDecoder)return Q(a),Mb(a),"";a.h.i=new l.TextDecoder}for(let f=0;f<d;f++)a.h.h=!0,c+=a.h.i.decode(b[f],{stream:!(e&&f==d-1)});return b.length=0,a.h.g+=c,a.C=0,a.h.g}(this);if(this.o=200==b,function rb(a,b,c,d,e,f,g){a.info((function(){return"XMLHTTP RESP ("+d+") [ attempt "+e+"]: "+b+"\n"+c+"\n"+f+" "+g}))}(this.i,this.v,this.B,this.l,this.S,k,b),this.o){if(this.U&&!this.L){b:{if(this.g){var d,e=this.g;if((d=e.g?e.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(d)){var f=d;break b}}f=null}if(!(a=f)){this.o=!1,this.m=3,J(12),Q(this),Mb(this);break a}K(this.i,this.l,a,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Lb(this,a)}if(this.R){let r;for(a=!0;!this.K&&this.C<c.length;){if(r=Nb(this,c),r==Bb){4==k&&(this.m=4,J(14),a=!1),K(this.i,this.l,null,"[Incomplete Response]");break}if(r==Ab){this.m=4,J(15),K(this.i,this.l,c,"[Invalid Chunk]"),a=!1;break}K(this.i,this.l,r,null),Lb(this,r)}if(Ob(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=k||0!=c.length||this.h.h||(this.m=1,J(16),a=!1),this.o=this.o&&a,a){if(c.length>0&&!this.W){this.W=!0;var g=this.j;g.g==this&&g.aa&&!g.P&&(g.j.info("Great, no buffering proxy detected. Bytes received: "+c.length),Pb(g),g.P=!0,J(11))}}else K(this.i,this.l,c,"[Invalid Chunked Response]"),Q(this),Mb(this)}else K(this.i,this.l,c,null),Lb(this,c);4==k&&Q(this),this.o&&!this.K&&(4==k?Qb(this.j,this):(this.o=!1,Fb(this)))}else(function Rb(a){const b={};a=(a.g&&P(a)>=2&&a.g.getAllResponseHeaders()||"").split("\r\n");for(let d=0;d<a.length;d++){if(y(a[d]))continue;var c=yb(a[d]);const e=c[0];if("string"!=typeof(c=c[1]))continue;c=c.trim();const f=b[e]||[];b[e]=f,f.push(c)}!function Aa(a,b){for(const c in a)b.call(void 0,a[c],c,a)}(b,(function(d){return d.join(", ")}))})(this.g),400==b&&c.indexOf("Unknown SID")>0?(this.m=3,J(12)):(this.m=0,J(13)),Q(this),Mb(this)}}}catch(k){}},N.prototype.cancel=function(){this.K=!0,Q(this)},N.prototype.aa=function(){this.D=null;const a=Date.now();a-this.T>=0?(function tb(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.i,this.B),2!=this.M&&(lb(),J(17)),Q(this),this.m=2,Mb(this)):Sb(this,this.T-a)};var dc=class{constructor(a,b){this.g=a,this.map=b}};function ec(a){this.l=a||10,l.PerformanceNavigationTiming?a=(a=l.performance.getEntriesByType("navigation")).length>0&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.chrome&&l.chrome.loadTimes&&l.chrome.loadTimes()&&l.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function fc(a){return!!a.h||!!a.g&&a.g.size>=a.j}function Xb(a){return a.h?1:a.g?a.g.size:0}function Tb(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function Yb(a,b){a.g?a.g.add(b):a.h=b}function $b(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function hc(a){if(null!=a.h)return a.i.concat(a.h.G);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const c of a.g.values())b=b.concat(c.G);return b}return ja(a.i)}ec.prototype.cancel=function(){if(this.i=hc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}};var ic=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function T(a){let b;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,a instanceof T?(this.l=a.l,kc(this,a.j),this.o=a.o,this.g=a.g,lc(this,a.u),this.h=a.h,mc(this,nc(a.i)),this.m=a.m):a&&(b=String(a).match(ic))?(this.l=!1,kc(this,b[1]||"",!0),this.o=oc(b[2]||""),this.g=oc(b[3]||"",!0),lc(this,b[4]),this.h=oc(b[5]||"",!0),mc(this,b[6]||"",!0),this.m=oc(b[7]||"")):(this.l=!1,this.i=new pc(null,this.l))}function O(a){return new T(a)}function kc(a,b,c){a.j=c?oc(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function lc(a,b){if(b){if(b=Number(b),isNaN(b)||b<0)throw Error("Bad port number "+b);a.u=b}else a.u=null}function mc(a,b,c){b instanceof pc?(a.i=b,function vc(a,b){b&&!a.j&&(U(a),a.i=null,a.g.forEach((function(c,d){const e=d.toLowerCase();d!=e&&(yc(this,d),Gb(this,e,c))}),a)),a.j=b}(a.i,a.l)):(c||(b=qc(b,wc)),a.i=new pc(b,a.l))}function S(a,b,c){a.i.set(b,c)}function Db(a){return S(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function oc(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function qc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,xc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function xc(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}T.prototype.toString=function(){const a=[];var b=this.j;b&&a.push(qc(b,rc,!0),":");var c=this.g;return(c||"file"==b)&&(a.push("//"),(b=this.o)&&a.push(qc(b,rc,!0),"@"),a.push(L(c).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(c=this.u)&&a.push(":",String(c))),(c=this.h)&&(this.g&&"/"!=c.charAt(0)&&a.push("/"),a.push(qc(c,"/"==c.charAt(0)?sc:tc,!0))),(c=this.i.toString())&&a.push("?",c),(c=this.m)&&a.push("#",qc(c,uc)),a.join("")},T.prototype.resolve=function(a){const b=O(this);let c=!!a.j;c?kc(b,a.j):c=!!a.o,c?b.o=a.o:c=!!a.g,c?b.g=a.g:c=null!=a.u;var d=a.h;if(c)lc(b,a.u);else if(c=!!a.h){if("/"!=d.charAt(0))if(this.g&&!this.h)d="/"+d;else{var e=b.h.lastIndexOf("/");-1!=e&&(d=b.h.slice(0,e+1)+d)}if(".."==(e=d)||"."==e)d="";else if(-1!=e.indexOf("./")||-1!=e.indexOf("/.")){d=0==e.lastIndexOf("/",0),e=e.split("/");const f=[];for(let g=0;g<e.length;){const k=e[g++];"."==k?d&&g==e.length&&f.push(""):".."==k?((f.length>1||1==f.length&&""!=f[0])&&f.pop(),d&&g==e.length&&f.push("")):(f.push(k),d=!0)}d=f.join("/")}else d=e}return c?b.h=d:c=""!==a.i.toString(),c?mc(b,nc(a.i)):c=!!a.m,c&&(b.m=a.m),b};var rc=/[#\/\?@]/g,tc=/[#\?:]/g,sc=/[#\?]/g,wc=/[#\?@]/g,uc=/#/g;function pc(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function U(a){a.g||(a.g=new Map,a.h=0,a.i&&function jc(a,b){if(a){a=a.split("&");for(let c=0;c<a.length;c++){const d=a[c].indexOf("=");let e,f=null;d>=0?(e=a[c].substring(0,d),f=a[c].substring(d+1)):e=a[c],b(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}}(a.i,(function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)})))}function yc(a,b){U(a),b=V(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function zc(a,b){return U(a),b=V(a,b),a.g.has(b)}function Ac(a,b){U(a);let c=[];if("string"==typeof b)zc(a,b)&&(c=c.concat(a.g.get(V(a,b))));else for(a=Array.from(a.g.values()),b=0;b<a.length;b++)c=c.concat(a[b]);return c}function Gb(a,b,c){yc(a,b),c.length>0&&(a.i=null,a.g.set(V(a,b),ja(c)),a.h+=c.length)}function nc(a){const b=new pc;return b.i=a.i,a.g&&(b.g=new Map(a.g),b.h=a.h),b}function V(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}function W(a,b,c,d,e){try{e&&(e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null),d(c)}catch(f){}}function Dc(){this.g=new db}function Ec(a){this.i=a.Sb||null,this.h=a.ab||!1}function Fc(a,b){C.call(this),this.H=a,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ic(a){a.j.read().then(a.Ma.bind(a)).catch(a.ga.bind(a))}function Hc(a){a.readyState=4,a.l=null,a.j=null,a.B=null,Gc(a)}function Gc(a){a.onreadystatechange&&a.onreadystatechange.call(a)}function Jc(a){let b="";return ya(a,(function(c,d){b+=d,b+=":",b+=c,b+="\r\n"})),b}function Kc(a,b,c){a:{for(d in c){var d=!1;break a}d=!0}d||(c=Jc(c),"string"==typeof a?null!=c&&L(c):S(a,b,c))}function X(a){C.call(this),this.headers=new Map,this.L=a||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(h=pc.prototype).add=function(a,b){U(this),this.i=null,a=V(this,a);let c=this.g.get(a);return c||this.g.set(a,c=[]),c.push(b),this.h+=1,this},h.forEach=function(a,b){U(this),this.g.forEach((function(c,d){c.forEach((function(e){a.call(b,e,d,this)}),this)}),this)},h.set=function(a,b){return U(this),this.i=null,zc(this,a=V(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},h.get=function(a,b){return a&&(a=Ac(this,a)).length>0?String(a[0]):b},h.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(let d=0;d<b.length;d++){var c=b[d];const e=L(c);c=Ac(this,c);for(let f=0;f<c.length;f++){let g=e;""!==c[f]&&(g+="="+L(c[f])),a.push(g)}}return this.i=a.join("&")},t(Ec,eb),Ec.prototype.g=function(){return new Fc(this.i,this.h)},t(Fc,C),(h=Fc.prototype).open=function(a,b){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=a,this.D=b,this.readyState=1,Gc(this)},h.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const b={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};a&&(b.body=a),(this.H||l).fetch(new Request(this.D,b)).then(this.Pa.bind(this),this.ga.bind(this))},h.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Hc(this)),this.readyState=0},h.Pa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,Gc(this)),this.g&&(this.readyState=3,Gc(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ic(this)}else a.text().then(this.Oa.bind(this),this.ga.bind(this))},h.Ma=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var b=a.value?a.value:new Uint8Array(0);(b=this.B.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?Hc(this):Gc(this),3==this.readyState&&Ic(this)}},h.Oa=function(a){this.g&&(this.response=this.responseText=a,Hc(this))},h.Na=function(a){this.g&&(this.response=a,Hc(this))},h.ga=function(){this.g&&Hc(this)},h.setRequestHeader=function(a,b){this.A.append(a,b)},h.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},h.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var c=b.next();!c.done;)c=c.value,a.push(c[0]+": "+c[1]),c=b.next();return a.join("\r\n")},Object.defineProperty(Fc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}}),t(X,C);var Lc=/^https?$/i,Mc=["POST","PUT"];function Nc(a,b){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=b,a.o=5,Oc(a),Pc(a)}function Oc(a){a.A||(a.A=!0,D(a,"complete"),D(a,"error"))}function Qc(a){if(a.h&&void 0!==ea)if(a.v&&4==P(a))setTimeout(a.Ca.bind(a),0);else if(D(a,"readystatechange"),4==P(a)){a.h=!1;try{const f=a.ca();a:switch(f){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break a;default:b=!1}var c;if(!(c=b)){var d;if(d=0===f){let g=String(a.D).match(ic)[1]||null;!g&&l.self&&l.self.location&&(g=l.self.location.protocol.slice(0,-1)),d=!Lc.test(g?g.toLowerCase():"")}c=d}if(c)D(a,"complete"),D(a,"success");else{a.o=6;try{var e=P(a)>2?a.g.statusText:""}catch(g){e=""}a.l=e+" ["+a.ca()+"]",Oc(a)}}finally{Pc(a)}}}function Pc(a,b){if(a.g){a.m&&(clearTimeout(a.m),a.m=null);const c=a.g;a.g=null,b||D(a,"ready");try{c.onreadystatechange=null}catch(d){}}}function P(a){return a.g?a.g.readyState:0}function Ib(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.F){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(b){return null}}function Rc(a,b,c){return c&&c.internalChannelParams&&c.internalChannelParams[a]||b}function Sc(a){this.za=0,this.i=[],this.j=new pb,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Rc("failFast",!1,a),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Rc("baseRetryDelayMs",5e3,a),this.Za=Rc("retryDelaySeedMs",1e4,a),this.Ta=Rc("forwardChannelMaxRetries",2,a),this.va=Rc("forwardChannelRequestTimeoutMs",2e4,a),this.ma=a&&a.xmlHttpFactory||void 0,this.Ua=a&&a.Rb||void 0,this.Aa=a&&a.useFetchStreams||!1,this.O=void 0,this.L=a&&a.supportsCrossDomainXhr||!1,this.M="",this.h=new ec(a&&a.concurrentRequestLimit),this.Ba=new Dc,this.S=a&&a.fastHandshake||!1,this.R=a&&a.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=a&&a.Pb||!1,a&&a.ua&&this.j.ua(),a&&a.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&a&&a.detectBufferingProxy||!1,this.ia=void 0,a&&a.longPollingTimeout&&a.longPollingTimeout>0&&(this.ia=a.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function cc(a){if(Tc(a),3==a.I){var b=a.V++,c=O(a.J);if(S(c,"SID",a.M),S(c,"RID",b),S(c,"TYPE","terminate"),Uc(a,c),(b=new N(a,a.j,b)).M=2,b.A=Db(O(c)),c=!1,l.navigator&&l.navigator.sendBeacon)try{c=l.navigator.sendBeacon(b.A.toString(),"")}catch(d){}!c&&l.Image&&((new Image).src=b.A,c=!0),c||(b.g=Hb(b.j,null),b.g.ea(b.A)),b.F=Date.now(),Fb(b)}Vc(a)}function Vb(a){a.g&&(Pb(a),a.g.cancel(),a.g=null)}function Tc(a){Vb(a),a.v&&(l.clearTimeout(a.v),a.v=null),Ub(a),a.h.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function bc(a){if(!fc(a.h)&&!a.m){a.m=!0;var b=a.Ea;u||ta(),v||(u(),v=!0),oa.add(b,a),a.D=0}}function Zc(a,b){var c;c=b?b.l:a.V++;const d=O(a.J);S(d,"SID",a.M),S(d,"RID",c),S(d,"AID",a.K),Uc(a,d),a.u&&a.o&&Kc(d,a.u,a.o),c=new N(a,a.j,c,a.D+1),null===a.u&&(c.J=a.o),b&&(a.i=b.G.concat(a.i)),b=Yc(a,c,1e3),c.H=Math.round(.5*a.va)+Math.round(.5*a.va*Math.random()),Yb(a.h,c),Cb(c,d,b)}function Uc(a,b){a.H&&ya(a.H,(function(c,d){S(b,d,c)})),a.l&&ya({},(function(c,d){S(b,d,c)}))}function Yc(a,b,c){c=Math.min(a.i.length,c);const d=a.l?p(a.l.Ka,a.l,a):null;a:{var e=a.i;let k=-1;for(;;){const q=["count="+c];-1==k?c>0?(k=e[0].g,q.push("ofs="+k)):k=0:q.push("ofs="+k);let m=!0;for(let r=0;r<c;r++){var f=e[r].g;const A=e[r].map;if((f-=k)<0)k=Math.max(0,e[r].g-100),m=!1;else try{f="req"+f+"_"||0;try{var g=A instanceof Map?A:Object.entries(A);for(const[M,F]of g){let G=F;n(F)&&(G=ab(F)),q.push(f+M+"="+encodeURIComponent(G))}}catch(M){throw q.push(f+"type="+encodeURIComponent("_badmap")),M}}catch(M){d&&d(A)}}if(m){g=q.join("&");break a}}g=void 0}return a=a.i.splice(0,c),b.G=a,g}function ac(a){if(!a.g&&!a.v){a.Y=1;var b=a.Da;u||ta(),v||(u(),v=!0),oa.add(b,a),a.A=0}}function Wb(a){return!(a.g||a.v||a.A>=3)&&(a.Y++,a.v=ob(p(a.Da,a),Xc(a,a.A)),a.A++,!0)}function Pb(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function $c(a){a.g=new N(a,a.j,"rpc",a.Y),null===a.u&&(a.g.J=a.o),a.g.P=0;var b=O(a.na);S(b,"RID","rpc"),S(b,"SID",a.M),S(b,"AID",a.K),S(b,"CI",a.F?"0":"1"),!a.F&&a.ia&&S(b,"TO",a.ia),S(b,"TYPE","xmlhttp"),Uc(a,b),a.u&&a.o&&Kc(b,a.u,a.o),a.O&&(a.g.H=a.O);var c=a.g;a=a.ba,c.M=1,c.A=Db(O(b)),c.u=null,c.R=!0,Eb(c,a)}function Ub(a){null!=a.C&&(l.clearTimeout(a.C),a.C=null)}function Qb(a,b){var c=null;if(a.g==b){Ub(a),Pb(a),a.g=null;var d=2}else{if(!Tb(a.h,b))return;c=b.G,$b(a.h,b),d=1}if(0!=a.I)if(b.o)if(1==d){c=b.u?b.u.length:0,b=Date.now()-b.F;var e=a.D;D(d=jb(),new nb(d,c)),bc(a)}else ac(a);else if(3==(e=b.m)||0==e&&b.X>0||!(1==d&&function Wc(a,b){return!(Xb(a.h)>=a.h.j-(a.m?1:0)||(a.m?(a.i=b.G.concat(a.i),0):1==a.I||2==a.I||a.D>=(a.Sa?0:a.Ta)||(a.m=ob(p(a.Ea,a,b),Xc(a,a.D)),a.D++,0)))}(a,b)||2==d&&Wb(a)))switch(c&&c.length>0&&(b=a.h,b.i=b.i.concat(c)),e){case 1:R(a,5);break;case 4:R(a,10);break;case 3:R(a,6);break;default:R(a,2)}}function Xc(a,b){let c=a.Qa+Math.floor(Math.random()*a.Za);return a.isActive()||(c*=2),c*b}function R(a,b){if(a.j.info("Error code "+b),2==b){var c=p(a.bb,a),d=a.Ua;const e=!d;d=new T(d||"//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||kc(d,"https"),Db(d),e?function Bc(a,b){const c=new pb;if(l.Image){const d=new Image;d.onload=ha(W,c,"TestLoadImage: loaded",!0,b,d),d.onerror=ha(W,c,"TestLoadImage: error",!1,b,d),d.onabort=ha(W,c,"TestLoadImage: abort",!1,b,d),d.ontimeout=ha(W,c,"TestLoadImage: timeout",!1,b,d),l.setTimeout((function(){d.ontimeout&&d.ontimeout()}),1e4),d.src=a}else b(!1)}(d.toString(),c):function Cc(a,b){new pb;const d=new AbortController,e=setTimeout((()=>{d.abort(),W(0,0,!1,b)}),1e4);fetch(a,{signal:d.signal}).then((f=>{clearTimeout(e),f.ok?W(0,0,!0,b):W(0,0,!1,b)})).catch((()=>{clearTimeout(e),W(0,0,!1,b)}))}(d.toString(),c)}else J(2);a.I=0,a.l&&a.l.pa(b),Vc(a),Tc(a)}function Vc(a){if(a.I=0,a.ja=[],a.l){const b=hc(a.h);0==b.length&&0==a.i.length||(ka(a.ja,b),ka(a.ja,a.i),a.h.i.length=0,ja(a.i),a.i.length=0),a.l.oa()}}function Zb(a,b,c){var d=c instanceof T?O(c):new T(c);if(""!=d.g)b&&(d.g=b+"."+d.g),lc(d,d.u);else{var e=l.location;d=e.protocol,b=b?b+"."+e.hostname:e.hostname,e=+e.port;const f=new T(null);d&&kc(f,d),b&&(f.g=b),e&&lc(f,e),c&&(f.h=c),d=f}return c=a.G,b=a.wa,c&&b&&S(d,c,b),S(d,"VER",a.ka),Uc(a,d),d}function Hb(a,b,c){if(b&&!a.L)throw Error("Can't create secondary domain capable XhrIo object.");return(b=a.Aa&&!a.ma?new X(new Ec({ab:c})):new X(a.ma)).Fa(a.L),b}function ad(){}function bd(){}function Y(a,b){C.call(this),this.g=new Sc(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.sa&&(a?a["X-WebChannel-Client-Profile"]=b.sa:a={"X-WebChannel-Client-Profile":b.sa}),this.g.U=a,(a=b&&b.Qb)&&!y(a)&&(this.g.u=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!y(b)&&(this.g.G=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new Z(this)}function cd(a){gb.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var b=a.__sm__;if(b){a:{for(const c in b){a=c;break a}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function dd(){hb.call(this),this.status=1}function Z(a){this.g=a}(h=X.prototype).Fa=function(a){this.H=a},h.ea=function(a,b,c,d){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);b=b?b.toUpperCase():"GET",this.D=a,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():wb.g(),this.g.onreadystatechange=ia(p(this.Ca,this));try{this.B=!0,this.g.open(b,String(a),!0),this.B=!1}catch(f){return void Nc(this,f)}if(a=c||"",c=new Map(this.headers),d)if(Object.getPrototypeOf(d)===Object.prototype)for(var e in d)c.set(e,d[e]);else{if("function"!=typeof d.keys||"function"!=typeof d.get)throw Error("Unknown input type for opt_headers: "+String(d));for(const f of d.keys())c.set(f,d.get(f))}d=Array.from(c.keys()).find((f=>"content-type"==f.toLowerCase())),e=l.FormData&&a instanceof l.FormData,!(Array.prototype.indexOf.call(Mc,b,void 0)>=0)||d||e||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[f,g]of c)this.g.setRequestHeader(f,g);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(a),this.v=!1}catch(f){Nc(this,f)}},h.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=a||7,D(this,"complete"),D(this,"abort"),Pc(this))},h.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pc(this,!0)),X.Z.N.call(this)},h.Ca=function(){this.u||(this.B||this.v||this.j?Qc(this):this.Xa())},h.Xa=function(){Qc(this)},h.isActive=function(){return!!this.g},h.ca=function(){try{return P(this)>2?this.g.status:-1}catch(a){return-1}},h.la=function(){try{return this.g?this.g.responseText:""}catch(a){return""}},h.La=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),cb(b)}},h.ya=function(){return this.o},h.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(h=Sc.prototype).ka=8,h.I=1,h.connect=function(a,b,c,d){J(0),this.W=a,this.H=b||{},c&&void 0!==d&&(this.H.OSID=c,this.H.OAID=d),this.F=this.X,this.J=Zb(this,null,this.W),bc(this)},h.Ea=function(a){if(this.m)if(this.m=null,1==this.I){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const e=new N(this,this.j,a);let f=this.o;if(this.U&&(f?(f=Ba(f),Da(f,this.U)):f=this.U),null!==this.u||this.R||(e.J=f,f=null),this.S)a:{for(var b=0,c=0;c<this.i.length;c++){var d=this.i[c];if(void 0===(d="__data__"in d.map&&"string"==typeof(d=d.map.__data__)?d.length:void 0))break;if((b+=d)>4096){b=c;break a}if(4096===b||c===this.i.length-1){b=c+1;break a}}b=1e3}else b=1e3;b=Yc(this,e,b),S(c=O(this.J),"RID",a),S(c,"CVER",22),this.G&&S(c,"X-HTTP-Session-Id",this.G),Uc(this,c),f&&(this.R?b="headers="+L(Jc(f))+"&"+b:this.u&&Kc(c,this.u,f)),Yb(this.h,e),this.Ra&&S(c,"TYPE","init"),this.S?(S(c,"$req",b),S(c,"SID","null"),e.U=!0,Cb(e,c,null)):Cb(e,c,b),this.I=2}}else 3==this.I&&(a?Zc(this,a):0==this.i.length||fc(this.h)||Zc(this))},h.Da=function(){if(this.v=null,$c(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var a=4*this.T;this.j.info("BP detection timer enabled: "+a),this.B=ob(p(this.Wa,this),a)}},h.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,J(10),Vb(this),$c(this))},h.Va=function(){null!=this.C&&(this.C=null,Vb(this),Wb(this),J(19))},h.bb=function(a){a?(this.j.info("Successfully pinged google.com"),J(2)):(this.j.info("Failed to ping google.com"),J(1))},h.isActive=function(){return!!this.l&&this.l.isActive(this)},(h=ad.prototype).ra=function(){},h.qa=function(){},h.pa=function(){},h.oa=function(){},h.isActive=function(){return!0},h.Ka=function(){},bd.prototype.g=function(a,b){return new Y(a,b)},t(Y,C),Y.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Y.prototype.close=function(){cc(this.g)},Y.prototype.o=function(a){var b=this.g;if("string"==typeof a){var c={};c.__data__=a,a=c}else this.v&&((c={}).__data__=ab(a),a=c);b.i.push(new dc(b.Ya++,a)),3==b.I&&bc(b)},Y.prototype.N=function(){this.g.l=null,delete this.j,cc(this.g),delete this.g,Y.Z.N.call(this)},t(cd,gb),t(dd,hb),t(Z,ad),Z.prototype.ra=function(){D(this.g,"a")},Z.prototype.qa=function(a){D(this.g,new cd(a))},Z.prototype.pa=function(a){D(this.g,new dd)},Z.prototype.oa=function(){D(this.g,"b")},bd.prototype.createWebChannel=bd.prototype.g,Y.prototype.send=Y.prototype.o,Y.prototype.open=Y.prototype.m,Y.prototype.close=Y.prototype.close,createWebChannelTransport=webchannel_blob_es2018.createWebChannelTransport=function(){return new bd},getStatEventTarget=webchannel_blob_es2018.getStatEventTarget=function(){return jb()},Event=webchannel_blob_es2018.Event=I,Stat=webchannel_blob_es2018.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ub.NO_ERROR=0,ub.TIMEOUT=8,ub.HTTP_ERROR=6,ErrorCode=webchannel_blob_es2018.ErrorCode=ub,vb.COMPLETE="complete",EventType=webchannel_blob_es2018.EventType=vb,fb.EventType=H,H.OPEN="a",H.CLOSE="b",H.ERROR="c",H.MESSAGE="d",C.prototype.listen=C.prototype.J,WebChannel=webchannel_blob_es2018.WebChannel=fb,webchannel_blob_es2018.FetchXmlHttpFactory=Ec,X.prototype.listenOnce=X.prototype.K,X.prototype.getLastError=X.prototype.Ha,X.prototype.getLastErrorCode=X.prototype.ya,X.prototype.getStatus=X.prototype.ca,X.prototype.getResponseJson=X.prototype.La,X.prototype.getResponseText=X.prototype.la,X.prototype.send=X.prototype.ea,X.prototype.setWithCredentials=X.prototype.Fa,XhrIo=webchannel_blob_es2018.XhrIo=X}).apply(void 0!==webchannel_blob_es2018_commonjsGlobal?webchannel_blob_es2018_commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const F="@firebase/firestore",M="4.9.2";class User{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");let x="12.3.0";const O=new dist_esm_index_esm.Vy("@firebase/firestore");function __PRIVATE_getLogLevel(){return O.logLevel}function __PRIVATE_logDebug(e,...t){if(O.logLevel<=dist_esm_index_esm.$b.DEBUG){const n=t.map(__PRIVATE_argToString);O.debug(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_logError(e,...t){if(O.logLevel<=dist_esm_index_esm.$b.ERROR){const n=t.map(__PRIVATE_argToString);O.error(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_logWarn(e,...t){if(O.logLevel<=dist_esm_index_esm.$b.WARN){const n=t.map(__PRIVATE_argToString);O.warn(`Firestore (${x}): ${e}`,...n)}}function __PRIVATE_argToString(e){if("string"==typeof e)return e;try{return function __PRIVATE_formatJSON(e){return JSON.stringify(e)}(e)}catch(t){return e}}function fail(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,__PRIVATE__fail(e,r,n)}function __PRIVATE__fail(e,t,n){let r=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw __PRIVATE_logError(r),new Error(r)}function __PRIVATE_hardAssert(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||__PRIVATE__fail(t,i,r)}function __PRIVATE_debugCast(e,t){return e}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends dist_index_esm.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class __PRIVATE_Deferred{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class __PRIVATE_OAuthToken{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(User.UNAUTHENTICATED)))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(e){this.t=e,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){__PRIVATE_hardAssert(void 0===this.o,42304);let n=this.i;const __PRIVATE_guardedChangeListener=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new __PRIVATE_Deferred;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new __PRIVATE_Deferred,e.enqueueRetryable((()=>__PRIVATE_guardedChangeListener(this.currentUser)))};const __PRIVATE_awaitNextToken=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await __PRIVATE_guardedChangeListener(this.currentUser)}))},__PRIVATE_registerAuth=e=>{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),__PRIVATE_awaitNextToken())};this.t.onInit((e=>__PRIVATE_registerAuth(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?__PRIVATE_registerAuth(e):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new __PRIVATE_Deferred)}}),0),__PRIVATE_awaitNextToken()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(__PRIVATE_hardAssert("string"==typeof t.accessToken,31837,{l:t}),new __PRIVATE_OAuthToken(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(null===e||"string"==typeof e,2055,{h:e}),new User(e)}}class __PRIVATE_FirstPartyToken{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=User.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(User.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(t,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,index_esm.xZ)(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(e,t){__PRIVATE_hardAssert(void 0===this.o,3512);const onTokenChanged=e=>{null!=e.error&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>onTokenChanged(t)))};const __PRIVATE_registerAppCheck=e=>{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>__PRIVATE_registerAppCheck(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?__PRIVATE_registerAppCheck(e):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new AppCheckToken(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(__PRIVATE_hardAssert("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new AppCheckToken(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function __PRIVATE_randomBytes(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class __PRIVATE_AutoId{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=__PRIVATE_randomBytes(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[i]%62))}return n}}function __PRIVATE_primitiveComparator(e,t){return e<t?-1:e>t?1:0}function __PRIVATE_compareUtf8Strings(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.charAt(r),i=t.charAt(r);if(n!==i)return __PRIVATE_isSurrogate(n)===__PRIVATE_isSurrogate(i)?__PRIVATE_primitiveComparator(n,i):__PRIVATE_isSurrogate(n)?1:-1}return __PRIVATE_primitiveComparator(e.length,t.length)}const B=55296,L=57343;function __PRIVATE_isSurrogate(e){const t=e.charCodeAt(0);return t>=B&&t<=L}function __PRIVATE_arrayEquals(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}const k="__name__";class BasePath{constructor(e,t,n){void 0===t?t=0:t>e.length&&fail(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&fail(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===BasePath.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof BasePath?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=BasePath.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return __PRIVATE_primitiveComparator(e.length,t.length)}static compareSegments(e,t){const n=BasePath.isNumericId(e),r=BasePath.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?BasePath.extractNumericId(e).compare(BasePath.extractNumericId(t)):__PRIVATE_compareUtf8Strings(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Integer.fromString(e.substring(4,e.length-2))}}class ResourcePath extends BasePath{construct(e,t,n){return new ResourcePath(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ResourcePath(t)}static emptyPath(){return new ResourcePath([])}}const q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(e,t,n){return new FieldPath$1(e,t,n)}static isValidIdentifier(e){return q.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===k}static keyField(){return new FieldPath$1([k])}static fromServerFormat(e){const t=[];let n="",r=0;const __PRIVATE_addCurrentSegment=()=>{if(0===n.length)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(__PRIVATE_addCurrentSegment(),r++)}if(__PRIVATE_addCurrentSegment(),i)throw new FirestoreError(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new FieldPath$1(t)}static emptyPath(){return new FieldPath$1([])}}class DocumentKey{constructor(e){this.path=e}static fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}static fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ResourcePath.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ResourcePath.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}function __PRIVATE_validateNonEmptyArgument(e,t,n){if(!n)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function __PRIVATE_validateDocumentPath(e){if(!DocumentKey.isDocumentKey(e))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function __PRIVATE_isPlainObject(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function __PRIVATE_valueDescription(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function __PRIVATE_tryGetCustomObjectType(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":fail(12329,{type:typeof e})}function __PRIVATE_cast(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new FirestoreError(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=__PRIVATE_valueDescription(e);throw new FirestoreError(N.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function property(e,t){const n={typeString:e};return t&&(n.value=t),n}function __PRIVATE_validateJSON(e,t){if(!__PRIVATE_isPlainObject(e))throw new FirestoreError(N.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in t)if(t[r]){const i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}const o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new FirestoreError(N.INVALID_ARGUMENT,n);return!0}const Q=-62135596800,$=1e6;class Timestamp{static now(){return Timestamp.fromMillis(Date.now())}static fromDate(e){return Timestamp.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*$);return new Timestamp(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Q)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$}_compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Timestamp._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Timestamp._jsonSchema))return new Timestamp(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Q;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Timestamp._jsonSchemaVersion="firestore/timestamp/1.0",Timestamp._jsonSchema={type:property("string",Timestamp._jsonSchemaVersion),seconds:property("number"),nanoseconds:property("number")};class SnapshotVersion{static fromTimestamp(e){return new SnapshotVersion(e)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const U=-1;class FieldIndex{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}FieldIndex.UNKNOWN_ID=-1;function __PRIVATE_newIndexOffsetSuccessorFromReadTime(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=SnapshotVersion.fromTimestamp(1e9===r?new Timestamp(n+1,0):new Timestamp(n,r));return new IndexOffset(i,DocumentKey.empty(),t)}function __PRIVATE_newIndexOffsetFromDocument(e){return new IndexOffset(e.readTime,e.key,U)}class IndexOffset{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),U)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),U)}}function __PRIVATE_indexOffsetComparator(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=DocumentKey.comparator(e.documentKey,t.documentKey),0!==n?n:__PRIVATE_primitiveComparator(e.largestBatchId,t.largestBatchId))}const K="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function __PRIVATE_ignoreIfPrimaryLeaseLoss(e){if(e.code!==N.FAILED_PRECONDITION||e.message!==K)throw e;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}class PersistencePromise{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&fail(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new PersistencePromise(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof PersistencePromise?t:PersistencePromise.resolve(t)}catch(e){return PersistencePromise.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):PersistencePromise.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):PersistencePromise.reject(t)}static resolve(e){return new PersistencePromise(((t,n)=>{t(e)}))}static reject(e){return new PersistencePromise(((t,n)=>{n(e)}))}static waitFor(e){return new PersistencePromise(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=PersistencePromise.resolve(!1);for(const n of e)t=t.next((e=>e?PersistencePromise.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new PersistencePromise(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let _=0;_<i;_++){const a=_;t(e[a]).next((e=>{s[a]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new PersistencePromise(((n,r)=>{const process=()=>{!0===e()?t().next((()=>{process()}),r):n()};process()}))}}function __PRIVATE_getAndroidVersion(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function __PRIVATE_isIndexedDbTransactionError(e){return"IndexedDbTransactionError"===e.name}class __PRIVATE_ListenSequence{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}__PRIVATE_ListenSequence.ce=-1;const j=-1;function __PRIVATE_isNullOrUndefined(e){return null==e}function __PRIVATE_isNegativeZero(e){return 0===e&&1/e==-1/0}function isSafeInteger(e){return"number"==typeof e&&Number.isInteger(e)&&!__PRIVATE_isNegativeZero(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const J="";function __PRIVATE_encodeResourcePath(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=__PRIVATE_encodeSeparator(t)),t=__PRIVATE_encodeSegment(e.get(n),t);return __PRIVATE_encodeSeparator(t)}function __PRIVATE_encodeSegment(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case J:n+="";break;default:n+=r}}return n}function __PRIVATE_encodeSeparator(e){return e+J+""}const H="remoteDocuments",Y="owner",X="mutationQueues",te="mutations";const oe="documentMutations",_e="remoteDocumentsV14",Pe="remoteDocumentGlobal",Ie="targets",Ae="targetDocuments",ge="targetGlobal",pe="collectionParents",we="clientMetadata",be="bundles",Ce="namedQueries",Fe="indexConfiguration",Ne="indexState",qe="indexEntries",Ke="documentOverlays",He="globals",Ze=[X,te,oe,H,Ie,Y,ge,Ae,we,Pe,pe,be,Ce],et=[X,te,oe,_e,Ie,Y,ge,Ae,we,Pe,pe,be,Ce,Ke],tt=et,nt=[...tt,Fe,Ne,qe];function __PRIVATE_objectSize(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function forEach(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function isEmpty(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class SortedMap{constructor(e,t){this.comparator=e,this.root=t||LLRBNode.EMPTY}insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}class SortedMapIterator{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class LLRBNode{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:LLRBNode.RED,this.left=null!=r?r:LLRBNode.EMPTY,this.right=null!=i?i:LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return LLRBNode.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fail(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fail(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fail(27949);return e+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1,LLRBNode.EMPTY=new class LLRBEmptyNode{constructor(){this.size=0}get key(){throw fail(57766)}get value(){throw fail(16141)}get color(){throw fail(16727)}get left(){throw fail(29726)}get right(){throw fail(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new LLRBNode(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class SortedSet{constructor(e){this.comparator=e,this.data=new SortedMap(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof SortedSet))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new SortedSet(this.comparator);return t.data=e,t}}class SortedSetIterator{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class FieldMask{constructor(e){this.fields=e,e.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(e){let t=new SortedSet(FieldPath$1.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new FieldMask(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ByteString{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function __PRIVATE_decodeBase64(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+e):e}}(e);return new ByteString(t)}static fromUint8Array(e){const t=function __PRIVATE_binaryStringFromUint8Array(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ByteString(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function __PRIVATE_encodeBase64(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function __PRIVATE_uint8ArrayFromBinaryString(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const ot=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(e){if(__PRIVATE_hardAssert(!!e,39018),"string"==typeof e){let t=0;const n=ot.exec(e);if(__PRIVATE_hardAssert(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:__PRIVATE_normalizeNumber(e.seconds),nanos:__PRIVATE_normalizeNumber(e.nanos)}}function __PRIVATE_normalizeNumber(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function __PRIVATE_normalizeByteString(e){return"string"==typeof e?ByteString.fromBase64String(e):ByteString.fromUint8Array(e)}const _t="server_timestamp",at="__type__",ut="__previous_value__",ct="__local_write_time__";function __PRIVATE_isServerTimestamp(e){const t=(e?.mapValue?.fields||{})[at]?.stringValue;return t===_t}function __PRIVATE_getPreviousValue(e){const t=e.mapValue.fields[ut];return __PRIVATE_isServerTimestamp(t)?__PRIVATE_getPreviousValue(t):t}function __PRIVATE_getLocalWriteTime(e){const t=__PRIVATE_normalizeTimestamp(e.mapValue.fields[ct].timestampValue);return new Timestamp(t.seconds,t.nanos)}class DatabaseInfo{constructor(e,t,n,r,i,s,o,_,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=_,this.useFetchStreams=a,this.isUsingEmulator=u}}const lt="(default)";class DatabaseId{constructor(e,t){this.projectId=e,this.database=t||lt}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===lt}isEqual(e){return e instanceof DatabaseId&&e.projectId===this.projectId&&e.database===this.database}}const ht="__type__",Pt="__max__",Tt={mapValue:{fields:{__type__:{stringValue:Pt}}}},It="__vector__",Et="value";function __PRIVATE_typeOrder(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?__PRIVATE_isServerTimestamp(e)?4:__PRIVATE_isMaxValue(e)?9007199254740991:__PRIVATE_isVectorValue(e)?10:11:fail(28295,{value:e})}function __PRIVATE_valueEquals(e,t){if(e===t)return!0;const n=__PRIVATE_typeOrder(e);if(n!==__PRIVATE_typeOrder(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(e).isEqual(__PRIVATE_getLocalWriteTime(t));case 3:return function __PRIVATE_timestampEquals(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=__PRIVATE_normalizeTimestamp(e.timestampValue),r=__PRIVATE_normalizeTimestamp(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function __PRIVATE_blobEquals(e,t){return __PRIVATE_normalizeByteString(e.bytesValue).isEqual(__PRIVATE_normalizeByteString(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function __PRIVATE_geoPointEquals(e,t){return __PRIVATE_normalizeNumber(e.geoPointValue.latitude)===__PRIVATE_normalizeNumber(t.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(e.geoPointValue.longitude)===__PRIVATE_normalizeNumber(t.geoPointValue.longitude)}(e,t);case 2:return function __PRIVATE_numberEquals(e,t){if("integerValue"in e&&"integerValue"in t)return __PRIVATE_normalizeNumber(e.integerValue)===__PRIVATE_normalizeNumber(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=__PRIVATE_normalizeNumber(e.doubleValue),r=__PRIVATE_normalizeNumber(t.doubleValue);return n===r?__PRIVATE_isNegativeZero(n)===__PRIVATE_isNegativeZero(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return __PRIVATE_arrayEquals(e.arrayValue.values||[],t.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return function __PRIVATE_objectEquals(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(__PRIVATE_objectSize(n)!==__PRIVATE_objectSize(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!__PRIVATE_valueEquals(n[e],r[e])))return!1;return!0}(e,t);default:return fail(52216,{left:e})}}function __PRIVATE_arrayValueContains(e,t){return void 0!==(e.values||[]).find((e=>__PRIVATE_valueEquals(e,t)))}function __PRIVATE_valueCompare(e,t){if(e===t)return 0;const n=__PRIVATE_typeOrder(e),r=__PRIVATE_typeOrder(t);if(n!==r)return __PRIVATE_primitiveComparator(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(e.booleanValue,t.booleanValue);case 2:return function __PRIVATE_compareNumbers(e,t){const n=__PRIVATE_normalizeNumber(e.integerValue||e.doubleValue),r=__PRIVATE_normalizeNumber(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return __PRIVATE_compareTimestamps(e.timestampValue,t.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(e),__PRIVATE_getLocalWriteTime(t));case 5:return __PRIVATE_compareUtf8Strings(e.stringValue,t.stringValue);case 6:return function __PRIVATE_compareBlobs(e,t){const n=__PRIVATE_normalizeByteString(e),r=__PRIVATE_normalizeByteString(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function __PRIVATE_compareReferences(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=__PRIVATE_primitiveComparator(n[e],r[e]);if(0!==t)return t}return __PRIVATE_primitiveComparator(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function __PRIVATE_compareGeoPoints(e,t){const n=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(t.latitude));return 0!==n?n:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(e.longitude),__PRIVATE_normalizeNumber(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return __PRIVATE_compareArrays(e.arrayValue,t.arrayValue);case 10:return function __PRIVATE_compareVectors(e,t){const n=e.fields||{},r=t.fields||{},i=n[Et]?.arrayValue,s=r[Et]?.arrayValue,o=__PRIVATE_primitiveComparator(i?.values?.length||0,s?.values?.length||0);return 0!==o?o:__PRIVATE_compareArrays(i,s)}(e.mapValue,t.mapValue);case 11:return function __PRIVATE_compareMaps(e,t){if(e===Tt.mapValue&&t===Tt.mapValue)return 0;if(e===Tt.mapValue)return 1;if(t===Tt.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=__PRIVATE_compareUtf8Strings(r[e],s[e]);if(0!==t)return t;const o=__PRIVATE_valueCompare(n[r[e]],i[s[e]]);if(0!==o)return o}return __PRIVATE_primitiveComparator(r.length,s.length)}(e.mapValue,t.mapValue);default:throw fail(23264,{he:n})}}function __PRIVATE_compareTimestamps(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return __PRIVATE_primitiveComparator(e,t);const n=__PRIVATE_normalizeTimestamp(e),r=__PRIVATE_normalizeTimestamp(t),i=__PRIVATE_primitiveComparator(n.seconds,r.seconds);return 0!==i?i:__PRIVATE_primitiveComparator(n.nanos,r.nanos)}function __PRIVATE_compareArrays(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=__PRIVATE_valueCompare(n[e],r[e]);if(t)return t}return __PRIVATE_primitiveComparator(n.length,r.length)}function canonicalId(e){return __PRIVATE_canonifyValue(e)}function __PRIVATE_canonifyValue(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function __PRIVATE_canonifyTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function __PRIVATE_canonifyByteString(e){return __PRIVATE_normalizeByteString(e).toBase64()}(e.bytesValue):"referenceValue"in e?function __PRIVATE_canonifyReference(e){return DocumentKey.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function __PRIVATE_canonifyGeoPoint(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function __PRIVATE_canonifyArray(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=__PRIVATE_canonifyValue(r);return t+"]"}(e.arrayValue):"mapValue"in e?function __PRIVATE_canonifyMap(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${__PRIVATE_canonifyValue(e.fields[i])}`;return n+"}"}(e.mapValue):fail(61005,{value:e})}function __PRIVATE_estimateByteSize(e){switch(__PRIVATE_typeOrder(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=__PRIVATE_getPreviousValue(e);return t?16+__PRIVATE_estimateByteSize(t):16;case 5:return 2*e.stringValue.length;case 6:return __PRIVATE_normalizeByteString(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function __PRIVATE_estimateArrayByteSize(e){return(e.values||[]).reduce(((e,t)=>e+__PRIVATE_estimateByteSize(t)),0)}(e.arrayValue);case 10:case 11:return function __PRIVATE_estimateMapByteSize(e){let t=0;return forEach(e.fields,((e,n)=>{t+=e.length+__PRIVATE_estimateByteSize(n)})),t}(e.mapValue);default:throw fail(13486,{value:e})}}function isInteger(e){return!!e&&"integerValue"in e}function isArray(e){return!!e&&"arrayValue"in e}function __PRIVATE_isNullValue(e){return!!e&&"nullValue"in e}function __PRIVATE_isNanValue(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function __PRIVATE_isMapValue(e){return!!e&&"mapValue"in e}function __PRIVATE_isVectorValue(e){const t=(e?.mapValue?.fields||{})[ht]?.stringValue;return t===It}function __PRIVATE_deepClone(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return forEach(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=__PRIVATE_deepClone(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=__PRIVATE_deepClone(e.arrayValue.values[n]);return t}return{...e}}function __PRIVATE_isMaxValue(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Pt}class ObjectValue{constructor(e){this.value=e}static empty(){return new ObjectValue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!__PRIVATE_isMapValue(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}setAll(e){let t=FieldPath$1.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=__PRIVATE_deepClone(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());__PRIVATE_isMapValue(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];__PRIVATE_isMapValue(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){forEach(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}function __PRIVATE_extractFieldMask(e){const t=[];return forEach(e.fields,((e,n)=>{const r=new FieldPath$1([e]);if(__PRIVATE_isMapValue(n)){const e=__PRIVATE_extractFieldMask(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new FieldMask(t)}class MutableDocument{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(e,t,n,r){return new MutableDocument(e,1,t,SnapshotVersion.min(),n,r,0)}static newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof MutableDocument&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bound{constructor(e,t){this.position=e,this.inclusive=t}}function __PRIVATE_boundCompareToDocument(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?DocumentKey.comparator(DocumentKey.fromName(o.referenceValue),n.key):__PRIVATE_valueCompare(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function __PRIVATE_boundEquals(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!__PRIVATE_valueEquals(e.position[n],t.position[n]))return!1;return!0}class OrderBy{constructor(e,t="asc"){this.field=e,this.dir=t}}function __PRIVATE_orderByEquals(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Filter{}class FieldFilter extends Filter{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new __PRIVATE_KeyFieldFilter(e,t,n):"array-contains"===t?new __PRIVATE_ArrayContainsFilter(e,n):"in"===t?new __PRIVATE_InFilter(e,n):"not-in"===t?new __PRIVATE_NotInFilter(e,n):"array-contains-any"===t?new __PRIVATE_ArrayContainsAnyFilter(e,n):new FieldFilter(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new __PRIVATE_KeyFieldInFilter(e,n):new __PRIVATE_KeyFieldNotInFilter(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value)):null!==t&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(t)&&this.matchesComparison(__PRIVATE_valueCompare(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return fail(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new CompositeFilter(e,t)}matches(e){return __PRIVATE_compositeFilterIsConjunction(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(e){return"and"===e.op}function __PRIVATE_compositeFilterIsFlatConjunction(e){return __PRIVATE_compositeFilterIsFlat(e)&&__PRIVATE_compositeFilterIsConjunction(e)}function __PRIVATE_compositeFilterIsFlat(e){for(const t of e.filters)if(t instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(e){if(e instanceof FieldFilter)return e.field.canonicalString()+e.op.toString()+canonicalId(e.value);if(__PRIVATE_compositeFilterIsFlatConjunction(e))return e.filters.map((e=>__PRIVATE_canonifyFilter(e))).join(",");{const t=e.filters.map((e=>__PRIVATE_canonifyFilter(e))).join(",");return`${e.op}(${t})`}}function __PRIVATE_filterEquals(e,t){return e instanceof FieldFilter?function __PRIVATE_fieldFilterEquals(e,t){return t instanceof FieldFilter&&e.op===t.op&&e.field.isEqual(t.field)&&__PRIVATE_valueEquals(e.value,t.value)}(e,t):e instanceof CompositeFilter?function __PRIVATE_compositeFilterEquals(e,t){return t instanceof CompositeFilter&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&__PRIVATE_filterEquals(n,t.filters[r])),!0)}(e,t):void fail(19439)}function __PRIVATE_stringifyFilter(e){return e instanceof FieldFilter?function __PRIVATE_stringifyFieldFilter(e){return`${e.field.canonicalString()} ${e.op} ${canonicalId(e.value)}`}(e):e instanceof CompositeFilter?function __PRIVATE_stringifyCompositeFilter(e){return e.op.toString()+" {"+e.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(e):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(e,t,n){super(e,t,n),this.key=DocumentKey.fromName(n.referenceValue)}matches(e){const t=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(t)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(e,t){super(e,"in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function __PRIVATE_extractDocumentKeysFromArrayValue(e,t){return(t.arrayValue?.values||[]).map((e=>DocumentKey.fromName(e.referenceValue)))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return isArray(t)&&__PRIVATE_arrayValueContains(t.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t)}matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!__PRIVATE_arrayValueContains(this.value.arrayValue,t)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>__PRIVATE_arrayValueContains(this.value.arrayValue,e)))}}class __PRIVATE_TargetImpl{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function __PRIVATE_newTarget(e,t=null,n=[],r=[],i=null,s=null,o=null){return new __PRIVATE_TargetImpl(e,t,n,r,i,s,o)}function __PRIVATE_canonifyTarget(e){const t=__PRIVATE_debugCast(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>__PRIVATE_canonifyFilter(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function __PRIVATE_canonifyOrderBy(e){return e.field.canonicalString()+e.dir}(e))).join(","),__PRIVATE_isNullOrUndefined(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>canonicalId(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>canonicalId(e))).join(",")),t.Te=e}return t.Te}function __PRIVATE_targetEquals(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!__PRIVATE_orderByEquals(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!__PRIVATE_filterEquals(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!__PRIVATE_boundEquals(e.startAt,t.startAt)&&__PRIVATE_boundEquals(e.endAt,t.endAt)}function __PRIVATE_targetIsDocumentTarget(e){return DocumentKey.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class __PRIVATE_QueryImpl{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,_=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=_,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(e,t,n,r,i,s,o,_){return new __PRIVATE_QueryImpl(e,t,n,r,i,s,o,_)}function __PRIVATE_newQueryForPath(e){return new __PRIVATE_QueryImpl(e)}function __PRIVATE_queryMatchesAllDocuments(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(e){return null!==e.collectionGroup}function __PRIVATE_queryNormalizedOrderBy(e){const t=__PRIVATE_debugCast(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function __PRIVATE_getInequalityFilterFields(e){let t=new SortedSet(FieldPath$1.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new OrderBy(r,n))})),e.has(FieldPath$1.keyField().canonicalString())||t.Ie.push(new OrderBy(FieldPath$1.keyField(),n))}return t.Ie}function __PRIVATE_queryToTarget(e){const t=__PRIVATE_debugCast(e);return t.Ee||(t.Ee=__PRIVATE__queryToTarget(t,__PRIVATE_queryNormalizedOrderBy(e))),t.Ee}function __PRIVATE__queryToTarget(e,t){if("F"===e.limitType)return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new OrderBy(e.field,t)}));const n=e.endAt?new Bound(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Bound(e.startAt.position,e.startAt.inclusive):null;return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function __PRIVATE_queryWithLimit(e,t,n){return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function __PRIVATE_queryEquals(e,t){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(e),__PRIVATE_queryToTarget(t))&&e.limitType===t.limitType}function __PRIVATE_canonifyQuery(e){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(e))}|lt:${e.limitType}`}function __PRIVATE_stringifyQuery(e){return`Query(target=${function __PRIVATE_stringifyTarget(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>__PRIVATE_stringifyFilter(e))).join(", ")}]`),__PRIVATE_isNullOrUndefined(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function __PRIVATE_stringifyOrderBy(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>canonicalId(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>canonicalId(e))).join(",")),`Target(${t})`}(__PRIVATE_queryToTarget(e))}; limitType=${e.limitType})`}function __PRIVATE_queryMatches(e,t){return t.isFoundDocument()&&function __PRIVATE_queryMatchesPathAndCollectionGroup(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):DocumentKey.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function __PRIVATE_queryMatchesOrderBy(e,t){for(const n of __PRIVATE_queryNormalizedOrderBy(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function __PRIVATE_queryMatchesFilters(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function __PRIVATE_queryMatchesBounds(e,t){return!(e.startAt&&!function __PRIVATE_boundSortsBeforeDocument(e,t,n){const r=__PRIVATE_boundCompareToDocument(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,__PRIVATE_queryNormalizedOrderBy(e),t))&&!(e.endAt&&!function __PRIVATE_boundSortsAfterDocument(e,t,n){const r=__PRIVATE_boundCompareToDocument(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,__PRIVATE_queryNormalizedOrderBy(e),t))}(e,t)}function __PRIVATE_queryCollectionGroup(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function __PRIVATE_newQueryComparator(e){return(t,n)=>{let r=!1;for(const i of __PRIVATE_queryNormalizedOrderBy(e)){const e=__PRIVATE_compareDocs(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(e,t,n){const r=e.field.isKeyField()?DocumentKey.comparator(t.key,n.key):function __PRIVATE_compareDocumentsByField(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?__PRIVATE_valueCompare(r,i):fail(42886)}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return fail(19790,{direction:e.dir})}}class ObjectMap{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){forEach(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}const Rt=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return Rt}const Vt=new SortedMap(DocumentKey.comparator);function documentMap(...e){let t=Vt;for(const n of e)t=t.insert(n.key,n);return t}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(e){let t=Vt;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap((e=>e.toString()),((e,t)=>e.isEqual(t)))}const mt=new SortedMap(DocumentKey.comparator),ft=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...e){let t=ft;for(const n of e)t=t.add(n);return t}const gt=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return gt}function __PRIVATE_toDouble(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(t)?"-0":t}}function __PRIVATE_toInteger(e){return{integerValue:""+e}}function toNumber(e,t){return isSafeInteger(t)?__PRIVATE_toInteger(t):__PRIVATE_toDouble(e,t)}class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(e,t,n){return e instanceof __PRIVATE_ServerTimestampTransform?function serverTimestamp$1(e,t){const n={fields:{[at]:{stringValue:_t},[ct]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&__PRIVATE_isServerTimestamp(t)&&(t=__PRIVATE_getPreviousValue(t)),t&&(n.fields[ut]=t),{mapValue:n}}(n,t):e instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(e,t):e instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(e,t):function __PRIVATE_applyNumericIncrementTransformOperationToLocalView(e,t){const n=__PRIVATE_computeTransformOperationBaseValue(e,t),r=asNumber(n)+asNumber(e.Ae);return isInteger(n)&&isInteger(e.Ae)?__PRIVATE_toInteger(r):__PRIVATE_toDouble(e.serializer,r)}(e,t)}function __PRIVATE_applyTransformOperationToRemoteDocument(e,t,n){return e instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(e,t):e instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(e,t):n}function __PRIVATE_computeTransformOperationBaseValue(e,t){return e instanceof __PRIVATE_NumericIncrementTransformOperation?function __PRIVATE_isNumber(e){return isInteger(e)||function __PRIVATE_isDouble(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayUnionTransformOperation(e,t){const n=__PRIVATE_coercedFieldValuesArray(t);for(const t of e.elements)n.some((e=>__PRIVATE_valueEquals(e,t)))||n.push(t);return{arrayValue:{values:n}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}function __PRIVATE_applyArrayRemoveTransformOperation(e,t){let n=__PRIVATE_coercedFieldValuesArray(t);for(const t of e.elements)n=n.filter((e=>!__PRIVATE_valueEquals(e,t)));return{arrayValue:{values:n}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function asNumber(e){return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue)}function __PRIVATE_coercedFieldValuesArray(e){return isArray(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class MutationResult{constructor(e,t){this.version=e,this.transformResults=t}}class Precondition{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Precondition}static exists(e){return new Precondition(void 0,e)}static updateTime(e){return new Precondition(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new __PRIVATE_DeleteMutation(e.key,Precondition.none()):new __PRIVATE_SetMutation(e.key,e.data,Precondition.none());{const n=e.data,r=ObjectValue.empty();let i=new SortedSet(FieldPath$1.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new __PRIVATE_PatchMutation(e.key,r,new FieldMask(i.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(e,t,n){e instanceof __PRIVATE_SetMutation?function __PRIVATE_setMutationApplyToRemoteDocument(e,t,n){const r=e.value.clone(),i=__PRIVATE_serverTransformResults(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof __PRIVATE_PatchMutation?function __PRIVATE_patchMutationApplyToRemoteDocument(e,t,n){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=__PRIVATE_serverTransformResults(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(__PRIVATE_getPatch(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function __PRIVATE_deleteMutationApplyToRemoteDocument(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function __PRIVATE_mutationApplyToLocalView(e,t,n,r){return e instanceof __PRIVATE_SetMutation?function __PRIVATE_setMutationApplyToLocalView(e,t,n,r){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return n;const i=e.value.clone(),s=__PRIVATE_localTransformResults(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof __PRIVATE_PatchMutation?function __PRIVATE_patchMutationApplyToLocalView(e,t,n,r){if(!__PRIVATE_preconditionIsValidForDocument(e.precondition,t))return n;const i=__PRIVATE_localTransformResults(e.fieldTransforms,r,t),s=t.data;return s.setAll(__PRIVATE_getPatch(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function __PRIVATE_deleteMutationApplyToLocalView(e,t,n){return __PRIVATE_preconditionIsValidForDocument(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function __PRIVATE_mutationExtractBaseValue(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=__PRIVATE_computeTransformOperationBaseValue(r.transform,e||null);null!=i&&(null===n&&(n=ObjectValue.empty()),n.set(r.field,i))}return n||null}function __PRIVATE_mutationEquals(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function __PRIVATE_fieldTransformsAreEqual(e,t){return void 0===e&&void 0===t||!(!e||!t)&&__PRIVATE_arrayEquals(e,t,((e,t)=>function __PRIVATE_fieldTransformEquals(e,t){return e.field.isEqual(t.field)&&function __PRIVATE_transformOperationEquals(e,t){return e instanceof __PRIVATE_ArrayUnionTransformOperation&&t instanceof __PRIVATE_ArrayUnionTransformOperation||e instanceof __PRIVATE_ArrayRemoveTransformOperation&&t instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(e.elements,t.elements,__PRIVATE_valueEquals):e instanceof __PRIVATE_NumericIncrementTransformOperation&&t instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(e.Ae,t.Ae):e instanceof __PRIVATE_ServerTimestampTransform&&t instanceof __PRIVATE_ServerTimestampTransform}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function __PRIVATE_serverTransformResults(e,t,n){const r=new Map;__PRIVATE_hardAssert(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,_=t.data.field(s.field);r.set(s.field,__PRIVATE_applyTransformOperationToRemoteDocument(o,_,n[i]))}return r}function __PRIVATE_localTransformResults(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,__PRIVATE_applyTransformOperationToLocalView(e,s,t))}return r}class __PRIVATE_DeleteMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class MutationBatch{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&__PRIVATE_mutationApplyToRemoteDocument(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=__PRIVATE_mutationApplyToLocalView(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=__PRIVATE_newMutationMap();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const _=__PRIVATE_calculateOverlayMutation(s,o);null!==_&&n.set(r.key,_),s.isValidDocument()||s.convertToNoDocument(SnapshotVersion.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),__PRIVATE_documentKeySet())}isEqual(e){return this.batchId===e.batchId&&__PRIVATE_arrayEquals(this.mutations,e.mutations,((e,t)=>__PRIVATE_mutationEquals(e,t)))&&__PRIVATE_arrayEquals(this.baseMutations,e.baseMutations,((e,t)=>__PRIVATE_mutationEquals(e,t)))}}class MutationBatchResult{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){__PRIVATE_hardAssert(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=function __PRIVATE_documentVersionMap(){return mt}();const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new MutationBatchResult(e,t,n,r)}}class Overlay{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ExistenceFilter{constructor(e,t){this.count=e,this.unchangedNames=t}}var pt,yt;function __PRIVATE_isPermanentError(e){switch(e){case N.OK:return fail(64938);case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0;default:return fail(15467,{code:e})}}function __PRIVATE_mapCodeFromRpcCode(e){if(void 0===e)return __PRIVATE_logError("GRPC error has no .code"),N.UNKNOWN;switch(e){case pt.OK:return N.OK;case pt.CANCELLED:return N.CANCELLED;case pt.UNKNOWN:return N.UNKNOWN;case pt.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case pt.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case pt.INTERNAL:return N.INTERNAL;case pt.UNAVAILABLE:return N.UNAVAILABLE;case pt.UNAUTHENTICATED:return N.UNAUTHENTICATED;case pt.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case pt.NOT_FOUND:return N.NOT_FOUND;case pt.ALREADY_EXISTS:return N.ALREADY_EXISTS;case pt.PERMISSION_DENIED:return N.PERMISSION_DENIED;case pt.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case pt.ABORTED:return N.ABORTED;case pt.OUT_OF_RANGE:return N.OUT_OF_RANGE;case pt.UNIMPLEMENTED:return N.UNIMPLEMENTED;case pt.DATA_LOSS:return N.DATA_LOSS;default:return fail(39323,{code:e})}}(yt=pt||(pt={}))[yt.OK=0]="OK",yt[yt.CANCELLED=1]="CANCELLED",yt[yt.UNKNOWN=2]="UNKNOWN",yt[yt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",yt[yt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",yt[yt.NOT_FOUND=5]="NOT_FOUND",yt[yt.ALREADY_EXISTS=6]="ALREADY_EXISTS",yt[yt.PERMISSION_DENIED=7]="PERMISSION_DENIED",yt[yt.UNAUTHENTICATED=16]="UNAUTHENTICATED",yt[yt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",yt[yt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",yt[yt.ABORTED=10]="ABORTED",yt[yt.OUT_OF_RANGE=11]="OUT_OF_RANGE",yt[yt.UNIMPLEMENTED=12]="UNIMPLEMENTED",yt[yt.INTERNAL=13]="INTERNAL",yt[yt.UNAVAILABLE=14]="UNAVAILABLE",yt[yt.DATA_LOSS=15]="DATA_LOSS";let wt=null;function __PRIVATE_newTextEncoder(){return new TextEncoder}const St=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(e){const t=__PRIVATE_newTextEncoder().encode(e),n=new Md5;return n.update(t),new Uint8Array(n.digest())}function __PRIVATE_get64BitUints(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Integer([n,r],0),new Integer([i,s],0)]}class BloomFilter{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${t}`);if(n<0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Integer.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(Integer.fromNumber(n)));return 1===r.compare(St)&&(r=new Integer([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let e=0;e<this.hashCount;e++){const t=this.ye(n,r,e);if(!this.we(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new BloomFilter(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.ge)return;const t=__PRIVATE_getMd5HashValue(e),[n,r]=__PRIVATE_get64BitUints(t);for(let e=0;e<this.hashCount;e++){const t=this.ye(n,r,e);this.Se(t)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class RemoteEvent{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,TargetChange.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new RemoteEvent(SnapshotVersion.min(),r,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new TargetChange(n,t,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}class __PRIVATE_DocumentWatchChange{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class __PRIVATE_ExistenceFilterChange{constructor(e,t){this.targetId=e,this.Ce=t}}class __PRIVATE_WatchTargetChange{constructor(e,t,n=ByteString.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class __PRIVATE_TargetState{constructor(){this.ve=0,this.Fe=__PRIVATE_snapshotChangesMap(),this.Me=ByteString.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=__PRIVATE_documentKeySet(),t=__PRIVATE_documentKeySet(),n=__PRIVATE_documentKeySet();return this.Fe.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:fail(38017,{changeType:i})}})),new TargetChange(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=__PRIVATE_snapshotChangesMap()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,__PRIVATE_hardAssert(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class __PRIVATE_WatchChangeAggregator{constructor(e){this.Ge=e,this.ze=new Map,this.je=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=__PRIVATE_documentTargetMap(),this.Ye=new SortedMap(__PRIVATE_primitiveComparator)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:fail(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((e,n)=>{this.rt(n)&&t(n)}))}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const i=r.target;if(__PRIVATE_targetIsDocumentTarget(i))if(0===n){const e=new DocumentKey(i.path);this.et(t,e,MutableDocument.newNoDocument(e,SnapshotVersion.min()))}else __PRIVATE_hardAssert(1===n,20013,{expectedCount:n});else{const r=this._t(t);if(r!==n){const n=this.ut(e),i=n?this.ct(n,e,r):1;if(0!==i){this.it(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}wt?.lt(function __PRIVATE_createExistenceFilterMismatchInfoForTestingHooks(e,t,n,r,i){const s={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},o=t.unchangedNames;return o&&(s.bloomFilter={applied:0===i,hashCount:o?.hashCount??0,bitmapLength:o?.bits?.bitmap?.length??0,padding:o?.bits?.padding??0,mightContain:e=>r?.mightContain(e)??!1}),s}(r,e.Ce,this.Ge.ht(),n,i))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=__PRIVATE_normalizeByteString(n).toUint8Array()}catch(e){if(e instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new BloomFilter(s,r,i)}catch(e){return __PRIVATE_logWarn(e instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.ge?null:o}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((n,r)=>{const i=this.ot(r);if(i){if(n.current&&__PRIVATE_targetIsDocumentTarget(i.target)){const t=new DocumentKey(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,MutableDocument.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}}));let n=__PRIVATE_documentKeySet();this.He.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.je.forEach(((t,n)=>n.setReadTime(e)));const r=new RemoteEvent(e,t,this.Ye,this.je,n);return this.je=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.He=__PRIVATE_documentTargetMap(),this.Ye=new SortedMap(__PRIVATE_primitiveComparator),r}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new __PRIVATE_TargetState,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new SortedSet(__PRIVATE_primitiveComparator),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new __PRIVATE_TargetState),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const bt={asc:"ASCENDING",desc:"DESCENDING"},Dt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ct={and:"AND",or:"OR"};class JsonProtoSerializer{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function __PRIVATE_toInt32Proto(e,t){return e.useProto3Json||__PRIVATE_isNullOrUndefined(t)?t:{value:t}}function toTimestamp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function __PRIVATE_toBytes(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function __PRIVATE_toVersion(e,t){return toTimestamp(e,t.toTimestamp())}function __PRIVATE_fromVersion(e){return __PRIVATE_hardAssert(!!e,49232),SnapshotVersion.fromTimestamp(function fromTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}(e))}function __PRIVATE_toResourceName(e,t){return __PRIVATE_toResourcePath(e,t).canonicalString()}function __PRIVATE_toResourcePath(e,t){const n=function __PRIVATE_fullyQualifiedPrefixPath(e){return new ResourcePath(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function __PRIVATE_fromResourceName(e){const t=ResourcePath.fromString(e);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(t),10190,{key:t.toString()}),t}function __PRIVATE_toName(e,t){return __PRIVATE_toResourceName(e.databaseId,t.path)}function fromName(e,t){const n=__PRIVATE_fromResourceName(t);if(n.get(1)!==e.databaseId.projectId)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(n))}function __PRIVATE_toQueryPath(e,t){return __PRIVATE_toResourceName(e.databaseId,t)}function __PRIVATE_fromQueryPath(e){const t=__PRIVATE_fromResourceName(e);return 4===t.length?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(t)}function __PRIVATE_getEncodedDatabaseId(e){return new ResourcePath(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(e){return __PRIVATE_hardAssert(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function __PRIVATE_toMutationDocument(e,t,n){return{name:__PRIVATE_toName(e,t),fields:n.value.mapValue.fields}}function toMutation(e,t){let n;if(t instanceof __PRIVATE_SetMutation)n={update:__PRIVATE_toMutationDocument(e,t.key,t.value)};else if(t instanceof __PRIVATE_DeleteMutation)n={delete:__PRIVATE_toName(e,t.key)};else if(t instanceof __PRIVATE_PatchMutation)n={update:__PRIVATE_toMutationDocument(e,t.key,t.data),updateMask:__PRIVATE_toDocumentMask(t.fieldMask)};else{if(!(t instanceof __PRIVATE_VerifyMutation))return fail(16599,{Vt:t.type});n={verify:__PRIVATE_toName(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function __PRIVATE_toFieldTransform(e,t){const n=t.transform;if(n instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw fail(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function __PRIVATE_toPrecondition(e,t){return void 0!==t.updateTime?{updateTime:__PRIVATE_toVersion(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:fail(27497)}(e,t.precondition)),n}function __PRIVATE_toDocumentsTarget(e,t){return{documents:[__PRIVATE_toQueryPath(e,t.path)]}}function __PRIVATE_toQueryTarget(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=__PRIVATE_toQueryPath(e,i);const s=function __PRIVATE_toFilters(e){if(0!==e.length)return __PRIVATE_toFilter(CompositeFilter.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function __PRIVATE_toOrder(e){if(0!==e.length)return e.map((e=>function __PRIVATE_toPropertyOrder(e){return{field:__PRIVATE_toFieldPathReference(e.field),direction:__PRIVATE_toDirection(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const _=__PRIVATE_toInt32Proto(e,t.limit);return null!==_&&(n.structuredQuery.limit=_),t.startAt&&(n.structuredQuery.startAt=function __PRIVATE_toStartAtCursor(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function __PRIVATE_toEndAtCursor(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:i}}function __PRIVATE_convertQueryTargetToQuery(e){let t=__PRIVATE_fromQueryPath(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){__PRIVATE_hardAssert(1===r,65062);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function __PRIVATE_fromFilters(e){const t=__PRIVATE_fromFilter(e);return t instanceof CompositeFilter&&__PRIVATE_compositeFilterIsFlatConjunction(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function __PRIVATE_fromOrder(e){return e.map((e=>function __PRIVATE_fromPropertyOrder(e){return new OrderBy(__PRIVATE_fromFieldPathReference(e.field),function __PRIVATE_fromDirection(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let _=null;n.limit&&(_=function __PRIVATE_fromInt32Proto(e){let t;return t="object"==typeof e?e.value:e,__PRIVATE_isNullOrUndefined(t)?null:t}(n.limit));let a=null;n.startAt&&(a=function __PRIVATE_fromStartAtCursor(e){const t=!!e.before,n=e.values||[];return new Bound(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function __PRIVATE_fromEndAtCursor(e){const t=!e.before,n=e.values||[];return new Bound(n,t)}(n.endAt)),__PRIVATE_newQuery(t,i,o,s,_,"F",a,u)}function __PRIVATE_fromFilter(e){return void 0!==e.unaryFilter?function __PRIVATE_fromUnaryFilter(e){switch(e.unaryFilter.op){case"IS_NAN":const t=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=__PRIVATE_fromFieldPathReference(e.unaryFilter.field);return FieldFilter.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fail(61313);default:return fail(60726)}}(e):void 0!==e.fieldFilter?function __PRIVATE_fromFieldFilter(e){return FieldFilter.create(__PRIVATE_fromFieldPathReference(e.fieldFilter.field),function __PRIVATE_fromOperatorName(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fail(58110);default:return fail(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function __PRIVATE_fromCompositeFilter(e){return CompositeFilter.create(e.compositeFilter.filters.map((e=>__PRIVATE_fromFilter(e))),function __PRIVATE_fromCompositeOperatorName(e){switch(e){case"AND":return"and";case"OR":return"or";default:return fail(1026)}}(e.compositeFilter.op))}(e):fail(30097,{filter:e})}function __PRIVATE_toDirection(e){return bt[e]}function __PRIVATE_toOperatorName(e){return Dt[e]}function __PRIVATE_toCompositeOperatorName(e){return Ct[e]}function __PRIVATE_toFieldPathReference(e){return{fieldPath:e.canonicalString()}}function __PRIVATE_fromFieldPathReference(e){return FieldPath$1.fromServerFormat(e.fieldPath)}function __PRIVATE_toFilter(e){return e instanceof FieldFilter?function __PRIVATE_toUnaryOrFieldFilter(e){if("=="===e.op){if(__PRIVATE_isNanValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(__PRIVATE_isNanValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(e.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(e.field),op:__PRIVATE_toOperatorName(e.op),value:e.value}}}(e):e instanceof CompositeFilter?function __PRIVATE_toCompositeFilter(e){const t=e.getFilters().map((e=>__PRIVATE_toFilter(e)));return 1===t.length?t[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(e.op),filters:t}}}(e):fail(54877,{filter:e})}function __PRIVATE_toDocumentMask(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function __PRIVATE_isValidResourceName(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class TargetData{constructor(e,t,n,r,i=SnapshotVersion.min(),s=SnapshotVersion.min(),o=ByteString.EMPTY_BYTE_STRING,_=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=_}withSequenceNumber(e){return new TargetData(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class __PRIVATE_LocalSerializer{constructor(e){this.yt=e}}function __PRIVATE_fromBundledQuery(e){const t=__PRIVATE_convertQueryTargetToQuery({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?__PRIVATE_queryWithLimit(t,t.limit,"L"):t}class __PRIVATE_FirestoreIndexValueWriter{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(__PRIVATE_normalizeNumber(e.integerValue));else if("doubleValue"in e){const n=__PRIVATE_normalizeNumber(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),__PRIVATE_isNegativeZero(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=__PRIVATE_normalizeTimestamp(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(__PRIVATE_normalizeByteString(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?__PRIVATE_isMaxValue(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):__PRIVATE_isVectorValue(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):fail(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const n=e.fields||{};this.Ft(t,55);for(const e of Object.keys(n))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){const n=e.fields||{};this.Ft(t,53);const r=Et,i=n[r].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(__PRIVATE_normalizeNumber(i)),this.Ot(r,t),this.Ct(n[r],t)}Qt(e,t){const n=e.values||[];this.Ft(t,50);for(const e of n)this.Ct(e,t)}Lt(e,t){this.Ft(t,37),DocumentKey.fromName(e).path.forEach((e=>{this.Ft(t,60),this.Ut(e,t)}))}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}__PRIVATE_FirestoreIndexValueWriter.Kt=new __PRIVATE_FirestoreIndexValueWriter;class __PRIVATE_MemoryIndexManager{constructor(){this.Cn=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(e,t){return this.Cn.add(t),PersistencePromise.resolve()}getCollectionParents(e,t){return PersistencePromise.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return PersistencePromise.resolve()}deleteFieldIndex(e,t){return PersistencePromise.resolve()}deleteAllFieldIndexes(e){return PersistencePromise.resolve()}createTargetIndexes(e,t){return PersistencePromise.resolve()}getDocumentsMatchingTarget(e,t){return PersistencePromise.resolve(null)}getIndexType(e,t){return PersistencePromise.resolve(0)}getFieldIndexes(e,t){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(e){return PersistencePromise.resolve(null)}getMinOffset(e,t){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(e,t){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(e,t,n){return PersistencePromise.resolve()}updateIndexEntries(e,t){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new SortedSet(ResourcePath.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new SortedSet(ResourcePath.comparator)).toArray()}}new Uint8Array(0);const xt={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class LruParams{static withCacheSize(e){return new LruParams(e,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(41943040,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);class __PRIVATE_TargetIdGenerator{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new __PRIVATE_TargetIdGenerator(0)}static cr(){return new __PRIVATE_TargetIdGenerator(-1)}}const Nt="LruGarbageCollector";function __PRIVATE_bufferEntryComparator([e,t],[n,r]){const i=__PRIVATE_primitiveComparator(e,n);return 0===i?__PRIVATE_primitiveComparator(t,r):i}class __PRIVATE_RollingSequenceNumberBuffer{constructor(e){this.Ir=e,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();__PRIVATE_bufferEntryComparator(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class __PRIVATE_LruScheduler{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){__PRIVATE_logDebug(Nt,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){__PRIVATE_isIndexedDbTransactionError(e)?__PRIVATE_logDebug(Nt,"Ignoring IndexedDB error during garbage collection: ",e):await __PRIVATE_ignoreIfPrimaryLeaseLoss(e)}await this.Vr(3e5)}))}}class __PRIVATE_LruGarbageCollectorImpl{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return PersistencePromise.resolve(__PRIVATE_ListenSequence.ce);const n=new __PRIVATE_RollingSequenceNumberBuffer(t);return this.mr.forEachTarget(e,(e=>n.Ar(e.sequenceNumber))).next((()=>this.mr.pr(e,(e=>n.Ar(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(xt)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xt):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,o,_,u;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,_=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),__PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-c}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(_-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-_)+"ms\n"+`Total Duration: ${u-c}ms`),PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function __PRIVATE_newLruGarbageCollector(e,t){return new __PRIVATE_LruGarbageCollectorImpl(e,t)}class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,MutableDocument.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?PersistencePromise.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class OverlayedDocument{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class LocalDocumentsView{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&__PRIVATE_mutationApplyToLocalView(n.mutation,e,FieldMask.empty(),Timestamp.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,__PRIVATE_documentKeySet()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=__PRIVATE_documentKeySet()){const r=__PRIVATE_newOverlayMap();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=documentMap();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=__PRIVATE_newOverlayMap();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,__PRIVATE_documentKeySet())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=__PRIVATE_mutableDocumentMap();const s=__PRIVATE_newDocumentKeyMap(),o=function __PRIVATE_newOverlayedDocumentMap(){return __PRIVATE_newDocumentKeyMap()}();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof __PRIVATE_PatchMutation)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(o.mutation,t,o.mutation.getFieldMask(),Timestamp.now())):s.set(t.key,FieldMask.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>o.set(e,new OverlayedDocument(t,s.get(e)??null)))),o)))}recalculateAndSaveOverlays(e,t){const n=__PRIVATE_newDocumentKeyMap();let r=new SortedMap(((e,t)=>e-t)),i=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||FieldMask.empty();o=i.applyToLocalView(s,o),n.set(e,o);const _=(r.get(i.batchId)||__PRIVATE_documentKeySet()).add(e);r=r.insert(i.batchId,_)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),_=r.key,a=r.value,u=__PRIVATE_newMutationMap();a.forEach((e=>{if(!i.has(e)){const r=__PRIVATE_calculateOverlayMutation(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,_,u))}return PersistencePromise.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function __PRIVATE_isDocumentQuery$1(e){return DocumentKey.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):__PRIVATE_isCollectionGroupQuery(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let o=U,_=i;return s.next((t=>PersistencePromise.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{_=_.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,_,t,__PRIVATE_documentKeySet()))).next((e=>({batchId:o,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new DocumentKey(t)).next((e=>{let t=documentMap();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=documentMap();return this.indexManager.getCollectionParents(e,i).next((o=>PersistencePromise.forEach(o,(o=>{const _=function __PRIVATE_asCollectionQueryAtPath(e,t){return new __PRIVATE_QueryImpl(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,_,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,MutableDocument.newInvalidDocument(r)))}));let n=documentMap();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&__PRIVATE_mutationApplyToLocalView(s.mutation,r,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(t,r)&&(n=n.insert(e,r))})),n}))}}class __PRIVATE_MemoryBundleCache{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return PersistencePromise.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function __PRIVATE_fromBundleMetadata(e){return{id:e.id,version:e.version,createTime:__PRIVATE_fromVersion(e.createTime)}}(t)),PersistencePromise.resolve()}getNamedQuery(e,t){return PersistencePromise.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function __PRIVATE_fromProtoNamedQuery(e){return{name:e.name,query:__PRIVATE_fromBundledQuery(e.bundledQuery),readTime:__PRIVATE_fromVersion(e.readTime)}}(t)),PersistencePromise.resolve()}}class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.qr=new Map}getOverlay(e,t){return PersistencePromise.resolve(this.overlays.get(t))}getOverlays(e,t){const n=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.St(e,t,r)})),PersistencePromise.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.qr.delete(n)),PersistencePromise.resolve()}getOverlaysForCollection(e,t,n){const r=__PRIVATE_newOverlayMap(),i=t.length+1,s=new DocumentKey(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return PersistencePromise.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new SortedMap(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=__PRIVATE_newOverlayMap(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=__PRIVATE_newOverlayMap(),_=i.getIterator();for(;_.hasNext()&&(_.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return PersistencePromise.resolve(o)}St(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Overlay(t,n));let i=this.qr.get(t);void 0===i&&(i=__PRIVATE_documentKeySet(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(e){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,PersistencePromise.resolve()}}class __PRIVATE_ReferenceSet{constructor(){this.Qr=new SortedSet(__PRIVATE_DocReference.$r),this.Ur=new SortedSet(__PRIVATE_DocReference.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new __PRIVATE_DocReference(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Gr(new __PRIVATE_DocReference(e,t))}zr(e,t){e.forEach((e=>this.removeReference(e,t)))}jr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1),i=[];return this.Ur.forEachInRange([n,r],(e=>{this.Gr(e),i.push(e.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new DocumentKey(new ResourcePath([])),n=new __PRIVATE_DocReference(t,e),r=new __PRIVATE_DocReference(t,e+1);let i=__PRIVATE_documentKeySet();return this.Ur.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new __PRIVATE_DocReference(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class __PRIVATE_DocReference{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return DocumentKey.comparator(e.key,t.key)||__PRIVATE_primitiveComparator(e.Yr,t.Yr)}static Kr(e,t){return __PRIVATE_primitiveComparator(e.Yr,t.Yr)||DocumentKey.comparator(e.key,t.key)}}class __PRIVATE_MemoryMutationQueue{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new SortedSet(__PRIVATE_DocReference.$r)}checkEmpty(e){return PersistencePromise.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new MutationBatch(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Zr=this.Zr.add(new __PRIVATE_DocReference(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return PersistencePromise.resolve(s)}lookupMutationBatch(e,t){return PersistencePromise.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.ei(n),i=r<0?0:r;return PersistencePromise.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(0===this.mutationQueue.length?j:this.tr-1)}getAllMutationBatches(e){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=new __PRIVATE_DocReference(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,r],(e=>{const t=this.Xr(e.Yr);i.push(t)})),PersistencePromise.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new SortedSet(__PRIVATE_primitiveComparator);return t.forEach((e=>{const t=new __PRIVATE_DocReference(e,0),r=new __PRIVATE_DocReference(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],(e=>{n=n.add(e.Yr)}))})),PersistencePromise.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;DocumentKey.isDocumentKey(i)||(i=i.child(""));const s=new __PRIVATE_DocReference(new DocumentKey(i),0);let o=new SortedSet(__PRIVATE_primitiveComparator);return this.Zr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)}),s),PersistencePromise.resolve(this.ti(o))}ti(e){const t=[];return e.forEach((e=>{const n=this.Xr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){__PRIVATE_hardAssert(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return PersistencePromise.forEach(t.mutations,(r=>{const i=new __PRIVATE_DocReference(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Zr=n}))}ir(e){}containsKey(e,t){const n=new __PRIVATE_DocReference(t,0),r=this.Zr.firstAfterOrEqual(n);return PersistencePromise.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,PersistencePromise.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(e){this.ri=e,this.docs=function __PRIVATE_documentEntryMap(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return PersistencePromise.resolve(n?n.document.mutableCopy():MutableDocument.newInvalidDocument(t))}getEntries(e,t){let n=__PRIVATE_mutableDocumentMap();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():MutableDocument.newInvalidDocument(e))})),PersistencePromise.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=__PRIVATE_mutableDocumentMap();const s=t.path,o=new DocumentKey(s.child("__id-9223372036854775808__")),_=this.docs.getIteratorFrom(o);for(;_.hasNext();){const{key:e,value:{document:o}}=_.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(o),n)<=0||(r.has(o.key)||__PRIVATE_queryMatches(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return PersistencePromise.resolve(i)}getAllFromCollectionGroup(e,t,n,r){fail(9500)}ii(e,t){return PersistencePromise.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(e){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)})),PersistencePromise.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class __PRIVATE_MemoryTargetCache{constructor(e){this.persistence=e,this.si=new ObjectMap((e=>__PRIVATE_canonifyTarget(e)),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.oi=0,this._i=new __PRIVATE_ReferenceSet,this.targetCount=0,this.ai=__PRIVATE_TargetIdGenerator.ur()}forEachTarget(e,t){return this.si.forEach(((e,n)=>t(n))),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(e){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return PersistencePromise.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),PersistencePromise.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new __PRIVATE_TargetIdGenerator(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(e,t){return this.Pr(t),PersistencePromise.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.si.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),PersistencePromise.waitFor(i).next((()=>r))}getTargetCount(e){return PersistencePromise.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return PersistencePromise.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),PersistencePromise.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),PersistencePromise.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),PersistencePromise.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return PersistencePromise.resolve(n)}containsKey(e,t){return PersistencePromise.resolve(this._i.containsKey(t))}}class __PRIVATE_MemoryPersistence{constructor(e,t){this.ui={},this.overlays={},this.ci=new __PRIVATE_ListenSequence(0),this.li=!1,this.li=!0,this.hi=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=e(this),this.Pi=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function __PRIVATE_newMemoryRemoteDocumentCache(e){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(e)}((e=>this.referenceDelegate.Ti(e))),this.serializer=new __PRIVATE_LocalSerializer(t),this.Ii=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new __PRIVATE_MemoryMutationQueue(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",e);const r=new __PRIVATE_MemoryTransaction(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((e=>this.referenceDelegate.di(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ai(e,t){return PersistencePromise.or(Object.values(this.ui).map((n=>()=>n.containsKey(e,t))))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(e){super(),this.currentSequenceNumber=e}}class __PRIVATE_MemoryEagerDelegate{constructor(e){this.persistence=e,this.Ri=new __PRIVATE_ReferenceSet,this.Vi=null}static mi(e){return new __PRIVATE_MemoryEagerDelegate(e)}get fi(){if(this.Vi)return this.Vi;throw fail(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),PersistencePromise.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),PersistencePromise.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((e=>this.fi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.fi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.fi,(n=>{const r=DocumentKey.fromPath(n);return this.gi(e,r).next((e=>{e||t.removeEntry(r,SnapshotVersion.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return PersistencePromise.or([()=>PersistencePromise.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class __PRIVATE_MemoryLruDelegate{constructor(e,t){this.persistence=e,this.pi=new ObjectMap((e=>__PRIVATE_encodeResourcePath(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,t)}static mi(e,t){return new __PRIVATE_MemoryLruDelegate(e,t)}Ei(){}di(e){return PersistencePromise.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}wr(e){let t=0;return this.pr(e,(e=>{t++})).next((()=>t))}pr(e,t){return PersistencePromise.forEach(this.pi,((n,r)=>this.br(e,n,r).next((e=>e?PersistencePromise.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,(r=>this.br(e,r,t).next((e=>{e||(n++,i.removeEntry(r,SnapshotVersion.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),PersistencePromise.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=__PRIVATE_estimateByteSize(e.data.value)),t}br(e,t,n){return PersistencePromise.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return PersistencePromise.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class __PRIVATE_LocalViewChanges{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=__PRIVATE_documentKeySet(),r=__PRIVATE_documentKeySet();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new __PRIVATE_LocalViewChanges(e,t.fromCache,n,r)}}class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class __PRIVATE_QueryEngine{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function __PRIVATE_getDefaultRelativeIndexReadCostPerDocument(){return(0,dist_index_esm.nr)()?8:__PRIVATE_getAndroidVersion((0,dist_index_esm.ZQ)())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ys(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ws(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new QueryContext;return this.Ss(e,t,n).next((r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)}))})).next((()=>i.result))}bs(e,t,n,r){return n.documentReadCount<this.fs?(__PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(__PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,__PRIVATE_queryToTarget(t))):PersistencePromise.resolve())}ys(e,t){if(__PRIVATE_queryMatchesAllDocuments(t))return PersistencePromise.resolve(null);let n=__PRIVATE_queryToTarget(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=__PRIVATE_queryWithLimit(t,null,"F"),n=__PRIVATE_queryToTarget(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=__PRIVATE_documentKeySet(...r);return this.ps.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,__PRIVATE_queryWithLimit(t,null,"F")):this.vs(e,s,t,n)}))))})))))}ws(e,t,n,r){return __PRIVATE_queryMatchesAllDocuments(t)||r.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.ps.getDocuments(e,n).next((i=>{const s=this.Ds(t,i);return this.Cs(t,s,n,r)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),__PRIVATE_stringifyQuery(t)),this.vs(e,s,t,__PRIVATE_newIndexOffsetSuccessorFromReadTime(r,U)).next((e=>e)))}))}Ds(e,t){let n=new SortedSet(__PRIVATE_newQueryComparator(e));return t.forEach(((t,r)=>{__PRIVATE_queryMatches(e,r)&&(n=n.add(r))})),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return __PRIVATE_getLogLevel()<=dist_esm_index_esm.$b.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(t)),this.ps.getDocumentsMatchingQuery(e,t,IndexOffset.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const Ut="LocalStore",Kt=3e8;class __PRIVATE_LocalStoreImpl{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new SortedMap(__PRIVATE_primitiveComparator),this.xs=new ObjectMap((e=>__PRIVATE_canonifyTarget(e)),__PRIVATE_targetEquals),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LocalDocumentsView(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function __PRIVATE_newLocalStore(e,t,n,r){return new __PRIVATE_LocalStoreImpl(e,t,n,r)}async function __PRIVATE_localStoreHandleUserChange(e,t){const n=__PRIVATE_debugCast(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.Bs(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=__PRIVATE_documentKeySet();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Ls:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e){const t=__PRIVATE_debugCast(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function __PRIVATE_populateDocumentChangeBuffer(e,t,n){let r=__PRIVATE_documentKeySet(),i=__PRIVATE_documentKeySet();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=__PRIVATE_mutableDocumentMap();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(SnapshotVersion.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):__PRIVATE_logDebug(Ut,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{ks:r,qs:i}}))}function __PRIVATE_localStoreGetNextMutationBatch(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=j),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function __PRIVATE_localStoreAllocateTarget(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Pi.getTargetData(e,t).next((i=>i?(r=i,PersistencePromise.resolve(r)):n.Pi.allocateTargetId(e).next((i=>(r=new TargetData(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e}))}async function __PRIVATE_localStoreReleaseTarget(e,t,n){const r=__PRIVATE_debugCast(e),i=r.Ms.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug(Ut,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ms=r.Ms.remove(t),r.xs.delete(i.target)}function __PRIVATE_localStoreExecuteQuery(e,t,n){const r=__PRIVATE_debugCast(e);let i=SnapshotVersion.min(),s=__PRIVATE_documentKeySet();return r.persistence.runTransaction("Execute query","readwrite",(e=>function __PRIVATE_localStoreGetTargetData(e,t,n){const r=__PRIVATE_debugCast(e),i=r.xs.get(n);return void 0!==i?PersistencePromise.resolve(r.Ms.get(i)):r.Pi.getTargetData(t,n)}(r,e,__PRIVATE_queryToTarget(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Fs.getDocumentsMatchingQuery(e,t,n?i:SnapshotVersion.min(),n?s:__PRIVATE_documentKeySet()))).next((e=>(__PRIVATE_setMaxReadTime(r,__PRIVATE_queryCollectionGroup(t),e),{documents:e,Qs:s})))))}function __PRIVATE_setMaxReadTime(e,t,n){let r=e.Os.get(t)||SnapshotVersion.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Os.set(t,r)}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class __PRIVATE_MemorySharedClientState{constructor(){this.Mo=new __PRIVATE_LocalClientState,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class __PRIVATE_NoopConnectivityMonitor{Oo(e){}shutdown(){}}const Jt="ConnectivityMonitor";class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){__PRIVATE_logDebug(Jt,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){__PRIVATE_logDebug(Jt,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ht=null;function __PRIVATE_generateUniqueDebugId(){return null===Ht?Ht=function __PRIVATE_generateInitialUniqueDebugId(){return 268435456+Math.round(2147483648*Math.random())}():Ht++,"0x"+Ht.toString(16)}const Yt="RestConnection",Zt={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class __PRIVATE_RestConnection{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===lt?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){const s=__PRIVATE_generateUniqueDebugId(),o=this.zo(e,t.toUriEncodedString());__PRIVATE_logDebug(Yt,`Sending RPC '${e}' ${s}:`,o,n);const _={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(_,r,i);const{host:a}=new URL(o),u=(0,dist_index_esm.zJ)(a);return this.Jo(e,o,_,n,u).then((t=>(__PRIVATE_logDebug(Yt,`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw __PRIVATE_logWarn(Yt,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]=function __PRIVATE_getGoogApiClientValue(){return"gl-js/ fire/"+x}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}zo(e,t){const n=Zt[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class __PRIVATE_StreamBridge{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Xt="WebChannelConnection";class __PRIVATE_WebChannelConnection extends __PRIVATE_RestConnection{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){const s=__PRIVATE_generateUniqueDebugId();return new Promise(((i,o)=>{const _=new XhrIo;_.setWithCredentials(!0),_.listenOnce(EventType.COMPLETE,(()=>{try{switch(_.getLastErrorCode()){case ErrorCode.NO_ERROR:const t=_.getResponseJson();__PRIVATE_logDebug(Xt,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case ErrorCode.TIMEOUT:__PRIVATE_logDebug(Xt,`RPC '${e}' ${s} timed out`),o(new FirestoreError(N.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:const n=_.getStatus();if(__PRIVATE_logDebug(Xt,`RPC '${e}' ${s} failed with status:`,n,"response text:",_.getResponseText()),n>0){let e=_.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function __PRIVATE_mapCodeFromHttpResponseErrorStatus(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(t)>=0?t:N.UNKNOWN}(t.status);o(new FirestoreError(e,t.message))}else o(new FirestoreError(N.UNKNOWN,"Server responded with status "+_.getStatus()))}else o(new FirestoreError(N.UNAVAILABLE,"Connection failed."));break;default:fail(9055,{l_:e,streamId:s,h_:_.getLastErrorCode(),P_:_.getLastError()})}}finally{__PRIVATE_logDebug(Xt,`RPC '${e}' ${s} completed.`)}}));const a=JSON.stringify(r);__PRIVATE_logDebug(Xt,`RPC '${e}' ${s} sending request:`,r),_.send(t,"POST",a,n,15)}))}T_(e,t,n){const r=__PRIVATE_generateUniqueDebugId(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=createWebChannelTransport(),o=getStatEventTarget(),_={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(_.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(_.useFetchStreams=!0),this.jo(_.initMessageHeaders,t,n),_.encodeInitMessageHeaders=!0;const u=i.join("");__PRIVATE_logDebug(Xt,`Creating RPC '${e}' stream ${r}: ${u}`,_);const c=s.createWebChannel(u,_);this.I_(c);let l=!1,h=!1;const P=new __PRIVATE_StreamBridge({Yo:t=>{h?__PRIVATE_logDebug(Xt,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(__PRIVATE_logDebug(Xt,`Opening RPC '${e}' stream ${r} transport.`),c.open(),l=!0),__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},Zo:()=>c.close()}),__PRIVATE_unguardedEventListen=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return __PRIVATE_unguardedEventListen(c,WebChannel.EventType.OPEN,(()=>{h||(__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} transport opened.`),P.o_())})),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.CLOSE,(()=>{h||(h=!0,__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} transport closed`),P.a_(),this.E_(c))})),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.ERROR,(t=>{h||(h=!0,__PRIVATE_logWarn(Xt,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),P.a_(new FirestoreError(N.UNAVAILABLE,"The operation could not be completed")))})),__PRIVATE_unguardedEventListen(c,WebChannel.EventType.MESSAGE,(t=>{if(!h){const n=t.data[0];__PRIVATE_hardAssert(!!n,16349);const i=n,s=i?.error||i[0]?.error;if(s){__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} received error:`,s);const t=s.status;let n=function __PRIVATE_mapCodeFromRpcStatus(e){const t=pt[e];if(void 0!==t)return __PRIVATE_mapCodeFromRpcCode(t)}(t),i=s.message;void 0===n&&(n=N.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),h=!0,P.a_(new FirestoreError(n,i)),c.close()}else __PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} received:`,n),P.u_(n)}})),__PRIVATE_unguardedEventListen(o,Event.STAT_EVENT,(t=>{t.stat===Stat.PROXY?__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Stat.NOPROXY&&__PRIVATE_logDebug(Xt,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function getDocument(){return"undefined"!=typeof document?document:null}function __PRIVATE_newSerializer(e){return new JsonProtoSerializer(e,!0)}class __PRIVATE_ExponentialBackoff{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const en="PersistentStream";class __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s,o,_){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=_,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new __PRIVATE_ExponentialBackoff(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(__PRIVATE_logError(t.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===N.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.D_===t&&this.G_(e,n)}),(t=>{e((()=>{const e=new FirestoreError(N.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)}))}))}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((e=>{n((()=>this.z_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.F_?this.J_(e):this.onNext(e)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return __PRIVATE_logDebug(en,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(__PRIVATE_logDebug(en,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function __PRIVATE_fromWatchChange(e,t){let n;if("targetChange"in t){t.targetChange;const r=function __PRIVATE_fromWatchTargetChangeState(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:fail(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function __PRIVATE_fromBytes(e,t){return e.useProto3Json?(__PRIVATE_hardAssert(void 0===t||"string"==typeof t,58123),ByteString.fromBase64String(t||"")):(__PRIVATE_hardAssert(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),ByteString.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,_=o&&function __PRIVATE_fromRpcStatus(e){const t=void 0===e.code?N.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(e.code);return new FirestoreError(t,e.message||"")}(o);n=new __PRIVATE_WatchTargetChange(r,i,s,_||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=fromName(e,r.document.name),s=__PRIVATE_fromVersion(r.document.updateTime),o=r.document.createTime?__PRIVATE_fromVersion(r.document.createTime):SnapshotVersion.min(),_=new ObjectValue({mapValue:{fields:r.document.fields}}),a=MutableDocument.newFoundDocument(i,s,o,_),u=r.targetIds||[],c=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange(u,c,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=fromName(e,r.document),s=r.readTime?__PRIVATE_fromVersion(r.readTime):SnapshotVersion.min(),o=MutableDocument.newNoDocument(i,s),_=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],_,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=fromName(e,r.document),s=r.removedTargetIds||[];n=new __PRIVATE_DocumentWatchChange([],s,i,null)}else{if(!("filter"in t))return fail(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new ExistenceFilter(r,i),o=e.targetId;n=new __PRIVATE_ExistenceFilterChange(o,s)}}return n}(this.serializer,e),n=function __PRIVATE_versionFromListenResponse(e){if(!("targetChange"in e))return SnapshotVersion.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?SnapshotVersion.min():t.readTime?__PRIVATE_fromVersion(t.readTime):SnapshotVersion.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.addTarget=function __PRIVATE_toTarget(e,t){let n;const r=t.target;if(n=__PRIVATE_targetIsDocumentTarget(r)?{documents:__PRIVATE_toDocumentsTarget(e,r)}:{query:__PRIVATE_toQueryTarget(e,r).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=__PRIVATE_toBytes(e,t.resumeToken);const r=__PRIVATE_toInt32Proto(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(SnapshotVersion.min())>0){n.readTime=toTimestamp(e,t.snapshotVersion.toTimestamp());const r=__PRIVATE_toInt32Proto(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function __PRIVATE_toListenRequestLabels(e,t){const n=function __PRIVATE_toLabel(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=__PRIVATE_getEncodedDatabaseId(this.serializer),t.removeTarget=e,this.q_(t)}}class __PRIVATE_PersistentWriteStream extends __PRIVATE_PersistentStream{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return __PRIVATE_hardAssert(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,__PRIVATE_hardAssert(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){__PRIVATE_hardAssert(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function __PRIVATE_fromWriteResults(e,t){return e&&e.length>0?(__PRIVATE_hardAssert(void 0!==t,14353),e.map((e=>function __PRIVATE_fromWriteResult(e,t){let n=e.updateTime?__PRIVATE_fromVersion(e.updateTime):__PRIVATE_fromVersion(t);return n.isEqual(SnapshotVersion.min())&&(n=__PRIVATE_fromVersion(t)),new MutationResult(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=__PRIVATE_fromVersion(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=__PRIVATE_getEncodedDatabaseId(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>toMutation(this.serializer,e)))};this.q_(t)}}class Datastore{}class __PRIVATE_DatastoreImpl extends Datastore{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Go(e,__PRIVATE_toResourcePath(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new FirestoreError(N.UNKNOWN,e.toString())}))}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Ho(e,__PRIVATE_toResourcePath(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new FirestoreError(N.UNKNOWN,e.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class __PRIVATE_OnlineStateTracker{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(__PRIVATE_logError(t),this.aa=!1):__PRIVATE_logDebug("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const tn="RemoteStore";class __PRIVATE_RemoteStoreImpl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((e=>{n.enqueueAndForget((async()=>{__PRIVATE_canUseNetwork(this)&&(__PRIVATE_logDebug(tn,"Restarting streams for network reachability change."),await async function __PRIVATE_restartNetwork(e){const t=__PRIVATE_debugCast(e);t.Ea.add(4),await __PRIVATE_disableNetworkInternal(t),t.Ra.set("Unknown"),t.Ea.delete(4),await __PRIVATE_enableNetworkInternal(t)}(this))}))})),this.Ra=new __PRIVATE_OnlineStateTracker(n,r)}}async function __PRIVATE_enableNetworkInternal(e){if(__PRIVATE_canUseNetwork(e))for(const t of e.da)await t(!0)}async function __PRIVATE_disableNetworkInternal(e){for(const t of e.da)await t(!1)}function __PRIVATE_remoteStoreListen(e,t){const n=__PRIVATE_debugCast(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),__PRIVATE_shouldStartWatchStream(n)?__PRIVATE_startWatchStream(n):__PRIVATE_ensureWatchStream(n).O_()&&__PRIVATE_sendWatchRequest(n,t))}function __PRIVATE_remoteStoreUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=__PRIVATE_ensureWatchStream(n);n.Ia.delete(t),r.O_()&&__PRIVATE_sendUnwatchRequest(n,t),0===n.Ia.size&&(r.O_()?r.L_():__PRIVATE_canUseNetwork(n)&&n.Ra.set("Unknown"))}function __PRIVATE_sendWatchRequest(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(SnapshotVersion.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}__PRIVATE_ensureWatchStream(e).Y_(t)}function __PRIVATE_sendUnwatchRequest(e,t){e.Va.Ue(t),__PRIVATE_ensureWatchStream(e).Z_(t)}function __PRIVATE_startWatchStream(e){e.Va=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(e).start(),e.Ra.ua()}function __PRIVATE_shouldStartWatchStream(e){return __PRIVATE_canUseNetwork(e)&&!__PRIVATE_ensureWatchStream(e).x_()&&e.Ia.size>0}function __PRIVATE_canUseNetwork(e){return 0===__PRIVATE_debugCast(e).Ea.size}function __PRIVATE_cleanUpWatchStreamState(e){e.Va=void 0}async function __PRIVATE_onWatchStreamConnected(e){e.Ra.set("Online")}async function __PRIVATE_onWatchStreamOpen(e){e.Ia.forEach(((t,n)=>{__PRIVATE_sendWatchRequest(e,t)}))}async function __PRIVATE_onWatchStreamClose(e,t){__PRIVATE_cleanUpWatchStreamState(e),__PRIVATE_shouldStartWatchStream(e)?(e.Ra.ha(t),__PRIVATE_startWatchStream(e)):e.Ra.set("Unknown")}async function __PRIVATE_onWatchStreamChange(e,t,n){if(e.Ra.set("Online"),t instanceof __PRIVATE_WatchTargetChange&&2===t.state&&t.cause)try{await async function __PRIVATE_handleTargetError(e,t){const n=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){__PRIVATE_logDebug(tn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await __PRIVATE_disableNetworkUntilRecovery(e,n)}else if(t instanceof __PRIVATE_DocumentWatchChange?e.Va.Ze(t):t instanceof __PRIVATE_ExistenceFilterChange?e.Va.st(t):e.Va.tt(t),!n.isEqual(SnapshotVersion.min()))try{const t=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore);n.compareTo(t)>=0&&await function __PRIVATE_raiseWatchSnapshot(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(ByteString.EMPTY_BYTE_STRING,r.snapshotVersion)),__PRIVATE_sendUnwatchRequest(e,t);const i=new TargetData(r.target,t,n,r.sequenceNumber);__PRIVATE_sendWatchRequest(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){__PRIVATE_logDebug(tn,"Failed to raise snapshot:",t),await __PRIVATE_disableNetworkUntilRecovery(e,t)}}async function __PRIVATE_disableNetworkUntilRecovery(e,t,n){if(!__PRIVATE_isIndexedDbTransactionError(t))throw t;e.Ea.add(1),await __PRIVATE_disableNetworkInternal(e),e.Ra.set("Offline"),n||(n=()=>__PRIVATE_localStoreGetLastRemoteSnapshotVersion(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{__PRIVATE_logDebug(tn,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await __PRIVATE_enableNetworkInternal(e)}))}function __PRIVATE_executeWithRecovery(e,t){return t().catch((n=>__PRIVATE_disableNetworkUntilRecovery(e,n,t)))}async function __PRIVATE_fillWritePipeline(e){const t=__PRIVATE_debugCast(e),n=__PRIVATE_ensureWriteStream(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:j;for(;__PRIVATE_canAddToWritePipeline(t);)try{const e=await __PRIVATE_localStoreGetNextMutationBatch(t.localStore,r);if(null===e){0===t.Ta.length&&n.L_();break}r=e.batchId,__PRIVATE_addToWritePipeline(t,e)}catch(e){await __PRIVATE_disableNetworkUntilRecovery(t,e)}__PRIVATE_shouldStartWriteStream(t)&&__PRIVATE_startWriteStream(t)}function __PRIVATE_canAddToWritePipeline(e){return __PRIVATE_canUseNetwork(e)&&e.Ta.length<10}function __PRIVATE_addToWritePipeline(e,t){e.Ta.push(t);const n=__PRIVATE_ensureWriteStream(e);n.O_()&&n.X_&&n.ea(t.mutations)}function __PRIVATE_shouldStartWriteStream(e){return __PRIVATE_canUseNetwork(e)&&!__PRIVATE_ensureWriteStream(e).x_()&&e.Ta.length>0}function __PRIVATE_startWriteStream(e){__PRIVATE_ensureWriteStream(e).start()}async function __PRIVATE_onWriteStreamOpen(e){__PRIVATE_ensureWriteStream(e).ra()}async function __PRIVATE_onWriteHandshakeComplete(e){const t=__PRIVATE_ensureWriteStream(e);for(const n of e.Ta)t.ea(n.mutations)}async function __PRIVATE_onMutationResult(e,t,n){const r=e.Ta.shift(),i=MutationBatchResult.from(r,t,n);await __PRIVATE_executeWithRecovery(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await __PRIVATE_fillWritePipeline(e)}async function __PRIVATE_onWriteStreamClose(e,t){t&&__PRIVATE_ensureWriteStream(e).X_&&await async function __PRIVATE_handleWriteError(e,t){if(function __PRIVATE_isPermanentWriteError(e){return __PRIVATE_isPermanentError(e)&&e!==N.ABORTED}(t.code)){const n=e.Ta.shift();__PRIVATE_ensureWriteStream(e).B_(),await __PRIVATE_executeWithRecovery(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await __PRIVATE_fillWritePipeline(e)}}(e,t),__PRIVATE_shouldStartWriteStream(e)&&__PRIVATE_startWriteStream(e)}async function __PRIVATE_remoteStoreHandleCredentialChange(e,t){const n=__PRIVATE_debugCast(e);n.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(tn,"RemoteStore received new credentials");const r=__PRIVATE_canUseNetwork(n);n.Ea.add(3),await __PRIVATE_disableNetworkInternal(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await __PRIVATE_enableNetworkInternal(n)}async function __PRIVATE_remoteStoreApplyPrimaryState(e,t){const n=__PRIVATE_debugCast(e);t?(n.Ea.delete(2),await __PRIVATE_enableNetworkInternal(n)):t||(n.Ea.add(2),await __PRIVATE_disableNetworkInternal(n),n.Ra.set("Unknown"))}function __PRIVATE_ensureWatchStream(e){return e.ma||(e.ma=function __PRIVATE_newPersistentWatchStream(e,t,n){const r=__PRIVATE_debugCast(e);return r.sa(),new __PRIVATE_PersistentListenStream(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:__PRIVATE_onWatchStreamConnected.bind(null,e),t_:__PRIVATE_onWatchStreamOpen.bind(null,e),r_:__PRIVATE_onWatchStreamClose.bind(null,e),H_:__PRIVATE_onWatchStreamChange.bind(null,e)}),e.da.push((async t=>{t?(e.ma.B_(),__PRIVATE_shouldStartWatchStream(e)?__PRIVATE_startWatchStream(e):e.Ra.set("Unknown")):(await e.ma.stop(),__PRIVATE_cleanUpWatchStreamState(e))}))),e.ma}function __PRIVATE_ensureWriteStream(e){return e.fa||(e.fa=function __PRIVATE_newPersistentWriteStream(e,t,n){const r=__PRIVATE_debugCast(e);return r.sa(),new __PRIVATE_PersistentWriteStream(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:__PRIVATE_onWriteStreamOpen.bind(null,e),r_:__PRIVATE_onWriteStreamClose.bind(null,e),ta:__PRIVATE_onWriteHandshakeComplete.bind(null,e),na:__PRIVATE_onMutationResult.bind(null,e)}),e.da.push((async t=>{t?(e.fa.B_(),await __PRIVATE_fillWritePipeline(e)):(await e.fa.stop(),e.Ta.length>0&&(__PRIVATE_logDebug(tn,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa}class DelayedOperation{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new DelayedOperation(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(e,t){if(__PRIVATE_logError("AsyncQueue",`${t}: ${e}`),__PRIVATE_isIndexedDbTransactionError(e))return new FirestoreError(N.UNAVAILABLE,`${t}: ${e}`);throw e}class DocumentSet{static emptySet(e){return new DocumentSet(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||DocumentKey.comparator(t.key,n.key):(e,t)=>DocumentKey.comparator(e.key,t.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof DocumentSet))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new DocumentSet;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class __PRIVATE_DocumentChangeSet{constructor(){this.ga=new SortedMap(DocumentKey.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):fail(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class ViewSnapshot{constructor(e,t,n,r,i,s,o,_,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=_,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new ViewSnapshot(e,t,DocumentSet.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&__PRIVATE_queryEquals(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class __PRIVATE_QueryListenersInfo{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function __PRIVATE_errorAllTargets(e,t){const n=__PRIVATE_debugCast(e),r=n.queries;n.queries=__PRIVATE_newQueriesObjectMap(),r.forEach(((e,n)=>{for(const e of n.Sa)e.onError(t)}))}(this,new FirestoreError(N.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap((e=>__PRIVATE_canonifyQuery(e)),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(e,t){const n=__PRIVATE_debugCast(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.ba()&&t.Da()&&(r=2):(s=new __PRIVATE_QueryListenersInfo,r=t.Da()?0:1);try{switch(r){case 0:s.wa=await n.onListen(i,!0);break;case 1:s.wa=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=__PRIVATE_wrapInUserErrorIfRecoverable(e,`Initialization of query '${__PRIVATE_stringifyQuery(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.Sa.push(t),t.va(n.onlineState),s.wa&&t.Fa(s.wa)&&__PRIVATE_raiseSnapshotsInSyncEvent(n)}async function __PRIVATE_eventManagerUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?i=t.Da()?0:1:!s.ba()&&t.Da()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function __PRIVATE_eventManagerOnWatchChange(e,t){const n=__PRIVATE_debugCast(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.Sa)t.Fa(e)&&(r=!0);i.wa=e}}r&&__PRIVATE_raiseSnapshotsInSyncEvent(n)}function __PRIVATE_eventManagerOnWatchError(e,t,n){const r=__PRIVATE_debugCast(e),i=r.queries.get(t);if(i)for(const e of i.Sa)e.onError(n);r.queries.delete(t)}function __PRIVATE_raiseSnapshotsInSyncEvent(e){e.Ca.forEach((e=>{e.next()}))}var nn,rn;(rn=nn||(nn={})).Ma="default",rn.Cache="cache";class __PRIVATE_QueryListener{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new ViewSnapshot(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=ViewSnapshot.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==nn.Cache}}class __PRIVATE_AddedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_RemovedLimboDocument{constructor(e){this.key=e}}class __PRIVATE_View{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.eu=__PRIVATE_newQueryComparator(e),this.tu=new DocumentSet(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new __PRIVATE_DocumentChangeSet,r=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const _="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,a="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),c=__PRIVATE_queryMatches(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),h=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let P=!1;u&&c?u.data.isEqual(c.data)?l!==h&&(n.track({type:3,doc:c}),P=!0):this.su(u,c)||(n.track({type:2,doc:c}),P=!0,(_&&this.eu(c,_)>0||a&&this.eu(c,a)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),P=!0):u&&!c&&(n.track({type:1,doc:u}),P=!0,(_||a)&&(o=!0)),P&&(c?(s=s.add(c),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort(((e,t)=>function __PRIVATE_compareChangeType(e,t){const order=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail(20277,{Rt:e})}};return order(e)-order(t)}(e.type,t.type)||this.eu(e.doc,t.doc))),this.ou(n),r=r??!1;const o=t&&!r?this._u():[],_=0===this.Xa.size&&this.current&&!r?1:0,a=_!==this.Za;return this.Za=_,0!==s.length||a?{snapshot:new ViewSnapshot(this.query,e.tu,i,s,e.mutatedKeys,0===_,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=__PRIVATE_documentKeySet(),this.tu.forEach((e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))}));const t=[];return e.forEach((e=>{this.Xa.has(e)||t.push(new __PRIVATE_RemovedLimboDocument(e))})),this.Xa.forEach((n=>{e.has(n)||t.push(new __PRIVATE_AddedLimboDocument(n))})),t}cu(e){this.Ya=e.Qs,this.Xa=__PRIVATE_documentKeySet();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return ViewSnapshot.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const sn="SyncEngine";class __PRIVATE_QueryView{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class LimboResolution{constructor(e){this.key=e,this.hu=!1}}class __PRIVATE_SyncEngineImpl{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new ObjectMap((e=>__PRIVATE_canonifyQuery(e)),__PRIVATE_queryEquals),this.Iu=new Map,this.Eu=new Set,this.du=new SortedMap(DocumentKey.comparator),this.Au=new Map,this.Ru=new __PRIVATE_ReferenceSet,this.Vu={},this.mu=new Map,this.fu=__PRIVATE_TargetIdGenerator.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function __PRIVATE_syncEngineListen(e,t,n=!0){const r=__PRIVATE_ensureWatchCallbacks(e);let i;const s=r.Tu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await __PRIVATE_allocateTargetAndMaybeListen(r,t,n,!0),i}async function __PRIVATE_triggerRemoteStoreListen(e,t){const n=__PRIVATE_ensureWatchCallbacks(e);await __PRIVATE_allocateTargetAndMaybeListen(n,t,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(e,t,n,r){const i=await __PRIVATE_localStoreAllocateTarget(e.localStore,__PRIVATE_queryToTarget(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let _;return r&&(_=await __PRIVATE_initializeViewAndComputeSnapshot(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&__PRIVATE_remoteStoreListen(e.remoteStore,i),_}async function __PRIVATE_initializeViewAndComputeSnapshot(e,t,n,r,i){e.pu=(t,n,r)=>async function __PRIVATE_applyDocChanges(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await __PRIVATE_localStoreExecuteQuery(e.localStore,t.query,!1).then((({documents:e})=>t.view.ru(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),_=t.view.applyChanges(i,e.isPrimaryClient,s,o);return __PRIVATE_updateTrackedLimbos(e,t.targetId,_.au),_.snapshot}(e,t,n,r);const s=await __PRIVATE_localStoreExecuteQuery(e.localStore,t,!0),o=new __PRIVATE_View(t,s.Qs),_=o.ru(s.documents),a=TargetChange.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(_,e.isPrimaryClient,a);__PRIVATE_updateTrackedLimbos(e,n,u.au);const c=new __PRIVATE_QueryView(t,n,o);return e.Tu.set(t,c),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),u.snapshot}async function __PRIVATE_syncEngineUnlisten(e,t,n){const r=__PRIVATE_debugCast(e),i=r.Tu.get(t),s=r.Iu.get(i.targetId);if(s.length>1)return r.Iu.set(i.targetId,s.filter((e=>!__PRIVATE_queryEquals(e,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await __PRIVATE_localStoreReleaseTarget(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&__PRIVATE_remoteStoreUnlisten(r.remoteStore,i.targetId),__PRIVATE_removeAndCleanupTarget(r,i.targetId)})).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(r,i.targetId),await __PRIVATE_localStoreReleaseTarget(r.localStore,i.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(e,t){const n=__PRIVATE_debugCast(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),__PRIVATE_remoteStoreUnlisten(n.remoteStore,r.targetId))}async function __PRIVATE_syncEngineApplyRemoteEvent(e,t){const n=__PRIVATE_debugCast(e);try{const e=await function __PRIVATE_localStoreApplyRemoteEventToLocalCache(e,t){const n=__PRIVATE_debugCast(e),r=t.snapshotVersion;let i=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;const o=[];t.targetChanges.forEach(((s,_)=>{const a=i.get(_);if(!a)return;o.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,_).next((()=>n.Pi.addMatchingKeys(e,s.addedDocuments,_))));let u=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(_)?u=u.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(_,u),function __PRIVATE_shouldPersistTargetData(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Kt||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(a,u,s)&&o.push(n.Pi.updateTargetData(e,u))}));let _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(__PRIVATE_populateDocumentChangeBuffer(e,s,t.documentUpdates).next((e=>{_=e.ks,a=e.qs}))),!r.isEqual(SnapshotVersion.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next((t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return PersistencePromise.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,_,a))).next((()=>_))})).then((e=>(n.Ms=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Au.get(t);r&&(__PRIVATE_hardAssert(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?__PRIVATE_hardAssert(r.hu,14607):e.removedDocuments.size>0&&(__PRIVATE_hardAssert(r.hu,42227),r.hu=!1))})),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e,t)}catch(e){await __PRIVATE_ignoreIfPrimaryLeaseLoss(e)}}function __PRIVATE_syncEngineApplyOnlineStateChange(e,t,n){const r=__PRIVATE_debugCast(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Tu.forEach(((n,r)=>{const i=r.view.va(t);i.snapshot&&e.push(i.snapshot)})),function __PRIVATE_eventManagerOnOnlineStateChange(e,t){const n=__PRIVATE_debugCast(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Sa)e.va(t)&&(r=!0)})),r&&__PRIVATE_raiseSnapshotsInSyncEvent(n)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function __PRIVATE_syncEngineRejectListen(e,t,n){const r=__PRIVATE_debugCast(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Au.get(t),s=i&&i.key;if(s){let e=new SortedMap(DocumentKey.comparator);e=e.insert(s,MutableDocument.newNoDocument(s,SnapshotVersion.min()));const n=__PRIVATE_documentKeySet().add(s),i=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),e,n);await __PRIVATE_syncEngineApplyRemoteEvent(r,i),r.du=r.du.remove(s),r.Au.delete(t),__PRIVATE_pumpEnqueuedLimboResolutions(r)}else await __PRIVATE_localStoreReleaseTarget(r.localStore,t,!1).then((()=>__PRIVATE_removeAndCleanupTarget(r,t,n))).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}async function __PRIVATE_syncEngineApplySuccessfulWrite(e,t){const n=__PRIVATE_debugCast(e),r=t.batch.batchId;try{const e=await function __PRIVATE_localStoreAcknowledgeBatch(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function __PRIVATE_applyWriteToRemoteDocuments(e,t,n,r){const i=n.batch,s=i.keys();let o=PersistencePromise.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);__PRIVATE_hardAssert(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function __PRIVATE_getKeysWithTransformResults(e){let t=__PRIVATE_documentKeySet();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);__PRIVATE_processUserCallback(n,r,null),__PRIVATE_triggerPendingWritesCallbacks(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e)}catch(e){await __PRIVATE_ignoreIfPrimaryLeaseLoss(e)}}async function __PRIVATE_syncEngineRejectFailedWrite(e,t,n){const r=__PRIVATE_debugCast(e);try{const e=await function __PRIVATE_localStoreRejectBatch(e,t){const n=__PRIVATE_debugCast(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(__PRIVATE_hardAssert(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);__PRIVATE_processUserCallback(r,t,n),__PRIVATE_triggerPendingWritesCallbacks(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(r,e)}catch(n){await __PRIVATE_ignoreIfPrimaryLeaseLoss(n)}}function __PRIVATE_triggerPendingWritesCallbacks(e,t){(e.mu.get(t)||[]).forEach((e=>{e.resolve()})),e.mu.delete(t)}function __PRIVATE_processUserCallback(e,t,n){const r=__PRIVATE_debugCast(e);let i=r.Vu[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Vu[r.currentUser.toKey()]=i}}function __PRIVATE_removeAndCleanupTarget(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach((t=>{e.Ru.containsKey(t)||__PRIVATE_removeLimboTarget(e,t)}))}function __PRIVATE_removeLimboTarget(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(__PRIVATE_remoteStoreUnlisten(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_updateTrackedLimbos(e,t,n){for(const r of n)r instanceof __PRIVATE_AddedLimboDocument?(e.Ru.addReference(r.key,t),__PRIVATE_trackLimboChange(e,r)):r instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug(sn,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||__PRIVATE_removeLimboTarget(e,r.key)):fail(19791,{wu:r})}function __PRIVATE_trackLimboChange(e,t){const n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(__PRIVATE_logDebug(sn,"New document in limbo: "+n),e.Eu.add(r),__PRIVATE_pumpEnqueuedLimboResolutions(e))}function __PRIVATE_pumpEnqueuedLimboResolutions(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new DocumentKey(ResourcePath.fromString(t)),r=e.fu.next();e.Au.set(r,new LimboResolution(n)),e.du=e.du.insert(n,r),__PRIVATE_remoteStoreListen(e.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(n.path)),r,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.ce))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(e,t,n){const r=__PRIVATE_debugCast(e),i=[],s=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((e,_)=>{o.push(r.pu(_,t,n).then((e=>{if((e||n)&&r.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(_.targetId)?.current;r.sharedClientState.updateQueryState(_.targetId,t?"current":"not-current")}if(e){i.push(e);const t=__PRIVATE_LocalViewChanges.As(_.targetId,e);s.push(t)}})))})),await Promise.all(o),r.Pu.H_(i),await async function __PRIVATE_localStoreNotifyLocalViewChanges(e,t){const n=__PRIVATE_debugCast(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>PersistencePromise.forEach(t,(t=>PersistencePromise.forEach(t.Es,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>PersistencePromise.forEach(t.ds,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug(Ut,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,i)}}}(r.localStore,s))}async function __PRIVATE_syncEngineHandleCredentialChange(e,t){const n=__PRIVATE_debugCast(e);if(!n.currentUser.isEqual(t)){__PRIVATE_logDebug(sn,"User change. New user:",t.toKey());const e=await __PRIVATE_localStoreHandleUserChange(n.localStore,t);n.currentUser=t,function __PRIVATE_rejectOutstandingPendingWritesCallbacks(e,t){e.mu.forEach((e=>{e.forEach((e=>{e.reject(new FirestoreError(N.CANCELLED,t))}))})),e.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(n,e.Ls)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(e,t){const n=__PRIVATE_debugCast(e),r=n.Au.get(t);if(r&&r.hu)return __PRIVATE_documentKeySet().add(r.key);{let e=__PRIVATE_documentKeySet();const r=n.Iu.get(t);if(!r)return e;for(const t of r){const r=n.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function __PRIVATE_ensureWatchCallbacks(e){const t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,t),t.Pu.H_=__PRIVATE_eventManagerOnWatchChange.bind(null,t.eventManager),t.Pu.yu=__PRIVATE_eventManagerOnWatchError.bind(null,t.eventManager),t}function __PRIVATE_syncEngineEnsureWriteCallbacks(e){const t=__PRIVATE_debugCast(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=__PRIVATE_syncEngineApplySuccessfulWrite.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=__PRIVATE_syncEngineRejectFailedWrite.bind(null,t),t}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=__PRIVATE_newSerializer(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,e.initialUser,this.serializer)}Cu(e){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.mi,this.serializer)}Du(e){return new __PRIVATE_MemorySharedClientState}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=>new __PRIVATE_MemoryOfflineComponentProvider};class __PRIVATE_LruGcMemoryOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){__PRIVATE_hardAssert(this.persistence.referenceDelegate instanceof __PRIVATE_MemoryLruDelegate,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence((e=>__PRIVATE_MemoryLruDelegate.mi(e,t)),this.serializer)}}class OnlineComponentProvider{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function __PRIVATE_newEventManager(){return new __PRIVATE_EventManagerImpl}()}createDatastore(e){const t=__PRIVATE_newSerializer(e.databaseInfo.databaseId),n=function __PRIVATE_newConnection(e){return new __PRIVATE_WebChannelConnection(e)}(e.databaseInfo);return function __PRIVATE_newDatastore(e,t,n,r){return new __PRIVATE_DatastoreImpl(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function __PRIVATE_newRemoteStore(e,t,n,r,i){return new __PRIVATE_RemoteStoreImpl(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,e,0)),function __PRIVATE_newConnectivityMonitor(){return __PRIVATE_BrowserConnectivityMonitor.v()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}createSyncEngine(e,t){return function __PRIVATE_newSyncEngine(e,t,n,r,i,s,o){const _=new __PRIVATE_SyncEngineImpl(e,t,n,r,i,s);return o&&(_.gu=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function __PRIVATE_remoteStoreShutdown(e){const t=__PRIVATE_debugCast(e);__PRIVATE_logDebug(tn,"RemoteStore shutting down."),t.Ea.add(5),await __PRIVATE_disableNetworkInternal(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}OnlineComponentProvider.provider={build:()=>new OnlineComponentProvider};class __PRIVATE_AsyncObserver{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):__PRIVATE_logError("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const on="FirestoreClient";class FirestoreClient{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{__PRIVATE_logDebug(on,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(__PRIVATE_logDebug(on,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=__PRIVATE_wrapInUserErrorIfRecoverable(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function __PRIVATE_setOfflineComponentProvider(e,t){e.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(on,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await __PRIVATE_localStoreHandleUserChange(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function __PRIVATE_setOnlineComponentProvider(e,t){e.asyncQueue.verifyOperationInProgress();const n=await __PRIVATE_ensureOfflineComponents(e);__PRIVATE_logDebug(on,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>__PRIVATE_remoteStoreHandleCredentialChange(t.remoteStore,n))),e._onlineComponents=t}async function __PRIVATE_ensureOfflineComponents(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){__PRIVATE_logDebug(on,"Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function __PRIVATE_canFallbackFromIndexedDbError(e){return"FirebaseError"===e.name?e.code===N.FAILED_PRECONDITION||e.code===N.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+n),await __PRIVATE_setOfflineComponentProvider(e,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug(on,"Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(e,new __PRIVATE_LruGcMemoryOfflineComponentProvider(void 0));return e._offlineComponents}async function __PRIVATE_ensureOnlineComponents(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(__PRIVATE_logDebug(on,"Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(e,e._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug(on,"Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(e,new OnlineComponentProvider))),e._onlineComponents}function __PRIVATE_getSyncEngine(e){return __PRIVATE_ensureOnlineComponents(e).then((e=>e.syncEngine))}async function __PRIVATE_getEventManager(e){const t=await __PRIVATE_ensureOnlineComponents(e),n=t.eventManager;return n.onListen=__PRIVATE_syncEngineListen.bind(null,t.syncEngine),n.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,t.syncEngine),n}function __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(e,t,n={}){const r=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget((async()=>function __PRIVATE_readDocumentViaSnapshotListener(e,t,n,r,i){const s=new __PRIVATE_AsyncObserver({next:_=>{s.Nu(),t.enqueueAndForget((()=>__PRIVATE_eventManagerUnlisten(e,o)));const a=_.docs.has(n);!a&&_.fromCache?i.reject(new FirestoreError(N.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&_.fromCache&&r&&"server"===r.source?i.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(_)},error:e=>i.reject(e)}),o=new __PRIVATE_QueryListener(__PRIVATE_newQueryForPath(n.path),s,{includeMetadataChanges:!0,qa:!0});return __PRIVATE_eventManagerListen(e,o)}(await __PRIVATE_getEventManager(e),e.asyncQueue,t,n,r))),r.promise}function __PRIVATE_cloneLongPollingOptions(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const _n=new Map,an="firestore.googleapis.com";class FirestoreSettingsImpl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new FirestoreError(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=an,this.ssl=true}else this.host=e.host,this.ssl=e.ssl??true;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new FirestoreError(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function __PRIVATE_validateIsNotUsedTogether(e,t,n,r){if(!0===t&&!0===r)throw new FirestoreError(N.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(e.experimentalLongPollingOptions??{}),function __PRIVATE_validateLongPollingOptions(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function __PRIVATE_longPollingOptionsEqual(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Firestore$1{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function __PRIVATE_makeAuthCredentialsProvider(e){if(!e)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(e.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new FirestoreError(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function __PRIVATE_removeComponents(e){const t=_n.get(e);t&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),_n.delete(e),t.terminate())}(this),Promise.resolve()}}class Query{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Query(this.firestore,e,this._query)}}class DocumentReference{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new DocumentReference(this.firestore,e,this._key)}toJSON(){return{type:DocumentReference._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(__PRIVATE_validateJSON(t,DocumentReference._jsonSchema))return new DocumentReference(e,n||null,new DocumentKey(ResourcePath.fromString(t.referencePath)))}}DocumentReference._jsonSchemaVersion="firestore/documentReference/1.0",DocumentReference._jsonSchema={type:property("string",DocumentReference._jsonSchemaVersion),referencePath:property("string")};class CollectionReference extends Query{constructor(e,t,n){super(e,t,__PRIVATE_newQueryForPath(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}function doc(e,t,...n){if(e=(0,dist_index_esm.Ku)(e),1===arguments.length&&(t=__PRIVATE_AutoId.newId()),__PRIVATE_validateNonEmptyArgument("doc","path",t),e instanceof Firestore$1){const r=ResourcePath.fromString(t,...n);return __PRIVATE_validateDocumentPath(r),new DocumentReference(e,null,new DocumentKey(r))}{if(!(e instanceof DocumentReference||e instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ResourcePath.fromString(t,...n));return __PRIVATE_validateDocumentPath(r),new DocumentReference(e.firestore,e instanceof CollectionReference?e.converter:null,new DocumentKey(r))}}const cn="AsyncQueue";class __PRIVATE_AsyncQueueImpl{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this._c=()=>{const e=getDocument();e&&__PRIVATE_logDebug(cn,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=getDocument();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=getDocument();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new __PRIVATE_Deferred;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!__PRIVATE_isIndexedDbTransactionError(e))throw e;__PRIVATE_logDebug(cn,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((e=>{throw this.nc=e,this.rc=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",__PRIVATE_getMessageOrStack(e)),e})).then((e=>(this.rc=!1,e))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=DelayedOperation.createAndSchedule(this,e,t,n,(e=>this.hc(e)));return this.tc.push(r),r}uc(){this.nc&&fail(47125,{Pc:__PRIVATE_getMessageOrStack(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function __PRIVATE_getMessageOrStack(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class Firestore extends Firestore$1{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(e),this._firestoreClient=void 0,await e}}}function getFirestore(e,n){const r="object"==typeof e?e:(0,index_esm.Sx)(),i="string"==typeof e?e:n||lt,s=(0,index_esm.j6)(r,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=(0,dist_index_esm.yU)("firestore");e&&function connectFirestoreEmulator(e,t,n,r={}){e=__PRIVATE_cast(e,Firestore$1);const i=(0,dist_index_esm.zJ)(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},_=`${t}:${n}`;i&&((0,dist_index_esm.gE)(`https://${_}`),(0,dist_index_esm.P1)("Firestore",!0)),s.host!==an&&s.host!==_&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const a={...s,host:_,ssl:i,emulatorOptions:r};if(!(0,dist_index_esm.bD)(a,o)&&(e._setSettings(a),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=User.MOCK_USER;else{t=(0,dist_index_esm.Fy)(r.mockUserToken,e._app?.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new FirestoreError(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new User(i)}e._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(t,n))}}(s,...e)}return s}function ensureFirestoreConfigured(e){if(e._terminated)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||__PRIVATE_configureFirestore(e),e._firestoreClient}function __PRIVATE_configureFirestore(e){const t=e._freezeSettings(),n=function __PRIVATE_makeDatabaseInfo(e,t,n,r){return new DatabaseInfo(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new FirestoreClient(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function __PRIVATE_buildComponentProvider(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}class Bytes{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(e){throw new FirestoreError(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Bytes._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(__PRIVATE_validateJSON(e,Bytes._jsonSchema))return Bytes.fromBase64String(e.bytes)}}Bytes._jsonSchemaVersion="firestore/bytes/1.0",Bytes._jsonSchema={type:property("string",Bytes._jsonSchemaVersion),bytes:property("string")};class FieldPath{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class FieldValue{constructor(e){this._methodName=e}}class GeoPoint{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new FirestoreError(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new FirestoreError(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:GeoPoint._jsonSchemaVersion}}static fromJSON(e){if(__PRIVATE_validateJSON(e,GeoPoint._jsonSchema))return new GeoPoint(e.latitude,e.longitude)}}GeoPoint._jsonSchemaVersion="firestore/geoPoint/1.0",GeoPoint._jsonSchema={type:property("string",GeoPoint._jsonSchemaVersion),latitude:property("number"),longitude:property("number")};class VectorValue{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function __PRIVATE_isPrimitiveArrayEqual(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:VectorValue._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(__PRIVATE_validateJSON(e,VectorValue._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((e=>"number"==typeof e)))return new VectorValue(e.vectorValues);throw new FirestoreError(N.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}VectorValue._jsonSchemaVersion="firestore/vectorValue/1.0",VectorValue._jsonSchema={type:property("string",VectorValue._jsonSchemaVersion),vectorValues:property("object")};const hn=/^__.*__$/;class ParsedUpdateData{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function __PRIVATE_isWrite(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail(40011,{Ac:e})}}class __PRIVATE_ParseContextImpl{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new __PRIVATE_ParseContextImpl({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(__PRIVATE_isWrite(this.Ac)&&hn.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||__PRIVATE_newSerializer(e)}Cc(e,t,n,r=!1){return new __PRIVATE_ParseContextImpl({Ac:e,methodName:t,Dc:n,path:FieldPath$1.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(e){const t=e._freezeSettings(),n=__PRIVATE_newSerializer(e._databaseId);return new __PRIVATE_UserDataReader(e._databaseId,!!t.ignoreUndefinedProperties,n)}class __PRIVATE_DeleteFieldValueImpl extends FieldValue{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof __PRIVATE_DeleteFieldValueImpl}}function __PRIVATE_parseUpdateData(e,t,n,r){const i=e.Cc(1,t,n);__PRIVATE_validatePlainObject("Data must be an object, but it was:",i,r);const s=[],o=ObjectValue.empty();forEach(r,((e,r)=>{const _=__PRIVATE_fieldPathFromDotSeparatedString(t,e,n);r=(0,dist_index_esm.Ku)(r);const a=i.yc(_);if(r instanceof __PRIVATE_DeleteFieldValueImpl)s.push(_);else{const e=__PRIVATE_parseData(r,a);null!=e&&(s.push(_),o.set(_,e))}}));const _=new FieldMask(s);return new ParsedUpdateData(o,_,i.fieldTransforms)}function __PRIVATE_parseUpdateVarargs(e,t,n,r,i,s){const o=e.Cc(1,t,n),_=[__PRIVATE_fieldPathFromArgument$1(t,r,n)],a=[i];if(s.length%2!=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)_.push(__PRIVATE_fieldPathFromArgument$1(t,s[e])),a.push(s[e+1]);const u=[],c=ObjectValue.empty();for(let e=_.length-1;e>=0;--e)if(!__PRIVATE_fieldMaskContains(u,_[e])){const t=_[e];let n=a[e];n=(0,dist_index_esm.Ku)(n);const r=o.yc(t);if(n instanceof __PRIVATE_DeleteFieldValueImpl)u.push(t);else{const e=__PRIVATE_parseData(n,r);null!=e&&(u.push(t),c.set(t,e))}}const l=new FieldMask(u);return new ParsedUpdateData(c,l,o.fieldTransforms)}function __PRIVATE_parseData(e,t){if(__PRIVATE_looksLikeJsonObject(e=(0,dist_index_esm.Ku)(e)))return __PRIVATE_validatePlainObject("Unsupported field value:",t,e),__PRIVATE_parseObject(e,t);if(e instanceof FieldValue)return function __PRIVATE_parseSentinelFieldValue(e,t){if(!__PRIVATE_isWrite(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function __PRIVATE_parseArray(e,t){const n=[];let r=0;for(const i of e){let e=__PRIVATE_parseData(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function __PRIVATE_parseScalarValue(e,t){if(null===(e=(0,dist_index_esm.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return toNumber(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Timestamp.fromDate(e);return{timestampValue:toTimestamp(t.serializer,n)}}if(e instanceof Timestamp){const n=new Timestamp(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:toTimestamp(t.serializer,n)}}if(e instanceof GeoPoint)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(t.serializer,e._byteString)};if(e instanceof DocumentReference){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:__PRIVATE_toResourceName(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof VectorValue)return function __PRIVATE_parseVectorValue(e,t){return{mapValue:{fields:{[ht]:{stringValue:It},[Et]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(t.serializer,e)}))}}}}}}(e,t);throw t.Sc(`Unsupported field value: ${__PRIVATE_valueDescription(e)}`)}(e,t)}function __PRIVATE_parseObject(e,t){const n={};return isEmpty(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):forEach(e,((e,r)=>{const i=__PRIVATE_parseData(r,t.mc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function __PRIVATE_looksLikeJsonObject(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Timestamp||e instanceof GeoPoint||e instanceof Bytes||e instanceof DocumentReference||e instanceof FieldValue||e instanceof VectorValue)}function __PRIVATE_validatePlainObject(e,t,n){if(!__PRIVATE_looksLikeJsonObject(n)||!__PRIVATE_isPlainObject(n)){const r=__PRIVATE_valueDescription(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function __PRIVATE_fieldPathFromArgument$1(e,t,n){if((t=(0,dist_index_esm.Ku)(t))instanceof FieldPath)return t._internalPath;if("string"==typeof t)return __PRIVATE_fieldPathFromDotSeparatedString(e,t);throw __PRIVATE_createError("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pn=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(e,t,n){if(t.search(Pn)>=0)throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new FieldPath(...t.split("."))._internalPath}catch(r){throw __PRIVATE_createError(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function __PRIVATE_createError(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let _=`Function ${t}() called with invalid data`;n&&(_+=" (via `toFirestore()`)"),_+=". ";let a="";return(s||o)&&(a+=" (found",s&&(a+=` in field ${r}`),o&&(a+=` in document ${i}`),a+=")"),new FirestoreError(N.INVALID_ARGUMENT,_+e+a)}function __PRIVATE_fieldMaskContains(e,t){return e.some((e=>e.isEqual(t)))}class DocumentSnapshot$1{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}function __PRIVATE_fieldPathFromArgument(e,t){return"string"==typeof t?__PRIVATE_fieldPathFromDotSeparatedString(e,t):t instanceof FieldPath?t._internalPath:t._delegate._internalPath}class AbstractUserDataWriter{convertValue(e,t="none"){switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw fail(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return forEach(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){const t=e.fields?.[Et].arrayValue?.values?.map((e=>__PRIVATE_normalizeNumber(e.doubleValue)));return new VectorValue(t)}convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=__PRIVATE_getPreviousValue(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}convertTimestamp(e){const t=__PRIVATE_normalizeTimestamp(e);return new Timestamp(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ResourcePath.fromString(e);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(n),9688,{name:e});const r=new DatabaseId(n.get(1),n.get(3)),i=new DocumentKey(n.popFirst(5));return r.isEqual(t)||__PRIVATE_logError(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class SnapshotMetadata{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=DocumentSnapshot._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}DocumentSnapshot._jsonSchemaVersion="firestore/documentSnapshot/1.0",DocumentSnapshot._jsonSchema={type:property("string",DocumentSnapshot._jsonSchemaVersion),bundleSource:property("string","DocumentSnapshot"),bundleName:property("string"),bundle:property("string")};class QueryDocumentSnapshot extends DocumentSnapshot{data(e={}){return super.data(e)}}class QuerySnapshot{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SnapshotMetadata(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,n.key,n,new SnapshotMetadata(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function __PRIVATE_changesFromSnapshot(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new QueryDocumentSnapshot(e._firestore,e._userDataWriter,n.doc.key,n.doc,new SnapshotMetadata(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new QueryDocumentSnapshot(e._firestore,e._userDataWriter,t.doc.key,t.doc,new SnapshotMetadata(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:__PRIVATE_resultChangeType(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new FirestoreError(N.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=QuerySnapshot._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=__PRIVATE_AutoId.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach((e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function __PRIVATE_resultChangeType(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail(61501,{type:e})}}function getDoc(e){e=__PRIVATE_cast(e,DocumentReference);const t=__PRIVATE_cast(e.firestore,Firestore);return __PRIVATE_firestoreClientGetDocumentViaSnapshotListener(ensureFirestoreConfigured(t),e._key).then((n=>__PRIVATE_convertToDocSnapshot(t,e,n)))}QuerySnapshot._jsonSchemaVersion="firestore/querySnapshot/1.0",QuerySnapshot._jsonSchema={type:property("string",QuerySnapshot._jsonSchemaVersion),bundleSource:property("string","QuerySnapshot"),bundleName:property("string"),bundle:property("string")};class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bytes(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,t)}}function updateDoc(e,t,n,...r){e=__PRIVATE_cast(e,DocumentReference);const i=__PRIVATE_cast(e.firestore,Firestore),s=__PRIVATE_newUserDataReader(i);let o;return o="string"==typeof(t=(0,dist_index_esm.Ku)(t))||t instanceof FieldPath?__PRIVATE_parseUpdateVarargs(s,"updateDoc",e._key,t,n,r):__PRIVATE_parseUpdateData(s,"updateDoc",e._key,t),executeWrite(i,[o.toMutation(e._key,Precondition.exists(!0))])}function executeWrite(e,t){return function __PRIVATE_firestoreClientWrite(e,t){const n=new __PRIVATE_Deferred;return e.asyncQueue.enqueueAndForget((async()=>async function __PRIVATE_syncEngineWrite(e,t,n){const r=__PRIVATE_syncEngineEnsureWriteCallbacks(e);try{const e=await function __PRIVATE_localStoreWriteLocally(e,t){const n=__PRIVATE_debugCast(e),r=Timestamp.now(),i=t.reduce(((e,t)=>e.add(t.key)),__PRIVATE_documentKeySet());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let _=__PRIVATE_mutableDocumentMap(),a=__PRIVATE_documentKeySet();return n.Ns.getEntries(e,i).next((e=>{_=e,_.forEach(((e,t)=>{t.isValidDocument()||(a=a.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,_))).next((i=>{s=i;const o=[];for(const e of t){const t=__PRIVATE_mutationExtractBaseValue(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new __PRIVATE_PatchMutation(e.key,t,__PRIVATE_extractFieldMask(t.value.mapValue),Precondition.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,a);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function __PRIVATE_addMutationCallback(e,t,n){let r=e.Vu[e.currentUser.toKey()];r||(r=new SortedMap(__PRIVATE_primitiveComparator)),r=r.insert(t,n),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,n),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(r,e.changes),await __PRIVATE_fillWritePipeline(r.remoteStore)}catch(e){const t=__PRIVATE_wrapInUserErrorIfRecoverable(e,"Failed to persist write");n.reject(t)}}(await __PRIVATE_getSyncEngine(e),t,n))),n.promise}(ensureFirestoreConfigured(e),t)}function __PRIVATE_convertToDocSnapshot(e,t,n){const r=n.docs.get(t._key),i=new __PRIVATE_ExpUserDataWriter(e);return new DocumentSnapshot(e,i,t._key,r,new SnapshotMetadata(n.hasPendingWrites,n.fromCache),t.converter)}new WeakMap;!function __PRIVATE_registerFirestore(e,t=!0){!function __PRIVATE_setSDKVersion(e){x=e}(index_esm.MF),(0,index_esm.om)(new esm_index_esm.uA("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(e.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(i,e.getProvider("app-check-internal")),function __PRIVATE_databaseIdFromApp(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new FirestoreError(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:t,...r},s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,index_esm.KO)(F,M,e),(0,index_esm.KO)(F,M,"esm2020")}()},"./node_modules/react/cjs/react-jsx-runtime.production.js":(__unused_webpack_module,exports)=>{var REACT_ELEMENT_TYPE=Symbol.for("react.transitional.element"),REACT_FRAGMENT_TYPE=Symbol.for("react.fragment");function jsxProd(type,config,maybeKey){var key=null;if(void 0!==maybeKey&&(key=""+maybeKey),void 0!==config.key&&(key=""+config.key),"key"in config)for(var propName in maybeKey={},config)"key"!==propName&&(maybeKey[propName]=config[propName]);else maybeKey=config;return config=maybeKey.ref,{$$typeof:REACT_ELEMENT_TYPE,type,key,ref:void 0!==config?config:null,props:maybeKey}}exports.Fragment=REACT_FRAGMENT_TYPE,exports.jsx=jsxProd,exports.jsxs=jsxProd},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.js")}}]);