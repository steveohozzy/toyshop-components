"use strict";(self.webpackChunkentertainer_redesign=self.webpackChunkentertainer_redesign||[]).push([[205],{"./src/config/firebase.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{db:()=>db});var firebase_app__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/firebase/app/dist/esm/index.esm.js"),firebase_firestore__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/firebase/firestore/dist/esm/index.esm.js");const app=(0,firebase_app__WEBPACK_IMPORTED_MODULE_0__.Wp)({apiKey:"AIzaSyDLmVO4qOiYb8dTm9tIUSUyZZXliuddo1c",authDomain:"storybook-58efc.firebaseapp.com",projectId:"storybook-58efc",storageBucket:"storybook-58efc.firebasestorage.app",messagingSenderId:"10714570266",appId:"1:10714570266:web:1086b72b26588d72193ba3"}),db=(0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.aU)(app)},"./src/stories/Discountcode.stories.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{DiscountCodeModule:()=>DiscountCodeModule,__namedExportsOrder:()=>__namedExportsOrder,default:()=>Discountcode_stories});var objectWithoutProperties=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),firebase=__webpack_require__("./src/config/firebase.js"),index_esm=__webpack_require__("./node_modules/firebase/firestore/dist/esm/index.esm.js"),react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const DiscountCode=_ref=>{let{title,blurb,link,linktext,terms,termslink,expanding}=_ref;return setTimeout((function(){document.querySelectorAll(".terms-button").forEach((function(button){button.addEventListener("click",(function(e){e.target.classList.toggle("active"),e.target.closest(".code-box").querySelector(".terms").classList.toggle("active")}))}))}),1e3),(0,jsx_runtime.jsx)("div",{class:"container discount-code-container",children:(0,jsx_runtime.jsxs)("div",{class:"code-box ".concat(!expanding&&"non-expanding"),children:[(0,jsx_runtime.jsx)("h3",{children:title}),(0,jsx_runtime.jsx)("div",{dangerouslySetInnerHTML:{__html:blurb}}),(0,jsx_runtime.jsxs)("div",{class:"buttons",children:[expanding?(0,jsx_runtime.jsxs)("button",{class:"terms-button expander",children:["Read Terms & Conditions",(0,jsx_runtime.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",children:(0,jsx_runtime.jsx)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.29289 8.29289C4.68342 7.90237 5.31658 7.90237 5.70711 8.29289L12 14.5858L18.2929 8.29289C18.6834 7.90237 19.3166 7.90237 19.7071 8.29289C20.0976 8.68342 20.0976 9.31658 19.7071 9.70711L12.7071 16.7071C12.3166 17.0976 11.6834 17.0976 11.2929 16.7071L4.29289 9.70711C3.90237 9.31658 3.90237 8.68342 4.29289 8.29289Z",fill:"#0D5D9C"})})]}):(0,jsx_runtime.jsxs)("a",{class:"terms-button",href:termslink,children:["Read Terms & Conditions",(0,jsx_runtime.jsx)("svg",{fill:"none",height:"15px",viewbox:"0 0 24 24",width:"15px",xmlns:"http://www.w3.org/2000/svg",children:(0,jsx_runtime.jsx)("path",{"clip-rule":"evenodd",d:"M4.29289 8.29289C4.68342 7.90237 5.31658 7.90237 5.70711 8.29289L12 14.5858L18.2929 8.29289C18.6834 7.90237 19.3166 7.90237 19.7071 8.29289C20.0976 8.68342 20.0976 9.31658 19.7071 9.70711L12.7071 16.7071C12.3166 17.0976 11.6834 17.0976 11.2929 16.7071L4.29289 9.70711C3.90237 9.31658 3.90237 8.68342 4.29289 8.29289Z",fill:"#0D5D9C","fill-rule":"evenodd"})})]}),(0,jsx_runtime.jsx)("a",{class:"link",href:link,children:linktext})]}),(0,jsx_runtime.jsx)("div",{class:"terms",children:(0,jsx_runtime.jsx)("div",{class:"terms-inner",dangerouslySetInnerHTML:{__html:terms}})})]})})};DiscountCode.__docgenInfo={description:"Primary UI component for user interaction",methods:[],displayName:"DiscountCode",props:{expanding:{description:"Discount Code Module contents",type:{name:"bool"},required:!1},title:{description:"",type:{name:"string"},required:!0},blurb:{description:"",type:{name:"string"},required:!0},link:{description:"",type:{name:"string"},required:!0},linktext:{description:"",type:{name:"string"},required:!0},terms:{description:"",type:{name:"string"},required:!1},termslink:{description:"",type:{name:"string"},required:!1}}};var external_STORYBOOK_MODULE_PREVIEW_API_=__webpack_require__("storybook/preview-api");const _excluded=["user"],Discountcode_stories={title:"Components/Discount Code",component:DiscountCode,parameters:{layout:"centered"},argTypes:{user:{options:["stories","hasina","shermin","sam"],control:{type:"select"}}}},DiscountCodeModule={args:{user:"stories",expanding:!0,title:"",blurb:"",link:"",linktext:"",termslink:"",terms:""},render:function Render(args){const[currentArgs,updateArgs]=(0,external_STORYBOOK_MODULE_PREVIEW_API_.useArgs)(),isLoadingRef=(0,react.useRef)(!1),lastUserRef=(0,react.useRef)(args.user),lastSyncedData=(0,react.useRef)({});return(0,react.useEffect)((()=>{(async()=>{isLoadingRef.current=!0,lastUserRef.current=args.user;try{const docRef=(0,index_esm.H9)(firebase.db,args.user,"discountcode"),snap=await(0,index_esm.x7)(docRef);if(snap.exists()){const firestoreData=snap.data();lastSyncedData.current=firestoreData,updateArgs((0,objectSpread2.A)((0,objectSpread2.A)((0,objectSpread2.A)({},currentArgs),firestoreData),{},{user:args.user}))}}catch(e){console.error("Firestore load error:",e)}isLoadingRef.current=!1})()}),[args.user]),(0,react.useEffect)((()=>{if(isLoadingRef.current)return;const selectedUser=lastUserRef.current;if(currentArgs.user!==selectedUser)return;const{user}=currentArgs,fields=(0,objectWithoutProperties.A)(currentArgs,_excluded),prevFields=lastSyncedData.current;if(!Object.entries(fields).some((_ref=>{let[k,v]=_ref;return prevFields[k]!==v})))return;lastSyncedData.current=fields;(async()=>{try{const docRef=(0,index_esm.H9)(firebase.db,selectedUser,"discountcode");await(0,index_esm.mZ)(docRef,fields),console.log("UPDATED:",selectedUser,fields)}catch(e){console.error("Firestore update error:",e)}})()}),[currentArgs]),(0,jsx_runtime.jsx)(DiscountCode,(0,objectSpread2.A)({},args))}},__namedExportsOrder=["DiscountCodeModule"];DiscountCodeModule.parameters={...DiscountCodeModule.parameters,docs:{...DiscountCodeModule.parameters?.docs,source:{originalSource:"{\n  args: {\n    user: 'stories',\n    expanding: true,\n    title: '',\n    blurb: ``,\n    link: '',\n    linktext: '',\n    termslink: '',\n    terms: ``\n  },\n  render: function Render(args) {\n    const [currentArgs, updateArgs] = useArgs();\n    const isLoadingRef = useRef(false); // prevents writing during load\n    const lastUserRef = useRef(args.user); // track selected user\n    const lastSyncedData = useRef({}); // prevent write loops\n\n    // -------------------------------------------------------\n    // 1. LOAD DATA FROM SELECTED USER\n    // -------------------------------------------------------\n    useEffect(() => {\n      const load = async () => {\n        isLoadingRef.current = true; // BLOCK updates\n        lastUserRef.current = args.user;\n        try {\n          const docRef = doc(db, args.user, \"discountcode\");\n          const snap = await getDoc(docRef);\n          if (snap.exists()) {\n            const firestoreData = snap.data();\n            lastSyncedData.current = firestoreData;\n\n            // Replace storybook args with loaded data\n            updateArgs({\n              ...currentArgs,\n              ...firestoreData,\n              user: args.user\n            });\n          }\n        } catch (e) {\n          console.error(\"Firestore load error:\", e);\n        }\n        isLoadingRef.current = false; // allow updates again\n      };\n      load();\n    }, [args.user]);\n\n    // -------------------------------------------------------\n    // 2. SYNC ONLY FIELD CHANGES (NOT USER CHANGE)\n    // -------------------------------------------------------\n    useEffect(() => {\n      if (isLoadingRef.current) return; // Don't sync during load\n\n      const selectedUser = lastUserRef.current;\n\n      // Don't sync if this change is caused by selecting a new user\n      if (currentArgs.user !== selectedUser) return;\n\n      // Remove user field before writing\n      const {\n        user,\n        ...fields\n      } = currentArgs;\n\n      // Prevent re-writing unchanged data\n      const prevFields = lastSyncedData.current;\n      const changed = Object.entries(fields).some(([k, v]) => prevFields[k] !== v);\n      if (!changed) return;\n      lastSyncedData.current = fields;\n      const send = async () => {\n        try {\n          const docRef = doc(db, selectedUser, \"discountcode\");\n          await updateDoc(docRef, fields);\n          console.log(\"UPDATED:\", selectedUser, fields);\n        } catch (e) {\n          console.error(\"Firestore update error:\", e);\n        }\n      };\n      send();\n    }, [currentArgs]);\n    return <DiscountCode {...args} />;\n  }\n}",...DiscountCodeModule.parameters?.docs?.source}}}}}]);